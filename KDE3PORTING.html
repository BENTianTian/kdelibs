<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML Level 2//EN//2.0">
<HTML>
<HEAD>
	<TITLE>Guide to Porting Applications to KDE 3.0</TITLE>
</HEAD>
<BODY>

<H2>Porting Applications to KDE 3.0</H2>
This document contains the changes you have to apply to programs written for
KDE 2.x when you want to port them to KDE 3.0.<P>

As a start you should have a look at doc/porting.doc in the Qt package,
or <a href="http://doc.trolltech.com/porting.html">this page online</a>.<P>

<H3><A NAME="TOC">Table of Contents</A></H3>

<UL>
<LI><A HREF="#gettingstarted">Getting Started</A></LI>
<LI><A HREF="#kdecore">Changes in kdecore</A></LI>
<LI><A HREF="#kdeui">Changes in kdeui</A></LI>
<LI><A HREF="#kio">Changes in kio</A></LI>
<LI><A HREF="#kparts">Changes in kparts</A></LI>
<LI><A HREF="#khtmlpart">API-cleanup in KHTML</A></LI>
<LI><A HREF="#kcontrol">KDE Control Center</A></LI>
</UL>

<H3><A NAME="gettingstarted">Getting started</A></H3>

  The first step to get your KDE application to compile under KDE 3.0,
  is to detect KDE 3.0 and Qt 3.x at configure time. The easiest way to
  get a working autoconf/automake framework, is to either use 
  <a href="http://www.kdevelop.org">KDevelop</a> or
  <a href="http://home.earthlink.net/~granroth/kapptemplate/index.html">kapptemplate</a>
  (available in CVS under the module "kdesdk"), to generate a new
  application template. Replace the generated source files by yours
  and adapt Makefile.am accordingly.
<p>
  Please note that we tried to be mostly source-compatible where it
  was possible. To accomplish that, we added commonly used but still
  deprecated / removed API parts in a #ifndef KDE_NO_COMPAT-block. 
  That means you can "test" and adjust your application by #defining
  KDE_NO_COMPAT for compiling and see where it breaks. This is
  recommended, as those backward compatibility "hacks" are not kept for
  long.
</p>

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="kdecore">Changes in kdecore</A></H3>

<H4>KDesktopWidget</H4>
KDesktopWidget is obsolete. Include &lt;qdesktopwidget.h&gt; and use QDesktopWidget
instead, everything else is source compatible.

<H4>Header file names</H4>
<UL>
<LI>kapp.h is now kapplication.h</LI>
<LI>kuniqueapp.h is now kuniqueapplication.h</LI>
<LI>kstddirs.h is now kstandarddirs.h</LI>
<LI>kcolorbtn.h is now kcolorbutton.h</LI>
<Li>kxmlgui.h is now kxmlguifactory.h</LI>
</UL>
This is to help finding out header files from classnames and the other
way round. Compatibility headers have been created. You can use them as 
long as you don't compile with KDE_NO_COMPAT.

<H4>DCOP</H4>
The file with the DCOP connection information has been renamed. The new
name is $HOME/.DCOPserver_<hostname>_<display>. The screen part has been 
stripped from <display> and the ':' character that seperates host and
display-number has been replaced with a '_'. If you access DCOP via
DCOPClient you do not need to change anything.
<p>
It is no longer possible to make calls to an application registered as
"<appid>-<pid>" with "<appid>" only. The full name can be obtained by using
either KApplication::startServiceBy...() or DCOPClient::findObject() or 
their commandline equivalents "dcopstart" and "dcopfind".

<H4>KLibFactory</H4>
KLibFactory's create method is no more virtual and the createObject method
is now pure virtual. The former was marked as deprecated since KDE 2.0.
All it takes in your component is to rename your existing create implementation
to createObject and remove the 'emit objectCreated( yourObject );' line.

<H4>KStyle</H4>
Because of the QStyle rewrite our old extensions have been dropped
in order to have styles that fully integrate in KDE and Qt applications

<H4>KMD5</H4>
HASHHEX and HASH has been removed to make this class namespace clean. 
They have been replaced by QCString and KMD5::Digest. <br>
The API has been cleaned up, it is no longer necessary to call finalize(). 
Simply remove any calls to it. 

<H4>KLocale</H4>
<li>charset() has been removed. You might want to use encoding() instead.
<li>setCharset(const QString &) has been removed. You might want to use
setEncoding(int) instead.
<li>formatMoney(const QString &) has been removed.
<li>formatNumber(const QString &) has been removed.
<li>languages() has been removed. Use languageList() instead.

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="kdeui">Changes in kdeui</A></H3>

<H4>KPanelApplet</H4>
A new protected member method 'void reportBug()' was added. It gets called by
Kicker if the 'Report Bug' entry in the context menu gets selected and should
be overridden by applets which support the KPanelApplet::ReportBug action. This
means that you don't have to extend KPanelApplet's generic action dispatcher
void KPanelApplet::action() anymore.

<H4>KDockWidget</H4>
The WidgetList parameter has been renamed to QWidgetList. Behaviour
is identical. 

<H4>KPanelMenu</H4>
The old KPanelMenu class has been renamed to KPanelAppMenu. The KPanelMenu
class now corresponds to a new Kicker menu extension that is handled
by the panel in a way similar to other applets (shared library loaded
at run-time). See KDE 3.0 documentation
for more informations on this new extension.

<H4>KRootPixmap</H4>
The KRootPixmap class has been extended to make it more flexible, and the
<i>checkAvailable(bool ignored)</i> method has been renamed <i>isAvailable()</i>.
The old name will still work unless KDE_NO_COMPAT is defined.

<H4>KAlphaPainter</H4>
KAlphaPainter has been dropped, since Qt 3 has native support for
hardware accelerated alpha blending. 

<H4>KThemeBase, KThemeStyle</H4>
Because of the QStyle rewrite our old extensions have been dropped
in order to have styles that fully integrate in KDE and Qt applications.

<H4>KDirectionButton</H4>
...is gone. Use KArrowButton instead, it offers about the same
functionality.

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="kio">Changes in kio</A></H3>

<H4>KTarGz/KTarBase/KTarData</H4>
<ul>
  <li>The KTarBase and KTarData classes have been removed.</li>
  <li>KTarGz is now KTar (#define for source compatibility)</li>
  <li>A base class KArchive has been written, to support other archive formats in the future</li>
  <li>KTarEntry is now KArchiveEntry, KTarDirectory is now KArchiveDirectory, and KTarFile is now KArchiveFile.</li>
  <li>The classes ProgressBase, StatusbarProgress and DefaultProgress have been moved to the KIO namespace.</li>
  <li>The signal KDirLister::started(const QString &amp;url) has changed to KDirLister::started(const KURL &amp;url).<li>
  <li>KServiceTypeProfile::preferredService( const QString & serviceType, bool needApp ) has been removed, use
      KServiceTypeProfile::preferredService( ..., "Application") if needApp was true, or
      KServiceTypeProfile::preferredService( ..., Qstring::null) if needApp was false.
  <li>The following functions in KProtocolManager have been replaced:
      <ul>
<li>ftpProxy(), use proxyFor("ftp") instead.
<li>httpProxy(), use proxyFor("http") instead.
<li>slaveProtocol(const QString&amp;), use slaveProtocol(const KURL &amp;url, QString &amp;proxy) instead.
<li>defaultReadTimeout(), use DEFAULT_READ_TIMEOUT instead. (See ioslave_defaults.h)
<li>defaultProxyConnectTimeout(), use DEFAULT_PROXY_CONNECT_TIMEOUT instead. (See ioslave_defaults.h)
<li>defaultResponseTimeout(), use DEFAULT_RESPONSE_TIMEOUT instead. (See ioslave_defaults.h)
<li>minimumTimeoutThreshold(), use MIN_TIMEOUT_VALUE instead. (See ioslave_defaults.h)
      </ul>
  <li>The following functions in KProtocolManager have been removed:
      <ul>
<li>setUserAgentList( const QStringList& )
<li>userAgentList();
<li>setReadTimeout()
<li>setConnectTimeout( int )
<li>setProxyConnectTimeout( int )
<li>setResponseTimeout( int )
<li>setMarkPartial( bool )
<li>setMinimumKeepSize( int )
<li>setAutoResume( bool )
<li>setPersistentConnections( bool )
<li>setMaxCacheAge( int )
<li>setUseCache( bool )
<li>setMaxCacheSize( int )
<li>setCacheControl( KIO::CacheControl )
<li>setUseProxy( bool )
<li>setUseReverseProxy( bool )
<li>setProxyType( ProxyType )
<li>setProxyAuthMode( ProxyAuthMode )
<li>setFtpProxy( const QString&amp; )
<li>setHttpProxy( const QString&amp; )
<li>setProxyFor( const QString&amp;, const QString&amp; )
<li>setNoProxyFor( const QString&amp; )
<li>setProxyConfigScript( const QString&amp;  )
      </ul>
  </li>
</ul>

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="kparts">Changes in kparts</A></H3>

<H4>KParts::Factory</H4>
The createPart method is no more virtual and the createPartObject method
is now pure virtual. The former was marked as deprecated since KDE 2.0.
All it takes in your component is to rename your existing createPart implementation
to createPartObject and remove the 'emit objectCreated( yourObject );' line.

<H4>KParts::Part</H4>
The <code>bool isSelectable() const</code> is no more virtual. So when you want to
change the behaviour of the selectable property you don't need to re-implement
both virtual functions, setSelectable and isSelectable, but instead just
re-implementing setSelectable does the job. The very same applies for
the <code>KURL url() const</code> and ReadWritePart's <code>bool isReadWrite const</code>
and <code>bool isModified() const</code> methods.

<H4>KParts::BrowserExtension</H4>
The <code>URLArgs urlArgs()</code> method is no more virtual. So when you want to
change the behaviour of the urlArgs property you don't need to re-implement
both virtual functions, setURLArgs and urlArgs, but instead just re-implementing
setURLArgs does the job.

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="khtmlpart">API-cleanups in KHTML</A></H3>

There were a few relatively minor API-adjustements in KHTMLPart. In particular:
<ul><li>enableJScript(bool) has been replaced by setJScriptEnabled(bool)
<li>enableJava(bool) has been replaced by setJavaEnabled(bool)
<li>enablePlugins(bool) has been replaced by setPluginsEnabled(bool)
<li>autoloadImages(bool) has been replaced by setAutoloadImages(bool)
<li>enableMetaRefresh(bool) has been replaced by setMetaRefreshEnabled(bool)
<li>setBaseURL and setBaseTarget have been removed. baseURL(), baseTarget() and
completeURL() are remained for compatibility reasons, but they're deprecated now. use the variants in DOM::HTMLDocument() instead.
<li>the second parameter of KHTMLPart::completeURL is removed. it didn't have
   any effect before either.
</ul>
Besides that, all methods previously marked as deprecated or were internal
but accidently part of the public API are now private or removed.
As they were marked as becoming private already you should not experience
any problems. Backward compatibility exists for the common methods, to
disable this use a #define KDE_NO_COMPAT.
<p>In KHTMLView, the following changes were done:
<ul>
<li>gotoNextLink has been replaced by gotoLink(true);
<li>gotoPrevLink has been replaced by gotoLink(false);
</ul>
<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="kfile">Changes in kfile</A></H3>
The kfile-library, as used by the KFileDialog provides classes for directory browsing widgets.
Those classes gained some new features, some parts were merged with other existing classes
and in some cases the API was cleaned up/fixed.
<p>
Even if the list of changes is long, the affected codebase should be relatively small, as most
parts are rarely used outside of kfile.
<p>
The changes are:
<H4>KFileItem</H4>
The KFileViewItem class is completely replaced with KFileItem from kio. All its functionality has
been merged with its former baseclass KFileItem. Additionally, some of its methods have been
modified:
<table>
<tr><th>Old:</th><th>New:</th></tr>
<tr><td>access()</td><td>permissionsString()</td></tr>
<tr><td>date()</td><td>timeString()</td></tr>
<tr><td>setViewItem( const KFileView *view, const void *item )</td><td>setExtraData( const void *key, void *value )</td></tr>
<tr><td>pixmap()</td><td>The parameterless method has been removed, use pixmap( int size, int state = 0 ) instead.</td></tr>
</table>

<H4>KFileReader</H4>
This class has been merged with KDirLister from kio.

<H4>KDirOperator</H4>
<table>
<tr><th>Old:</th><th>New:</th></tr>
<tr><td>saveConfig()</td><td>writeConfig()</td></tr>
<tr><td>setFileReader()</td><td>setDirLister()</td></tr>
<tr><td>fileReader()</td><td>dirLister()</td></tr>
<tr><td>activatedMenu( const KFileViewItem * )</td><td>activatedMenu( const KFileItem *, const QPoint& pos )</td></tr>
</table>

<H4>KFileDetailView</H4>
The protected method setSortIndicator() has been removed, it's not needed anymore.

<H4>KFileView</H4>
This is the baseclass for all the views. It changed in many respects to allow for greater
flexibility and efficiency.
<br><br>
Sorting has changed radically. Previously, KFileView had protected methods QuickSort,
compareItems() and mergeLists() to sort directory entries for displaying in the views. Now,
KFileView does not do any sorting anymore. Instead, the view's (i.e. KIconView, KListView)
sorting is utilized by letting its view-items provide a QString key() method. Therefore,
KFileView offers the two methods
<ul>
<li>QString sortingKey( const QString&amp; value, bool isDir, int sortSpec )</li>
<li>QString sortingKey( KIO::filesize_t value, bool isDir, int sortSpec )</li>
</ul>
which the view-classes can use to generate the string for the key() method. The KFile::SortMode
enum has been removed, as QDir::SortSpec is used entirely.

<br><br>
Further changes:
<table>
<tr><th>Old:</th><th>New:</th></tr>
<tr><td>not existant</td><td>virtual void readConfig( KConfig *, const QString&amp; group = QString::null )</td></tr>
<tr><td>not existant</td><td>void writeConfig( KConfig *, const QString&amp; group = QString::null)</td></tr>
<tr><td>virtual void setCurrentItem( const QString&amp; filename, KFileViewItem * )</td><td>Replaced with the two methods below.</td></tr>
<tr><td>&nbsp;</td><td>void setCurrentItem( const QString&amp; filename );</td></tr>
<tr><td>&nbsp;</td><td>virtual void setCurrentItem( const KFileViewItem * ) = 0;</td></tr>
<tr><td>setOperator( QObject * )</td><td>setParentView( KFileView * )</td></tr>
<tr><td>virtual void insertSorted( KFileViewItem *, uint count )</td><td>virtual void insertItem( KFileItem * )</td></tr>
<tr><td>virtual void addItemList( const KFileViewItemList &amp;list )</td><td>not virtual anymore. Sufficient to reimplement insertItem()</td></tr>
</table>
<br><br>
Three more pure virtual methods have been added:
<ul>
<li>virtual KFileItem * firstFileItem() const = 0</li>
<li>virtual KFileItem * nextItem( const KFileItem * ) const = 0</li>
<li>virtual KFileItem * prevItem( const KFileItem * ) const = 0</li>
</ul>

<p>
State-changes are now signaled solely via the KFileViewSignaler object, that every KFileView
has a protected member of ("sig"). The methods activateMenu(), highlight() and select() have
been removed. If you implemented a KFileView, change your code in the following way:
<table>
<tr><th>Old:</th><th>New:</th></tr>
<tr><td>activateMenu( item )</td><td>sig->activateMenu( item, pos )</td></tr>
<tr><td>highlight( item )</td><td>sig->highlightFile( item )</td></tr>
<tr><td>select( item )</td><td>sig->select( item )</td></tr>
</table>


<H4>KFileViewSignaler</H4>
The methods activateDir( const KFileViewItem * ) and activateFile( const KFileViewItem * )
have been merged into the new method activate( const KFileItem * ).

<br><br>
Carsten Pfeiffer <A HREF="mailto:pfeiffer@kde.org">pfeiffer@kde.org</A>

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>
<p>


<H3><A NAME="kcontrol">Changes in KControl</A></H3>

<H4>Modules that require root permission</H4>
The meaning of the <i>X-KDE-RootOnly</i> flag in the .desktop files has changed.
In KControl 2.0 a message was shown if the user did not press the &quot;modify&quot;
button. With the additional flag <i>X-KDE-HasReadOnlyMode</i> it was possible to show
a disabled version of the module instead of the message. The behaviour was inconsistent
and has been changed:

<ul>
<li><i>X-KDE-HasReadOnlyMode</i> is not used anymore and is ignored by KControl &gt; 2.0.
<li><i>X-KDE-RootOnly</i> does now show a disabled preview of the widget and a notification box.
<li>If you want the old behaviour back set <i>X-KDE-IsHiddenByDefault</i> along with
<i>X-KDE-RootOnly</i>. Please note that this behaviour is deprecated the sake of
usability.
</ul>

For more details please consult the HOWTO file in the kcontrol directory.

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>
<p>


Dirk Mueller <A HREF="mailto:mueller@kde.org">mueller@kde.org</A>
</BODY>
</HTML>
