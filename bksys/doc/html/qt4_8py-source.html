<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>BKSYS - Build Kde SYStem: qt4.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>qt4.py</h1><a href="qt4_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespaceqt4.html">00001</a> <span class="comment"># Made from scons qt.py and (heavily) modified into kde.py</span>
<a name="l00002"></a>00002 <span class="comment"># Thomas Nagy, 2004, 2005 &lt;tnagy2^8@yahoo.fr&gt;</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="stringliteral">"""</span>
<a name="l00005"></a>00005 <span class="stringliteral">Run scons -h to display the associated help, or look below ..</span>
<a name="l00006"></a>00006 <span class="stringliteral">"""</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="keyword">import</span> os, re, types
<a name="l00009"></a>00009 
<a name="l00010"></a><a class="code" href="namespaceqt4.html#a8">00010</a> <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a8">exists</a>(env):
<a name="l00011"></a>00011         <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l00012"></a>00012 
<a name="l00013"></a><a class="code" href="namespaceqt4.html#a9">00013</a> <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a9">help</a>(env):
<a name="l00014"></a>00014         p=env.pprint
<a name="l00015"></a>00015         p(<span class="stringliteral">'BOLD'</span>,<span class="stringliteral">'*** QT4 options ***'</span>)
<a name="l00016"></a>00016         p(<span class="stringliteral">'BOLD'</span>,<span class="stringliteral">'--------------------'</span>)
<a name="l00017"></a>00017         p(<span class="stringliteral">'BOLD'</span>,<span class="stringliteral">'* prefix     '</span>,<span class="stringliteral">'base install path,         ie: /usr/local'</span>)
<a name="l00018"></a>00018         p(<span class="stringliteral">'BOLD'</span>,<span class="stringliteral">'* execprefix '</span>,<span class="stringliteral">'install path for binaries, ie: /usr/bin'</span>)
<a name="l00019"></a>00019         p(<span class="stringliteral">'BOLD'</span>,<span class="stringliteral">'* datadir    '</span>,<span class="stringliteral">'install path for the data, ie: /usr/local/share'</span>)
<a name="l00020"></a>00020         p(<span class="stringliteral">'BOLD'</span>,<span class="stringliteral">'* libdir     '</span>,<span class="stringliteral">'install path for the libs, ie: /usr/lib'</span>)
<a name="l00021"></a>00021         p(<span class="stringliteral">'BOLD'</span>,<span class="stringliteral">'* libsuffix  '</span>,<span class="stringliteral">'suffix of libraries on amd64, ie: 64, 32'</span>)
<a name="l00022"></a>00022         p(<span class="stringliteral">'BOLD'</span>,<span class="stringliteral">'* qtincludes '</span>,<span class="stringliteral">'qt includes path (/usr/include/qt on debian, ..)'</span>)
<a name="l00023"></a>00023         p(<span class="stringliteral">'BOLD'</span>,<span class="stringliteral">'* qtlibs     '</span>,<span class="stringliteral">'qt libraries path, for linking the program'</span>)
<a name="l00024"></a>00024         p(<span class="stringliteral">'BOLD'</span>,<span class="stringliteral">'* scons configure libdir=/usr/local/lib qtincludes=/usr/include/qt\n'</span>)
<a name="l00025"></a>00025         <span class="keywordflow">return</span>
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="namespaceqt4.html#a10">00027</a> <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a10">init_config_options</a>(env):
<a name="l00028"></a>00028         <span class="keyword">from</span> SCons.Options <span class="keyword">import</span> Options
<a name="l00029"></a>00029         cachefile=env[<span class="stringliteral">'CACHEDIR'</span>]+<span class="stringliteral">'qt4.cache.py'</span>
<a name="l00030"></a>00030         opts = Options(cachefile)
<a name="l00031"></a>00031         opts.cachefile = cachefile
<a name="l00032"></a>00032         <span class="keywordflow">return</span> opts
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="namespaceqt4.html#a11">00034</a> <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a11">config_options</a>(env,opts):
<a name="l00035"></a>00035         opts.AddOptions(
<a name="l00036"></a>00036                 (<span class="stringliteral">'PREFIX'</span>, <span class="stringliteral">'root of the program installation'</span>),
<a name="l00037"></a>00037                 (<span class="stringliteral">'LIBSUFFIXEXT'</span>, <span class="stringliteral">'suffix of libraries on amd64'</span>),
<a name="l00038"></a>00038 
<a name="l00039"></a>00039                 (<span class="stringliteral">'QTDIR'</span>, <span class="stringliteral">''</span>),
<a name="l00040"></a>00040                 (<span class="stringliteral">'QTLIBPATH'</span>, <span class="stringliteral">'path to the qt libraries'</span>),
<a name="l00041"></a>00041                 (<span class="stringliteral">'QTINCLUDEPATH'</span>, <span class="stringliteral">'path to the qt includes'</span>),
<a name="l00042"></a>00042 
<a name="l00043"></a>00043                 (<span class="stringliteral">'QT_UIC'</span>, <span class="stringliteral">'uic command'</span>),
<a name="l00044"></a>00044                 (<span class="stringliteral">'QT_UIC3'</span>, <span class="stringliteral">'uic3 command'</span>),
<a name="l00045"></a>00045                 (<span class="stringliteral">'QT_MOC'</span>, <span class="stringliteral">'moc command'</span>),
<a name="l00046"></a>00046                 (<span class="stringliteral">'QT_RCC'</span>, <span class="stringliteral">'rcc command'</span>),
<a name="l00047"></a>00047 
<a name="l00048"></a>00048                 (<span class="stringliteral">'CPPPATH_QT'</span>, <span class="stringliteral">''</span>),
<a name="l00049"></a>00049                 (<span class="stringliteral">'LIBPATH_QT'</span>, <span class="stringliteral">''</span>),
<a name="l00050"></a>00050                 (<span class="stringliteral">'LIB_QT'</span>, <span class="stringliteral">''</span>),
<a name="l00051"></a>00051                 (<span class="stringliteral">'RPATH_QT'</span>, <span class="stringliteral">''</span>),
<a name="l00052"></a>00052                 (<span class="stringliteral">'FRAMEWORKPATH_QT'</span>, <span class="stringliteral">''</span>),
<a name="l00053"></a>00053                 (<span class="stringliteral">'FRAMEWORK_QT'</span>, <span class="stringliteral">''</span>),
<a name="l00054"></a>00054 
<a name="l00055"></a>00055                 (<span class="stringliteral">'CPPPATH_QT3SUPPORT'</span>, <span class="stringliteral">''</span>),
<a name="l00056"></a>00056                 (<span class="stringliteral">'CXXFLAGS_QT3SUPPORT'</span>, <span class="stringliteral">''</span>),
<a name="l00057"></a>00057                 (<span class="stringliteral">'LIB_QT3SUPPORT'</span>, <span class="stringliteral">''</span>),
<a name="l00058"></a>00058                 (<span class="stringliteral">'RPATH_QT3SUPPORT'</span>, <span class="stringliteral">''</span>),
<a name="l00059"></a>00059                 (<span class="stringliteral">'FRAMEWORK_QT3SUPPORT'</span>, <span class="stringliteral">''</span>),
<a name="l00060"></a>00060                 (<span class="stringliteral">'FRAMEWORKPATH_QT3SUPPORT'</span>, <span class="stringliteral">''</span>),
<a name="l00061"></a>00061 
<a name="l00062"></a>00062                 (<span class="stringliteral">'CPPPATH_QTCORE'</span>, <span class="stringliteral">''</span>),
<a name="l00063"></a>00063                 (<span class="stringliteral">'LIB_QTCORE'</span>, <span class="stringliteral">''</span>),
<a name="l00064"></a>00064                 (<span class="stringliteral">'RPATH_QTCORE'</span>, <span class="stringliteral">''</span>),
<a name="l00065"></a>00065                 (<span class="stringliteral">'FRAMEWORK_QTCORE'</span>, <span class="stringliteral">''</span>),
<a name="l00066"></a>00066                 (<span class="stringliteral">'FRAMEWORKPATH_QTCORE'</span>, <span class="stringliteral">''</span>),
<a name="l00067"></a>00067 
<a name="l00068"></a>00068                 (<span class="stringliteral">'CPPPATH_QTDESIGNER'</span>, <span class="stringliteral">''</span>),
<a name="l00069"></a>00069                 (<span class="stringliteral">'LIB_QTDESIGNER'</span>, <span class="stringliteral">''</span>),
<a name="l00070"></a>00070                 (<span class="stringliteral">'FRAMEWORK_QTDESIGNER'</span>, <span class="stringliteral">''</span>),
<a name="l00071"></a>00071                 (<span class="stringliteral">'FRAMEWORKPATH_QTDESIGNER'</span>, <span class="stringliteral">''</span>),
<a name="l00072"></a>00072 
<a name="l00073"></a>00073                 (<span class="stringliteral">'CPPPATH_QTASSISTANT'</span>, <span class="stringliteral">''</span>),
<a name="l00074"></a>00074                 (<span class="stringliteral">'LIB_QTASSISTANT'</span>, <span class="stringliteral">''</span>),
<a name="l00075"></a>00075                 (<span class="stringliteral">'FRAMEWORK_QTASSISTANT'</span>, <span class="stringliteral">''</span>),
<a name="l00076"></a>00076                 (<span class="stringliteral">'FRAMEWORKPATH_QTASSISTANT'</span>, <span class="stringliteral">''</span>),
<a name="l00077"></a>00077                         
<a name="l00078"></a>00078                 (<span class="stringliteral">'CPPPATH_QTNETWORK'</span>, <span class="stringliteral">''</span>),
<a name="l00079"></a>00079                 (<span class="stringliteral">'LIB_QTNETWORK'</span>, <span class="stringliteral">''</span>),
<a name="l00080"></a>00080                 (<span class="stringliteral">'RPATH_QTNETWORK'</span>, <span class="stringliteral">''</span>),
<a name="l00081"></a>00081                 (<span class="stringliteral">'FRAMEWORK_QTNETWORK'</span>, <span class="stringliteral">''</span>),
<a name="l00082"></a>00082                 (<span class="stringliteral">'FRAMEWORKPATH_QTNETWORK'</span>, <span class="stringliteral">''</span>),
<a name="l00083"></a>00083 
<a name="l00084"></a>00084                 (<span class="stringliteral">'CPPPATH_QTGUI'</span>, <span class="stringliteral">''</span>),
<a name="l00085"></a>00085                 (<span class="stringliteral">'LIB_QTGUI'</span>, <span class="stringliteral">''</span>),
<a name="l00086"></a>00086                 (<span class="stringliteral">'RPATH_QTGUI'</span>, <span class="stringliteral">''</span>),
<a name="l00087"></a>00087                 (<span class="stringliteral">'FRAMEWORK_QTGUI'</span>, <span class="stringliteral">''</span>),
<a name="l00088"></a>00088                 (<span class="stringliteral">'FRAMEWORKPATH_QTGUI'</span>, <span class="stringliteral">''</span>),
<a name="l00089"></a>00089 
<a name="l00090"></a>00090                 (<span class="stringliteral">'CPPPATH_QTOPENGL'</span>, <span class="stringliteral">''</span>),
<a name="l00091"></a>00091                 (<span class="stringliteral">'LIB_QTOPENGL'</span>, <span class="stringliteral">''</span>),
<a name="l00092"></a>00092                 (<span class="stringliteral">'RPATH_QTOPENGL'</span>, <span class="stringliteral">''</span>),
<a name="l00093"></a>00093                 (<span class="stringliteral">'FRAMEWORK_QTOPENGL'</span>, <span class="stringliteral">''</span>),
<a name="l00094"></a>00094                 (<span class="stringliteral">'FRAMEWORKPATH_QTOPENGL'</span>, <span class="stringliteral">''</span>),
<a name="l00095"></a>00095 
<a name="l00096"></a>00096                 (<span class="stringliteral">'CPPPATH_QTSQL'</span>, <span class="stringliteral">''</span>),
<a name="l00097"></a>00097                 (<span class="stringliteral">'LIB_QTSQL'</span>, <span class="stringliteral">''</span>),
<a name="l00098"></a>00098                 (<span class="stringliteral">'RPATH_QTSQL'</span>, <span class="stringliteral">''</span>),
<a name="l00099"></a>00099                 (<span class="stringliteral">'FRAMEWORK_QTSQL'</span>, <span class="stringliteral">''</span>),
<a name="l00100"></a>00100                 (<span class="stringliteral">'FRAMEWORKPATH_QTSQL'</span>, <span class="stringliteral">''</span>),
<a name="l00101"></a>00101 
<a name="l00102"></a>00102                 (<span class="stringliteral">'CPPPATH_QTXML'</span>, <span class="stringliteral">''</span>),
<a name="l00103"></a>00103                 (<span class="stringliteral">'LIB_QTXML'</span>, <span class="stringliteral">''</span>),
<a name="l00104"></a>00104                 (<span class="stringliteral">'RPATH_QTXML'</span>, <span class="stringliteral">''</span>),
<a name="l00105"></a>00105                 (<span class="stringliteral">'FRAMEWORK_QTXML'</span>, <span class="stringliteral">''</span>),
<a name="l00106"></a>00106                 (<span class="stringliteral">'FRAMEWORKPATH_QTXML'</span>, <span class="stringliteral">''</span>),
<a name="l00107"></a>00107 
<a name="l00108"></a>00108                 <span class="comment"># TODO remove</span>
<a name="l00109"></a>00109                 (<span class="stringliteral">'QTPLUGINS'</span>, <span class="stringliteral">'uic executable command'</span>),
<a name="l00110"></a>00110 
<a name="l00111"></a>00111                 (<span class="stringliteral">'QTLOCALE'</span>, <span class="stringliteral">'install po files to this path'</span>),
<a name="l00112"></a>00112         )
<a name="l00113"></a>00113         opts.Update(env)
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="namespaceqt4.html#a12">00115</a> <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a12">generate</a>(env):
<a name="l00116"></a>00116 
<a name="l00117"></a>00117         <span class="keyword">import</span> SCons.Defaults
<a name="l00118"></a>00118         <span class="keyword">import</span> SCons.Tool
<a name="l00119"></a>00119         <span class="keyword">import</span> SCons.Util
<a name="l00120"></a>00120         <span class="keyword">import</span> SCons.Node
<a name="l00121"></a>00121 
<a name="l00122"></a>00122         CLVar = SCons.Util.CLVar
<a name="l00123"></a>00123         splitext = SCons.Util.splitext
<a name="l00124"></a>00124         Builder = SCons.Builder.Builder
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         opts = init_config_options(env)
<a name="l00127"></a>00127         config_options(env,opts)
<a name="l00128"></a>00128         <span class="keywordflow">if</span> env[<span class="stringliteral">'HELP'</span>]:
<a name="l00129"></a>00129                 help(env)       
<a name="l00130"></a>00130                 <span class="keywordflow">print</span> opts.GenerateHelpText(env)
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <span class="stringliteral">"""Set up the qt environment and builders - the moc part can be difficult to understand """</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135                 
<a name="l00136"></a>00136         <span class="comment"># Detect the environment - replaces ./configure implicitely and store the options into a cache</span>
<a name="l00137"></a>00137         
<a name="l00138"></a>00138         <span class="comment"># reconfigure when things are missing</span>
<a name="l00139"></a>00139         <span class="keywordflow">if</span> <span class="keywordflow">not</span> env[<span class="stringliteral">'HELP'</span>] <span class="keywordflow">and</span> (env[<span class="stringliteral">'_CONFIGURE_'</span>] <span class="keywordflow">or</span> (<span class="keywordflow">not</span> env.has_key(<span class="stringliteral">'LIB_QT'</span>) <span class="keywordflow">and</span> <span class="keywordflow">not</span> env.has_key(<span class="stringliteral">'FRAMEWORK_QT'</span>))):
<a name="l00140"></a>00140                 env[<span class="stringliteral">'_CONFIGURE_'</span>]=1
<a name="l00141"></a>00141                 <span class="keywordflow">for</span> opt <span class="keywordflow">in</span> opts.options:
<a name="l00142"></a>00142                         <span class="keywordflow">if</span> env.has_key(opt.key): env.__delitem__(opt.key)
<a name="l00143"></a>00143                 <span class="keyword">import</span> sys
<a name="l00144"></a>00144                 <span class="keywordflow">if</span> sys.platform == <span class="stringliteral">'darwin'</span>:
<a name="l00145"></a>00145                         sys.path.append(<span class="stringliteral">'bksys'</span>+os.sep+<span class="stringliteral">'osx'</span>)
<a name="l00146"></a>00146                         <span class="comment">#sys.path.append('bksys'+os.sep+'unix')</span>
<a name="l00147"></a>00147                         <span class="keyword">from</span> detect_qt4 <span class="keyword">import</span> detect
<a name="l00148"></a>00148                 <span class="keywordflow">elif</span> env[<span class="stringliteral">'WINDOWS'</span>]:
<a name="l00149"></a>00149                         sys.path.append(<span class="stringliteral">'bksys'</span>+os.sep+<span class="stringliteral">'win32'</span>)
<a name="l00150"></a>00150                         <span class="keyword">from</span> detect_qt4 <span class="keyword">import</span> detect
<a name="l00151"></a>00151                 <span class="keywordflow">else</span>:
<a name="l00152"></a>00152                         sys.path.append(<span class="stringliteral">'bksys'</span>+os.sep+<span class="stringliteral">'unix'</span>)
<a name="l00153"></a>00153                         <span class="keyword">from</span> detect_qt4 <span class="keyword">import</span> detect
<a name="l00154"></a>00154                 detect(env)
<a name="l00155"></a>00155                 opts.Save(opts.cachefile, env)
<a name="l00156"></a>00156 
<a name="l00157"></a>00157         <span class="comment">## set default variables, one can override them in sconscript files</span>
<a name="l00158"></a>00158         env[<span class="stringliteral">'QT_AUTOSCAN'</span>] = 1
<a name="l00159"></a>00159         env[<span class="stringliteral">'QT_DEBUG'</span>]    = 0
<a name="l00160"></a>00160 
<a name="l00161"></a>00161         env[<span class="stringliteral">'MSGFMT'</span>]   = <span class="stringliteral">'msgfmt'</span> <span class="comment">#TODO whether this should be checked?</span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         <span class="comment">## ui file processing</span>
<a name="l00164"></a><a class="code" href="namespaceqt4.html#a13">00164</a>         <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a13">uic_processing</a>(target, source, env):
<a name="l00165"></a>00165                 comp_h   =<span class="stringliteral">'$QT_UIC -o %s %s'</span> % (target[0].path, source[0].path)
<a name="l00166"></a>00166                 <span class="keywordflow">return</span> env.Execute(comp_h)
<a name="l00167"></a>00167 
<a name="l00168"></a><a class="code" href="namespaceqt4.html#a14">00168</a>         <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a14">uic3_processing</a>(target, source, env):
<a name="l00169"></a>00169                 inc_moc  =<span class="stringliteral">'#include "%s"\n'</span> % target[2].name
<a name="l00170"></a>00170                 comp_h   =<span class="stringliteral">'$QT_UIC3 -L $QTPLUGINS -nounload -o %s %s'</span> % (target[0].path, source[0].path)
<a name="l00171"></a>00171                 comp_c   =<span class="stringliteral">'$QT_UIC3 -L $QTPLUGINS -nounload -tr tr2i18n -impl %s %s'</span> % (target[0].path, source[0].path)
<a name="l00172"></a>00172                 comp_moc =<span class="stringliteral">'$QT_MOC -o %s %s'</span> % (target[2].path, target[0].path)
<a name="l00173"></a>00173                 <span class="keywordflow">if</span> env.Execute(comp_h):
<a name="l00174"></a>00174                         <span class="keywordflow">return</span> ret
<a name="l00175"></a>00175                 <span class="keywordflow">if</span> env.has_key(<span class="stringliteral">'UIC3_PRE_INCLUDE'</span>):
<a name="l00176"></a>00176                         dest = open( target[1].path, <span class="stringliteral">"w"</span> )
<a name="l00177"></a>00177                         dest.write(env[<span class="stringliteral">'UIC3_PRE_INCLUDE'</span>])
<a name="l00178"></a>00178                         dest.close()
<a name="l00179"></a>00179                 <span class="keywordflow">if</span> env.Execute( comp_c+<span class="stringliteral">" &gt;&gt; "</span>+target[1].path ):
<a name="l00180"></a>00180                         <span class="keywordflow">return</span> ret
<a name="l00181"></a>00181                 dest = open( target[1].path, <span class="stringliteral">"a"</span> )
<a name="l00182"></a>00182                 dest.write(inc_moc)
<a name="l00183"></a>00183                 dest.close()
<a name="l00184"></a>00184                 ret = env.Execute( comp_moc )
<a name="l00185"></a>00185                 <span class="keywordflow">return</span> ret
<a name="l00186"></a><a class="code" href="namespaceqt4.html#a15">00186</a>         <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a15">uic3Emitter</a>(target, source, env):
<a name="l00187"></a>00187                 adjustixes = SCons.Util.adjustixes
<a name="l00188"></a>00188                 bs = SCons.Util.splitext(str(source[0].name))[0]
<a name="l00189"></a>00189                 bs = os.path.join(str(target[0].get_dir()),bs)
<a name="l00190"></a>00190                 target.append(bs+<span class="stringliteral">'.cpp'</span>)
<a name="l00191"></a>00191                 target.append(bs+<span class="stringliteral">'.moc'</span>)
<a name="l00192"></a>00192                 <span class="keywordflow">return</span> target, source
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="namespaceqt4.html#a16">00194</a>         <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a16">uic3_string</a>(target, source, env):
<a name="l00195"></a>00195                 <span class="keywordflow">return</span> <span class="stringliteral">"%screating%s %s"</span> % (env[<span class="stringliteral">'BKS_COLORS'</span>][<span class="stringliteral">'BLUE'</span>], env[<span class="stringliteral">'BKS_COLORS'</span>][<span class="stringliteral">'NORMAL'</span>], target[0].name)
<a name="l00196"></a>00196         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'Uic'</span>]=Builder(action=env.Action(uic_processing, uic3_string),suffix=<span class="stringliteral">'.h'</span>,src_suffix=<span class="stringliteral">'.ui'</span>)
<a name="l00197"></a>00197         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'Uic3'</span>]=Builder(action=env.Action(uic3_processing, uic3_string),
<a name="l00198"></a>00198                 emitter=uic3Emitter,suffix=<span class="stringliteral">'.h'</span>,src_suffix=<span class="stringliteral">'.ui'</span>)
<a name="l00199"></a>00199 
<a name="l00200"></a><a class="code" href="namespaceqt4.html#a17">00200</a>         <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a17">qrc_buildit</a>(target, source, env):
<a name="l00201"></a>00201                 name = SCons.Util.splitext( source[0].name )[0]
<a name="l00202"></a>00202                 comp=<span class="stringliteral">'%s -name %s %s -o %s'</span> % (env[<span class="stringliteral">'QT_RCC'</span>], name, source[0].path, target[0].path)
<a name="l00203"></a>00203                 <span class="keywordflow">return</span> env.Execute(comp)
<a name="l00204"></a><a class="code" href="namespaceqt4.html#a18">00204</a>         <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a18">qrc_stringit</a>(target, source, env):
<a name="l00205"></a>00205                 <span class="keywordflow">print</span> <span class="stringliteral">"%screating%s %s"</span> % (env[<span class="stringliteral">'BKS_COLORS'</span>][<span class="stringliteral">'BLUE'</span>], env[<span class="stringliteral">'BKS_COLORS'</span>][<span class="stringliteral">'NORMAL'</span>], target[0].name)
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'Qrc'</span>]=Builder(action=env.Action(qrc_buildit, qrc_stringit), suffix=<span class="stringliteral">'_qrc.cpp'</span>, src_suffix=<span class="stringliteral">'.qrc'</span>)
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         <span class="comment">## MOC processing</span>
<a name="l00210"></a>00210         moc_comp   = <span class="stringliteral">'$QT_MOC $QT_MOCINCFLAGS -o $TARGET $SOURCE'</span>
<a name="l00211"></a>00211         moc_string = <span class="stringliteral">"%screating%s $TARGET"</span> % (env[<span class="stringliteral">'BKS_COLORS'</span>][<span class="stringliteral">'BLUE'</span>], env[<span class="stringliteral">'BKS_COLORS'</span>][<span class="stringliteral">'NORMAL'</span>])
<a name="l00212"></a>00212         <span class="keywordflow">if</span> <span class="keywordflow">not</span> env[<span class="stringliteral">'_USECOLORS_'</span>]: moc_string=<span class="stringliteral">""</span>
<a name="l00213"></a>00213         moc_action = env.Action(moc_comp, moc_string)
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'Moc'</span>]    = Builder(action=moc_action,suffix=<span class="stringliteral">'.moc'</span>,src_suffix=<span class="stringliteral">'.h'</span>)
<a name="l00216"></a>00216         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'Moccpp'</span>] = Builder(action=moc_action,suffix=<span class="stringliteral">'_moc.cpp'</span>,src_suffix=<span class="stringliteral">'.h'</span>)
<a name="l00217"></a>00217         <span class="comment"># for Moc2 you have to give the dependency explicitely, eg: env.Moc2(['file.cpp'])</span>
<a name="l00218"></a>00218         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'Moc2'</span>]   = Builder(action=moc_action,suffix=<span class="stringliteral">'.moc'</span>,src_suffix=<span class="stringliteral">'.cpp'</span>)
<a name="l00219"></a>00219         <span class="comment"># we need an extra option because moc only likes '-I ...' and not '/I ...' </span>
<a name="l00220"></a>00220         env[<span class="stringliteral">'QT_MOCINCFLAGS'</span>]     = <span class="stringliteral">'$( ${_concat("-I", CPPPATH, "", __env__, RDirs, TARGET, SOURCE)} $)'</span>
<a name="l00221"></a>00221 
<a name="l00222"></a>00222         <span class="comment">## TRANSLATIONS</span>
<a name="l00223"></a>00223         <span class="comment">#env['BUILDERS']['Transfiles']=Builder(action='$MSGFMT $SOURCE -o $TARGET',suffix='.gmo',src_suffix='.po')</span>
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         <span class="comment">## Handy helpers for building kde programs</span>
<a name="l00226"></a>00226         <span class="comment">## You should not have to modify them ..</span>
<a name="l00227"></a>00227 
<a name="l00228"></a>00228         ui_ext = [<span class="stringliteral">".ui"</span>]
<a name="l00229"></a>00229         ui3_ext = [<span class="stringliteral">".ui3"</span>]
<a name="l00230"></a>00230         header_ext = [<span class="stringliteral">".h"</span>, <span class="stringliteral">".hxx"</span>, <span class="stringliteral">".hpp"</span>, <span class="stringliteral">".hh"</span>]
<a name="l00231"></a>00231         cpp_ext = [<span class="stringliteral">".cpp"</span>, <span class="stringliteral">".cxx"</span>, <span class="stringliteral">".cc"</span>]
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="namespaceqt4.html#a19">00233</a>         <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a19">QT4files</a>(lenv, target, source):
<a name="l00234"></a>00234                 <span class="stringliteral">""" Returns a list of files for scons (handles qt4 tricks like .qrc) """</span>
<a name="l00235"></a>00235                 q_object_search = re.compile(<span class="stringliteral">r'\n\s*Q_OBJECT[^A-Za-z0-9]'</span>)
<a name="l00236"></a>00236                 <span class="keyword">def </span>scan_moc(cppfile):
<a name="l00237"></a>00237                         addfile=<span class="keywordtype">None</span>
<a name="l00238"></a>00238 
<a name="l00239"></a>00239                         <span class="comment"># try to find the header</span>
<a name="l00240"></a>00240                         orifile=cppfile.srcnode().name
<a name="l00241"></a>00241                         bs=SCons.Util.splitext(orifile)[0]
<a name="l00242"></a>00242 
<a name="l00243"></a>00243                         h_file=<span class="stringliteral">''</span>
<a name="l00244"></a>00244                         dir=cppfile.dir
<a name="l00245"></a>00245                         <span class="keywordflow">for</span> n_h_ext <span class="keywordflow">in</span> header_ext:
<a name="l00246"></a>00246                                 afile=dir.File(bs+n_h_ext)
<a name="l00247"></a>00247                                 <span class="keywordflow">if</span> afile.rexists():
<a name="l00248"></a>00248                                         <span class="comment">#h_ext=n_h_ext</span>
<a name="l00249"></a>00249                                         h_file=afile
<a name="l00250"></a>00250                                         <span class="keywordflow">break</span>
<a name="l00251"></a>00251                         <span class="comment"># We have the header corresponding to the cpp file</span>
<a name="l00252"></a>00252                         <span class="keywordflow">if</span> h_file:
<a name="l00253"></a>00253                                 h_contents = h_file.get_contents()
<a name="l00254"></a>00254                                 <span class="keywordflow">if</span> q_object_search.search(h_contents):
<a name="l00255"></a>00255                                         <span class="comment"># we know now there is Q_OBJECT macro</span>
<a name="l00256"></a>00256                                         reg = <span class="stringliteral">'\n\s*#include\s*("|&lt;)'</span>+str(bs)+<span class="stringliteral">'.moc("|&gt;)'</span>
<a name="l00257"></a>00257                                         meta_object_search = re.compile(reg)
<a name="l00258"></a>00258                                         <span class="comment">#cpp_contents = open(file_cpp, 'rb').read()</span>
<a name="l00259"></a>00259                                         cpp_contents=cppfile.get_contents()
<a name="l00260"></a>00260                                         <span class="keywordflow">if</span> meta_object_search.search(cpp_contents):
<a name="l00261"></a>00261                                                 lenv.Moc(h_file)
<a name="l00262"></a>00262                                         <span class="keywordflow">else</span>:
<a name="l00263"></a>00263                                                 lenv.Moccpp(h_file)
<a name="l00264"></a>00264                                                 addfile=bs+<span class="stringliteral">'_moc.cpp'</span>
<a name="l00265"></a>00265                                                 <span class="keywordflow">print</span> <span class="stringliteral">"WARNING: moc.cpp for "</span>+h_file.name+<span class="stringliteral">" consider using #include &lt;file.moc&gt; instead"</span>
<a name="l00266"></a>00266                         <span class="keywordflow">return</span> addfile
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 
<a name="l00269"></a>00269                 src=[]
<a name="l00270"></a>00270                 ui_files=[]
<a name="l00271"></a>00271                 other_files=[]
<a name="l00272"></a>00272 
<a name="l00273"></a>00273                 source_=lenv.make_list(source)
<a name="l00274"></a>00274 
<a name="l00275"></a>00275                 <span class="comment"># For each file, check wether it is a dcop file or not, and create the complete list of sources</span>
<a name="l00276"></a>00276                 <span class="keywordflow">for</span> file <span class="keywordflow">in</span> source_:
<a name="l00277"></a>00277                         sfile=SCons.Node.FS.default_fs.File(str(file))
<a name="l00278"></a>00278                         bs  = SCons.Util.splitext(file)[0]
<a name="l00279"></a>00279                         ext = SCons.Util.splitext(file)[1]
<a name="l00280"></a>00280                         <span class="keywordflow">if</span> ext == <span class="stringliteral">".moch"</span>:
<a name="l00281"></a>00281                                 lenv.Moccpp(bs+<span class="stringliteral">'.h'</span>)
<a name="l00282"></a>00282                                 src.append(bs+<span class="stringliteral">'_moc.cpp'</span>)
<a name="l00283"></a>00283                         <span class="keywordflow">elif</span> ext == <span class="stringliteral">".qrc"</span>:
<a name="l00284"></a>00284                                 src.append(bs+<span class="stringliteral">'_qrc.cpp'</span>)
<a name="l00285"></a>00285                                 lenv.Qrc(file)
<a name="l00286"></a>00286                                 
<a name="l00287"></a>00287                                 <span class="keyword">from</span> xml.sax <span class="keyword">import</span> make_parser
<a name="l00288"></a>00288                                 <span class="keyword">from</span> xml.sax.handler <span class="keyword">import</span> ContentHandler
<a name="l00289"></a>00289 
<a name="l00290"></a>00290                                 <span class="keyword">class </span>SconsHandler(ContentHandler):
<a name="l00291"></a>00291                                         <span class="keyword">def </span>__init__ (self, envi):
<a name="l00292"></a>00292                                                 self.self.files=[]
<a name="l00293"></a>00293                                                 self.self.mstr=<span class="stringliteral">''</span>
<a name="l00294"></a>00294                                         <span class="keyword">def </span>startElement(self, name, attrs):
<a name="l00295"></a>00295                                                 <span class="keywordflow">if</span> name ==<span class="stringliteral">'file'</span>:
<a name="l00296"></a>00296                                                         self.self.mstr=<span class="stringliteral">''</span>
<a name="l00297"></a>00297                                         <span class="keyword">def </span>endElement(self, name):
<a name="l00298"></a>00298                                                 <span class="keywordflow">if</span> name ==<span class="stringliteral">'file'</span>:
<a name="l00299"></a>00299                                                         self.self.files.append(self.self.mstr)
<a name="l00300"></a>00300                                                         self.self.mstr=<span class="stringliteral">''</span>
<a name="l00301"></a>00301                                         <span class="keyword">def </span>characters(self, chars):
<a name="l00302"></a>00302                                                 self.self.mstr+=chars
<a name="l00303"></a>00303 
<a name="l00304"></a>00304                                 parser = make_parser()
<a name="l00305"></a>00305                                 curHandler = SconsHandler(lenv)
<a name="l00306"></a>00306                                 parser.setContentHandler(curHandler)
<a name="l00307"></a>00307                                 parser.parse(open(sfile.srcnode().abspath))
<a name="l00308"></a>00308                                 files=curHandler.files
<a name="l00309"></a>00309 
<a name="l00310"></a>00310                                 lenv.Depends(bs+<span class="stringliteral">'_qrc.cpp'</span>, files)
<a name="l00311"></a>00311                                 <span class="comment">#for i in files:</span>
<a name="l00312"></a>00312                                 <span class="comment">#       print "   -&gt; "+i</span>
<a name="l00313"></a>00313                         <span class="keywordflow">elif</span> ext <span class="keywordflow">in</span> cpp_ext:
<a name="l00314"></a>00314                                 src.append(file)
<a name="l00315"></a>00315                                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> env.has_key(<span class="stringliteral">'NOMOCFILE'</span>):
<a name="l00316"></a>00316                                         ret = scan_moc(sfile)
<a name="l00317"></a>00317                                         <span class="keywordflow">if</span> ret: src.append( ret )
<a name="l00318"></a>00318                         <span class="keywordflow">elif</span> ext <span class="keywordflow">in</span> ui_ext:
<a name="l00319"></a>00319                                 lenv.Uic(file)
<a name="l00320"></a>00320                         <span class="keywordflow">elif</span> ext <span class="keywordflow">in</span> ui3_ext:
<a name="l00321"></a>00321                                 lenv.Uic3(bs+<span class="stringliteral">'.ui'</span>)
<a name="l00322"></a>00322                                 src.append(bs+<span class="stringliteral">'.cpp'</span>)
<a name="l00323"></a>00323                         <span class="keywordflow">else</span>:
<a name="l00324"></a>00324                                 src.append(file)
<a name="l00325"></a>00325 
<a name="l00326"></a>00326                 <span class="comment"># Now check against typical newbie errors</span>
<a name="l00327"></a>00327                 <span class="keywordflow">for</span> file <span class="keywordflow">in</span> ui_files:
<a name="l00328"></a>00328                         <span class="keywordflow">for</span> ofile <span class="keywordflow">in</span> other_files:
<a name="l00329"></a>00329                                 <span class="keywordflow">if</span> ofile == file:
<a name="l00330"></a>00330                                         lenv.pprint(<span class="stringliteral">'RED'</span>, <span class="stringliteral">"WARNING: You have included "</span>+file+<span class="stringliteral">".ui and another file of the same prefix"</span>)
<a name="l00331"></a>00331                                         <span class="keywordflow">print</span> <span class="stringliteral">"Files generated by uic (file.h, file.cpp must not be included"</span>
<a name="l00332"></a>00332                 <span class="keywordflow">return</span> src
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         <span class="stringliteral">""" In the future, these functions will contain the code that will dump the</span>
<a name="l00336"></a>00336 <span class="stringliteral">        configuration for re-use from an IDE """</span>
<a name="l00337"></a>00337         <span class="keyword">import</span> glob
<a name="l00338"></a>00338 
<a name="l00339"></a><a class="code" href="namespaceqt4.html#a20">00339</a>         <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a20">QT4install</a>(lenv, restype, subdir, files):
<a name="l00340"></a>00340                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> env[<span class="stringliteral">'_INSTALL_'</span>]:
<a name="l00341"></a>00341                         <span class="keywordflow">return</span>
<a name="l00342"></a>00342                 dir = getInstDirForResType(lenv, restype)
<a name="l00343"></a>00343                 install_list = lenv.bksys_install(lenv.join(dir,subdir), files, nodestdir=1)
<a name="l00344"></a>00344                 <span class="keywordflow">return</span> install_list
<a name="l00345"></a>00345 
<a name="l00346"></a><a class="code" href="namespaceqt4.html#a21">00346</a>         <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a21">QT4installas</a>(lenv, restype, destfile, file):
<a name="l00347"></a>00347                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> env[<span class="stringliteral">'_INSTALL_'</span>]:
<a name="l00348"></a>00348                         <span class="keywordflow">return</span>
<a name="l00349"></a>00349                 dir = getInstDirForResType(lenv, restype)
<a name="l00350"></a>00350                 install_list = lenv.InstallAs(lenv.join(dir,destfile), file)
<a name="l00351"></a>00351                 env.Alias(<span class="stringliteral">'install'</span>, install_list)
<a name="l00352"></a>00352                 <span class="keywordflow">return</span> install_list
<a name="l00353"></a>00353 
<a name="l00354"></a><a class="code" href="namespaceqt4.html#a22">00354</a>         <span class="keyword">def </span><a class="code" href="namespaceqt4.html#a22">QT4lang</a>(lenv, folder, appname):
<a name="l00355"></a>00355                 <span class="stringliteral">""" Process translations (.po files) in a po/ dir """</span>
<a name="l00356"></a>00356                 transfiles = glob.glob(folder+<span class="stringliteral">'/*.po'</span>)
<a name="l00357"></a>00357                 <span class="keywordflow">for</span> lang <span class="keywordflow">in</span> transfiles:
<a name="l00358"></a>00358                         result = lenv.Transfiles(lang)
<a name="l00359"></a>00359                         country = SCons.Util.splitext(result[0].name)[0]
<a name="l00360"></a>00360                         lenv.QT4installas(<span class="stringliteral">'QTLOCALE'</span>, lenv.join(country,<span class="stringliteral">'LC_MESSAGES'</span>,appname+<span class="stringliteral">'.mo'</span>), result)
<a name="l00361"></a>00361 
<a name="l00362"></a>00362         <span class="keyword">import</span> generic
<a name="l00363"></a><a class="code" href="classqt4_1_1qt4obj.html">00363</a>         <span class="keyword">class </span><a class="code" href="classqt4_1_1qt4obj.html">qt4obj</a>(generic.genobj):
<a name="l00364"></a>00364                 <span class="keyword">def </span>__init__(self, val, senv=None):
<a name="l00365"></a>00365                         <span class="keywordflow">if</span> senv: generic.genobj.__init__(self, val, senv)
<a name="l00366"></a>00366                         <span class="keywordflow">else</span>: generic.genobj.__init__(self, val, env)
<a name="l00367"></a><a class="code" href="classqt4_1_1qt4obj.html#o0">00367</a>                         <span class="keywordflow">if</span> val == <span class="stringliteral">'shlib'</span>:     self.<a class="code" href="classqt4_1_1qt4obj.html#o0">instdir</a>=senv.join(senv[<span class="stringliteral">'PREFIX'</span>], <span class="stringliteral">'lib'</span>)
<a name="l00368"></a>00368                         <span class="keywordflow">elif</span> val == <span class="stringliteral">'program'</span>: self.<a class="code" href="classqt4_1_1qt4obj.html#o0">instdir</a>=senv.join(senv[<span class="stringliteral">'PREFIX'</span>], <span class="stringliteral">'bin'</span>)
<a name="l00369"></a><a class="code" href="classqt4_1_1qt4obj.html#a0">00369</a>                 <span class="keyword">def </span><a class="code" href="classqt4_1_1qt4obj.html#a0">execute</a>(self):
<a name="l00370"></a>00370                         <span class="keywordflow">if</span> self.self.executed: <span class="keywordflow">return</span>
<a name="l00371"></a>00371                         <span class="keywordflow">if</span> self.self.orenv.has_key(<span class="stringliteral">'DUMPCONFIG'</span>):
<a name="l00372"></a>00372                                 <span class="keywordflow">print</span> self.<a class="code" href="classqt4_1_1qt4obj.html#a1">xml</a>()
<a name="l00373"></a>00373                                 self.self.executed=1
<a name="l00374"></a>00374                                 <span class="keywordflow">return</span>
<a name="l00375"></a>00375                         self.self.env=self.self.orenv.Copy()
<a name="l00376"></a>00376                         self.self.setsource( QT4files(self.self.env, self.self.target, self.self.source) )
<a name="l00377"></a>00377                         generic.genobj.execute(self)
<a name="l00378"></a><a class="code" href="classqt4_1_1qt4obj.html#a1">00378</a>                 <span class="keyword">def </span><a class="code" href="classqt4_1_1qt4obj.html#a1">xml</a>(self):
<a name="l00379"></a>00379                         ret= <span class="stringliteral">'&lt;compile type="%s" dirprefix="%s" target="%s" cxxflags="%s" cflags="%s" includes="%s" linkflags="%s" libpaths="%s" libs="%s" vnum="%s" iskdelib="%s" libprefix="%s"&gt;\n'</span> % (self.self.type, self.self.dirprefix, self.self.target, self.self.cxxflags, self.self.cflags, self.self.includes, self.self.linkflags, self.self.libpaths, self.self.libs, self.self.vnum, self.self.iskdelib, self.self.libprefix)
<a name="l00380"></a>00380                         <span class="keywordflow">if</span> self.self.source:
<a name="l00381"></a>00381                                 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> self.self.orenv.make_list(self.self.source):
<a name="l00382"></a>00382                                         ret += <span class="stringliteral">'  &lt;source file="%s"/&gt;\n'</span> % i
<a name="l00383"></a>00383                         ret += <span class="stringliteral">"&lt;/compile&gt;"</span>
<a name="l00384"></a>00384                         <span class="keywordflow">return</span> ret
<a name="l00385"></a>00385 
<a name="l00386"></a>00386         <span class="comment"># Attach the functions to the environment so that SConscripts can use them</span>
<a name="l00387"></a>00387         <span class="keyword">from</span> SCons.Script.SConscript <span class="keyword">import</span> SConsEnvironment
<a name="l00388"></a>00388         SConsEnvironment.QT4install = QT4install
<a name="l00389"></a>00389         SConsEnvironment.QT4installas = QT4installas
<a name="l00390"></a>00390         SConsEnvironment.QT4lang = QT4lang
<a name="l00391"></a>00391         SConsEnvironment.qt4obj=qt4obj
<a name="l00392"></a>00392 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Oct 23 01:11:54 2005 for BKSYS - Build Kde SYStem by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
