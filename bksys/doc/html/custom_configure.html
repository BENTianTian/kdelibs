<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>BKSYS - Build Kde SYStem: Custom configuring</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1><a class="anchor" name="custom_configure">Custom configuring</a></h1><a class="el" href="glossar.html#proposal_state">proposal state</a><p>
What means custom configuring: <br>
 developers would like to be able to define "configure needs" in subdirs of a svn module, i.e. to have a file under kdecore that says "I need the headers sys/stat.h, sys/mntent.h, sys/param.h, paths.h, limits.h, execinfo.h" etc. and I need the c functions "mmap, getmntinfo, setmntent", etc.<p>
Custom configuration means that developers can customize the configure process on a directory or package related way. This is done by adding specific files named 'SConfigure' into the required directory (like autotool's directory based configure.in.in). <br>
 On the configuring process the settings in this files are collected and stored in the <a class="el" href="config_cache.html">Configuration cache</a> configuration cache. Then the configuration process performs the requested actions, that means searching for headers, c function and additional libraries. The results are stored into the configuration cache too.<h2><a class="anchor" name="sconfigure_format">
Format of 'SConfigure' files</a></h2>
SConfigure files are regular python scripts which are executed by the configure process with a previously created PackageConfigure object named 'conf'. The PackageConfigure class provides several attributes, which allows to customize the configuration.<p>
[question: or better named 'env' or 'config' ? ] <ul>
<li>
add required c header file(s) <br>
 example:<p>
<div class="fragment"><pre class="fragment">conf.cheaders += <span class="stringliteral">"sys/stat.h sys/mntent.h sys/param.h paths.h limits.h execinfo.h"</span>
</pre></div><p>
the given filenames are automatically mapped to a related define in the config header config-&lt;dirname&gt;.h which is included by the global config.h file. <br>
 If for example the header sys/stat.h is present it will be mapped to HAVE_SYS_STAT_H <br>
<p>
</li>
<li>
add required c function(s) example:<p>
<div class="fragment"><pre class="fragment">conf.cfunctions += <span class="stringliteral">"mmap getmntinfo setmntent"</span>
</pre></div><p>
the available functions are mapped automatically to a related define in the config header config-&lt;dirname&gt;.h which is included by the global config.h file. <br>
 if for example the function strlcpy() is present it will be mapped to HAVE_STRLCPY <br>
<p>
</li>
<li>
add a required c header files(s) <br>
 like <b>conf.cheaders</b> with the exception, that if the header file wasn't found, the configuration process will be canceled with an error message. <br>
<p>
example:<p>
<div class="fragment"><pre class="fragment">conf.required_cheaders += <span class="stringliteral">"sys/socket.h"</span>
</pre></div><p>
</li>
<li>
add required c function(s) <br>
 like <b>conf.cfunction</b> with the exception, that if the header file wasn't found, the configuration process will be canceled with an error message. <br>
 example:<p>
<div class="fragment"><pre class="fragment">conf.required_cfunctions += <span class="stringliteral">"xyz"</span>
</pre></div><p>
</li>
<li>
add a user selectable option for an optional package, setting the package name, a description, the default case and special options for further processing like error message ... example:<p>
<div class="fragment"><pre class="fragment">conf.modules['tiff']    = ['Enable tiff support<span class="charliteral">','</span>yes',&lt;options or handler how to <a class="code" href="namespacedetect__lowlevel.html#a1">detect</a>&gt;,....]
conf.modules['jasper']  = ['Enable jasper (jpeg2k) support','yes']
conf.modules['openexr'] = ['Enable openexr support','no']
</pre></div><p>
<dl compact><dt><b>Note:</b></dt><dd>: the name 'modules' could be also another name for example 'uselib', but should be unique for whole bksys, because these 'modules' are usable by the genobj and friends uselib attribute<p>
: if many parameters are possible, it may be better to use a dict type as values in the form desc = 'Enable tiff support', default = 'yes', message = ['notfound','found']</dd></dl>
The related package could be referenced later in the SConscript file using:<p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> env.conf['tiff']: 
        obj.src += <span class="stringliteral">"xxx"</span>
</pre></div><p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>: it must be possible to use prefined checks and custom checks in the above mentioned settings, may be through python code or functions or .</dd></dl>
.., don't know how to implement<p>
</li>
<li>
add a package related selectable message at the end of the configuring process<p>
<div class="fragment"><pre class="fragment">        conf.messages['tiff'] = ['not found message<span class="charliteral">','</span>found message']
</pre></div><p>
<dl compact><dt><b>Note:</b></dt><dd>: another probably better approach would be to specify this message as parameter of conf.modules[...}</dd></dl>
</li>
<li>
platform support for configuring is performed by checking the currently used platform. For this the conf object includes several attributes ??<ul>
<li>platform</li><li>CC <dl compact><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>: finish</dd></dl>
<div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> conf['WINDOWS']: 
        conf.modules['jasper']  = ['Enable jasper (jpeg2k) support','yes']
</pre></div></li></ul>
<p>
</li>
</ul>
<h2><a class="anchor" name="Implementation">
hints</a></h2>
<ul>
<li>put in here requirements/options for the implementation</li></ul>
<h2><a class="anchor" name="custom_config_notes">
notes</a></h2>
<ul>
<li>later on we could then even automate the creation of that file by a script that scans the source files for those headers and functions, but not at compile time imho, just as an easy way to keep those files in sync</li></ul>
<p>
<ul>
<li>But we can include in the recursive lookup a way to look for _&lt;PLATFORM&gt; files additionally, so we can have both.</li></ul>
<p>
<ul>
<li>we might want per-subdir .h files (e.g. config-kdecore.h and config-kdeui.h), so that it's easier to move a subdir to another module... but then we have to run the same tests more than once if both kdecore and kdeui need sys/stat.h. Although, with the caching it would be fast, just a bit strange on stdout. </li></ul>
<hr size="1"><address style="align: right;"><small>Generated on Sun Oct 23 01:32:52 2005 for BKSYS - Build Kde SYStem by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
