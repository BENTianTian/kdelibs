<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>BKSYS - Build Kde SYStem: kde4.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>kde4.py</h1><a href="kde4_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacekde4.html">00001</a> <span class="comment">#! /usr/bin/env python</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="keyword">import</span> re
<a name="l00004"></a>00004 
<a name="l00005"></a><a class="code" href="namespacekde4.html#a9">00005</a> <span class="keyword">def </span><a class="code" href="namespacekde4.html#a9">exists</a>(env):
<a name="l00006"></a>00006         <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l00007"></a>00007 
<a name="l00008"></a><a class="code" href="namespacekde4.html#a10">00008</a> <span class="keyword">def </span><a class="code" href="namespacekde4.html#a10">generate</a>(env):
<a name="l00009"></a>00009         <span class="keywordflow">if</span> env[<span class="stringliteral">'HELP'</span>]: <span class="keywordflow">return</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011         <span class="keyword">from</span> SCons.Tool <span class="keyword">import</span> Tool
<a name="l00012"></a>00012         Tool(<span class="stringliteral">'qt4'</span>, [<span class="stringliteral">'./bksys'</span>]).generate(env)
<a name="l00013"></a>00013 
<a name="l00014"></a>00014         <span class="keyword">from</span> SCons.Options <span class="keyword">import</span> Options
<a name="l00015"></a>00015         cachefile=env[<span class="stringliteral">'CACHEDIR'</span>]+<span class="stringliteral">'kde4.cache.py'</span>
<a name="l00016"></a>00016         opts = Options(cachefile)
<a name="l00017"></a>00017         opts.AddOptions(
<a name="l00018"></a>00018                 (<span class="stringliteral">'KDE4_ISCONFIGURED'</span>, <span class="stringliteral">''</span>),
<a name="l00019"></a>00019 
<a name="l00020"></a>00020                 (<span class="stringliteral">'KDEDIR'</span>, <span class="stringliteral">''</span>),
<a name="l00021"></a>00021                 (<span class="stringliteral">'KDELIBPATH'</span>, <span class="stringliteral">'path to the installed kde libs'</span>),
<a name="l00022"></a>00022                 (<span class="stringliteral">'KDEINCLUDEPATH'</span>, <span class="stringliteral">'path to the installed kde includes'</span>),
<a name="l00023"></a>00023                 (<span class="stringliteral">'KDECCFLAGS'</span>, <span class="stringliteral">'kde-related C compiler flags'</span>),
<a name="l00024"></a>00024                 (<span class="stringliteral">'KDECXXFLAGS'</span>, <span class="stringliteral">'kde-related c++ compiler flags'</span>),
<a name="l00025"></a>00025 
<a name="l00026"></a>00026                 (<span class="stringliteral">'LIBPATH_KDE4'</span>, <span class="stringliteral">''</span>),
<a name="l00027"></a>00027                 (<span class="stringliteral">'RPATH_KDE4'</span>, <span class="stringliteral">''</span>),
<a name="l00028"></a>00028                 (<span class="stringliteral">'INCLUDES_KDE4'</span>, <span class="stringliteral">''</span>),
<a name="l00029"></a>00029 
<a name="l00030"></a>00030                 (<span class="stringliteral">'KDEBIN'</span>, <span class="stringliteral">'inst path of the kde binaries'</span>),
<a name="l00031"></a>00031                 (<span class="stringliteral">'KDEINCLUDE'</span>, <span class="stringliteral">'inst path of the kde include files'</span>),
<a name="l00032"></a>00032                 (<span class="stringliteral">'KDELIB'</span>, <span class="stringliteral">'inst path of the kde libraries'</span>),
<a name="l00033"></a>00033                 (<span class="stringliteral">'KDEMODULE'</span>, <span class="stringliteral">'inst path of the parts and libs'</span>),
<a name="l00034"></a>00034                 (<span class="stringliteral">'KDEDATA'</span>, <span class="stringliteral">'inst path of the application data'</span>),
<a name="l00035"></a>00035                 (<span class="stringliteral">'KDELOCALE'</span>, <span class="stringliteral">''</span>), (<span class="stringliteral">'KDEDOC'</span>, <span class="stringliteral">''</span>), (<span class="stringliteral">'KDEKCFG'</span>, <span class="stringliteral">''</span>),
<a name="l00036"></a>00036                 (<span class="stringliteral">'KDEXDG'</span>, <span class="stringliteral">''</span>), (<span class="stringliteral">'KDEXDGDIR'</span>, <span class="stringliteral">''</span>), (<span class="stringliteral">'KDEMENU'</span>, <span class="stringliteral">''</span>),
<a name="l00037"></a>00037                 (<span class="stringliteral">'KDEMIME'</span>, <span class="stringliteral">''</span>), (<span class="stringliteral">'KDEICONS'</span>, <span class="stringliteral">''</span>), (<span class="stringliteral">'KDESERV'</span>, <span class="stringliteral">''</span>),
<a name="l00038"></a>00038                 (<span class="stringliteral">'KDESERVTYPES'</span>, <span class="stringliteral">''</span>), (<span class="stringliteral">'KDEAPPS'</span>, <span class="stringliteral">''</span>), (<span class="stringliteral">'KDECONF'</span>,<span class="stringliteral">''</span>),
<a name="l00039"></a>00039                 
<a name="l00040"></a>00040                 <span class="comment"># the main KDE libraries - the naming is important here, see genobj.uselib</span>
<a name="l00041"></a>00041                 (<span class="stringliteral">'LIBPATH_KDECORE'</span>, <span class="stringliteral">''</span>),
<a name="l00042"></a>00042                 (<span class="stringliteral">'LIBPATH_KIO'</span>, <span class="stringliteral">''</span>),
<a name="l00043"></a>00043                 (<span class="stringliteral">'LIBPATH_KDEUI'</span>, <span class="stringliteral">''</span>),
<a name="l00044"></a>00044                 (<span class="stringliteral">'LIBPATH_QTTEST'</span>, <span class="stringliteral">''</span>),
<a name="l00045"></a>00045 
<a name="l00046"></a>00046                 (<span class="stringliteral">'CPPPATH_KDECORE'</span>, <span class="stringliteral">''</span>),
<a name="l00047"></a>00047                 (<span class="stringliteral">'CPPPATH_KIO'</span>, <span class="stringliteral">''</span>),
<a name="l00048"></a>00048                 (<span class="stringliteral">'CPPPATH_KDEUI'</span>, <span class="stringliteral">''</span>),
<a name="l00049"></a>00049                 (<span class="stringliteral">'CPPPATH_QTTEST'</span>, <span class="stringliteral">''</span>),
<a name="l00050"></a>00050 
<a name="l00051"></a>00051                 (<span class="stringliteral">'LIB_KDECORE'</span>, <span class="stringliteral">''</span>),
<a name="l00052"></a>00052                 (<span class="stringliteral">'LIB_KIO'</span>, <span class="stringliteral">''</span>),
<a name="l00053"></a>00053                 (<span class="stringliteral">'LIB_KDEUI'</span>, <span class="stringliteral">''</span>),
<a name="l00054"></a>00054                 (<span class="stringliteral">'LIB_QTTEST'</span>, <span class="stringliteral">''</span>),
<a name="l00055"></a>00055 
<a name="l00056"></a>00056                 (<span class="stringliteral">'KCONFIGCOMPILER'</span>, <span class="stringliteral">''</span>),
<a name="l00057"></a>00057                 (<span class="stringliteral">'DCOPIDL'</span>, <span class="stringliteral">''</span>), (<span class="stringliteral">'DCOPIDL2CPP'</span>, <span class="stringliteral">''</span>),
<a name="l00058"></a>00058                 (<span class="stringliteral">'UIC3_PRE_INCLUDE'</span>, <span class="stringliteral">''</span>)
<a name="l00059"></a>00059         )
<a name="l00060"></a>00060         opts.Update(env)
<a name="l00061"></a>00061 
<a name="l00062"></a>00062         <span class="keywordflow">if</span> <span class="keywordflow">not</span> env[<span class="stringliteral">'HELP'</span>] <span class="keywordflow">and</span> (env[<span class="stringliteral">'_CONFIGURE_'</span>] <span class="keywordflow">or</span> <span class="keywordflow">not</span> env.has_key(<span class="stringliteral">'KDE4_ISCONFIGURED'</span>)):
<a name="l00063"></a>00063                 env[<span class="stringliteral">'_CONFIGURE_'</span>]=1
<a name="l00064"></a>00064                 <span class="keyword">import</span> sys
<a name="l00065"></a>00065                 <span class="keyword">import</span> os
<a name="l00066"></a>00066                 <span class="keywordflow">if</span> env[<span class="stringliteral">'WINDOWS'</span>]: 
<a name="l00067"></a>00067                         sys.path.append(<span class="stringliteral">'bksys'</span>+os.sep+<span class="stringliteral">'win32'</span>)
<a name="l00068"></a>00068                         <span class="keyword">from</span> detect_kde4 <span class="keyword">import</span> detect
<a name="l00069"></a>00069                 <span class="keywordflow">else</span>:
<a name="l00070"></a>00070                         sys.path.append(<span class="stringliteral">'bksys'</span>+os.sep+<span class="stringliteral">'unix'</span>)
<a name="l00071"></a>00071                         <span class="keyword">from</span> detect_kde4 <span class="keyword">import</span> detect
<a name="l00072"></a>00072                 detect(env)
<a name="l00073"></a>00073 
<a name="l00074"></a>00074                 dest=open(env.join(env[<span class="stringliteral">'_BUILDDIR_'</span>], <span class="stringliteral">'config-kde.h'</span>), <span class="stringliteral">'w'</span>)
<a name="l00075"></a>00075                 dest.write(<span class="stringliteral">'/* kde configuration */\n'</span>)
<a name="l00076"></a>00076                 dest.write((<span class="stringliteral">'#define KDELIBSUFF "%s"\n'</span>) % env[<span class="stringliteral">'LIBSUFFIXEXT'</span>]);
<a name="l00077"></a>00077                 dest.close()
<a name="l00078"></a>00078                 env[<span class="stringliteral">'_CONFIG_H_'</span>].append(<span class="stringliteral">'kde'</span>)
<a name="l00079"></a>00079                 
<a name="l00080"></a>00080                 env[<span class="stringliteral">'KDE4_ISCONFIGURED'</span>]=1
<a name="l00081"></a>00081                 env[<span class="stringliteral">'UIC3_PRE_INCLUDE'</span>]=<span class="stringliteral">"#include &lt;kdialog.h&gt;\n#include &lt;klocale.h&gt;\n"</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083                 <span class="comment"># (js) update here</span>
<a name="l00084"></a>00084                 opts.Save(cachefile, env)
<a name="l00085"></a>00085                 
<a name="l00086"></a>00086         <span class="keyword">import</span> SCons.Defaults
<a name="l00087"></a>00087         Builder=SCons.Builder.Builder
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         creation_string = <span class="stringliteral">"%screating%s $TARGET.path"</span> % (env[<span class="stringliteral">'BKS_COLORS'</span>][<span class="stringliteral">'BLUE'</span>], env[<span class="stringliteral">'BKS_COLORS'</span>][<span class="stringliteral">'NORMAL'</span>])
<a name="l00090"></a>00090 
<a name="l00091"></a>00091         <span class="comment">## KIDL file</span>
<a name="l00092"></a>00092         <span class="keywordflow">if</span> env[<span class="stringliteral">'WINDOWS'</span>]:
<a name="l00093"></a>00093                 kidl_str=<span class="stringliteral">'$DCOPIDL $SOURCE $TARGET'</span>
<a name="l00094"></a>00094         <span class="keywordflow">else</span>:
<a name="l00095"></a>00095                 kidl_str=<span class="stringliteral">'$DCOPIDL $SOURCE &gt; $TARGET || (rm -f $TARGET ; false)'</span>
<a name="l00096"></a>00096         <span class="keywordflow">if</span> <span class="keywordflow">not</span> env[<span class="stringliteral">'_USECOLORS_'</span>]: creation_string=<span class="stringliteral">""</span>
<a name="l00097"></a>00097         kidl_action=env.Action(kidl_str, creation_string)
<a name="l00098"></a>00098         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'Kidl'</span>]=Builder(action=kidl_action, suffix=<span class="stringliteral">'.kidl'</span>, src_suffix=<span class="stringliteral">'.h'</span>)
<a name="l00099"></a>00099 
<a name="l00100"></a>00100         <span class="comment">## TODO --no-signals (ita)</span>
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         <span class="comment">## DCOP</span>
<a name="l00103"></a>00103         dcop_str=<span class="stringliteral">'$DCOPIDL2CPP --c++-suffix cpp --no-stub $SOURCE'</span>
<a name="l00104"></a>00104         dcop_action=env.Action(dcop_str, creation_string)
<a name="l00105"></a>00105 
<a name="l00106"></a><a class="code" href="namespacekde4.html#a11">00106</a>         <span class="keyword">def </span><a class="code" href="namespacekde4.html#a11">dcopEmitter</a>(target, source, env):
<a name="l00107"></a>00107                 <span class="keyword">import</span> os
<a name="l00108"></a>00108                 adjustixes = SCons.Util.adjustixes
<a name="l00109"></a>00109                 bs = SCons.Util.splitext(str(source[0].name))[0]
<a name="l00110"></a>00110                 bs = os.path.join(str(target[0].get_dir()),bs)
<a name="l00111"></a>00111                 <span class="comment">#target.append(bs+'_skel.h') # not necessary for dcop, right ?</span>
<a name="l00112"></a>00112                 <span class="keywordflow">return</span> target, source
<a name="l00113"></a>00113 
<a name="l00114"></a>00114         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'Dcop'</span>]=Builder(action=dcop_action, suffix=<span class="stringliteral">'_skel.cpp'</span>, src_suffix=<span class="stringliteral">'.kidl'</span>, emitter=dcopEmitter)
<a name="l00115"></a>00115 
<a name="l00116"></a>00116         <span class="comment">## STUB</span>
<a name="l00117"></a>00117         stub_str=<span class="stringliteral">'$DCOPIDL2CPP --c++-suffix cpp --no-skel $SOURCE'</span>
<a name="l00118"></a>00118         stub_action=env.Action(stub_str, creation_string)
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="namespacekde4.html#a12">00120</a>         <span class="keyword">def </span><a class="code" href="namespacekde4.html#a12">stubEmitter</a>(target, source, env):
<a name="l00121"></a>00121                 <span class="keyword">import</span> os
<a name="l00122"></a>00122                 adjustixes = SCons.Util.adjustixes
<a name="l00123"></a>00123                 bs = SCons.Util.splitext(str(source[0].name))[0]
<a name="l00124"></a>00124                 bs = os.path.join(str(target[0].get_dir()),bs)
<a name="l00125"></a>00125                 target.append(bs+<span class="stringliteral">'_stub.h'</span>)
<a name="l00126"></a>00126                 <span class="keywordflow">return</span> target, source
<a name="l00127"></a>00127 
<a name="l00128"></a>00128         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'Stub'</span>]=Builder(action=stub_action, suffix=<span class="stringliteral">'_stub.cpp'</span>, src_suffix=<span class="stringliteral">'.kidl'</span>, emitter=stubEmitter)
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="comment">## DOCUMENTATION</span>
<a name="l00131"></a>00131         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'Meinproc'</span>]=Builder(action=<span class="stringliteral">'$MEINPROC --check --cache $TARGET $SOURCE'</span>,suffix=<span class="stringliteral">'.cache.bz2'</span>)
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="namespacekde4.html#a13">00133</a>         <span class="keyword">def </span><a class="code" href="namespacekde4.html#a13">kcfg_buildit</a>(target, source, env):
<a name="l00134"></a>00134                 comp=<span class="stringliteral">'$KCONFIGCOMPILER -d%s %s %s'</span> % (str(target[0].get_dir()), source[1].path, source[0].path)
<a name="l00135"></a>00135                 <span class="keywordflow">return</span> env.Execute(comp)
<a name="l00136"></a>00136         
<a name="l00137"></a>00137         <span class="keyword">def </span><a class="code" href="namespacekde3.html#a37">kcfg_stringit</a>(target, source, env):
<a name="l00138"></a>00138                 <span class="keywordflow">print</span> <span class="stringliteral">"processing %s to get %s and %s"</span> % (source[0].name, target[0].name, target[1].name)
<a name="l00139"></a>00139                 
<a name="l00140"></a><a class="code" href="namespacekde4.html#a14">00140</a>         <span class="keyword">def </span><a class="code" href="namespacekde4.html#a14">kcfgEmitter</a>(target, source, env):
<a name="l00141"></a>00141                 adjustixes = SCons.Util.adjustixes
<a name="l00142"></a>00142                 bs = SCons.Util.splitext(str(source[0].name))[0]
<a name="l00143"></a>00143                 bs = os.path.join(str(target[0].get_dir()),bs)
<a name="l00144"></a>00144                 <span class="comment"># .h file is already there</span>
<a name="l00145"></a>00145                 target.append(bs+<span class="stringliteral">'.cpp'</span>)
<a name="l00146"></a>00146 
<a name="l00147"></a>00147                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isfile(str(source[0])):
<a name="l00148"></a>00148                         lenv.pprint(<span class="stringliteral">'RED'</span>,<span class="stringliteral">'kcfg file given'</span>+str(source[0])+<span class="stringliteral">' does not exist !'</span>)
<a name="l00149"></a>00149                         <span class="keywordflow">return</span> target, source
<a name="l00150"></a>00150                 kfcgfilename=<span class="stringliteral">""</span>
<a name="l00151"></a>00151                 kcfgFileDeclRx = re.compile(<span class="stringliteral">"^[fF]ile\s*=\s*(.+)\s*$"</span>)
<a name="l00152"></a>00152                 <span class="keywordflow">for</span> line <span class="keywordflow">in</span> file(str(source[0]), <span class="stringliteral">"</span><span class="stringliteral">r").readlines():</span>
<a name="l00153"></a>00153 <span class="stringliteral">                        match = kcfgFileDeclRx.match(line.strip())</span>
<a name="l00154"></a>00154 <span class="stringliteral">                        </span><span class="keywordflow">if</span> match:
<a name="l00155"></a>00155                                 kcfgfilename = match.group(1).strip()
<a name="l00156"></a>00156                                 <span class="keywordflow">break</span>
<a name="l00157"></a>00157                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> kcfgfilename:
<a name="l00158"></a>00158                         <span class="keywordflow">print</span> <span class="stringliteral">'invalid kcfgc file'</span>
<a name="l00159"></a>00159                         <span class="keywordflow">return</span> 0
<a name="l00160"></a>00160                 source.append(  env.join(str(source[0].get_dir()), kcfgfilename)  )
<a name="l00161"></a>00161                 <span class="keywordflow">return</span> target, source
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'Kcfg'</span>]=Builder(action=env.Action(kcfg_buildit,
<a name="l00164"></a>00164                                                                                                           kcfg_stringit),
<a name="l00165"></a>00165                                                                         emitter=kcfgEmitter,
<a name="l00166"></a>00166                                                                         suffix=<span class="stringliteral">'.h'</span>, src_suffix=<span class="stringliteral">'.kcfgc'</span>)
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 
<a name="l00169"></a><a class="code" href="namespacekde4.html#a15">00169</a>         <span class="keyword">def </span><a class="code" href="namespacekde4.html#a15">KDEicon</a>(lenv, icname='*', path='./', restype='KDEICONS', subdir=''):
<a name="l00170"></a>00170                 <span class="stringliteral">"""Installs icons with filenames such as cr22-action-frame.png into</span>
<a name="l00171"></a>00171 <span class="stringliteral">                KDE icon hierachy with names like icons/crystalsvg/22x22/actions/frame.png.</span>
<a name="l00172"></a>00172 <span class="stringliteral">                </span>
<a name="l00173"></a>00173 <span class="stringliteral">                Global KDE icons can be installed simply using env.KDEicon('name').</span>
<a name="l00174"></a>00174 <span class="stringliteral">                The second parameter, path, is optional, and specifies the icons</span>
<a name="l00175"></a>00175 <span class="stringliteral">                location in the source, relative to the SConscript file.</span>
<a name="l00176"></a>00176 <span class="stringliteral">                </span>
<a name="l00177"></a>00177 <span class="stringliteral">                To install icons that need to go under an applications directory (to</span>
<a name="l00178"></a>00178 <span class="stringliteral">                avoid name conflicts, for example), use e.g.</span>
<a name="l00179"></a>00179 <span class="stringliteral">                env.KDEicon('name', './', 'KDEDATA', 'appname/icons')"""</span>
<a name="l00180"></a>00180                 
<a name="l00181"></a>00181                 <span class="keywordflow">if</span> lenv.has_key(<span class="stringliteral">'DUMPCONFIG'</span>):
<a name="l00182"></a>00182                         lenv.add_dump( <span class="stringliteral">"&lt;icondir&gt;\n"</span> )
<a name="l00183"></a>00183                         lenv.add_dump( <span class="stringliteral">"    &lt;icondirent dir=\"%s\" subdir=\"%s\"/&gt;\n"</span> % (reldir(path), subdir) )
<a name="l00184"></a>00184                         lenv.add_dump( <span class="stringliteral">"&lt;/icondir&gt;\n"</span> )
<a name="l00185"></a>00185                         <span class="keywordflow">return</span>
<a name="l00186"></a>00186 
<a name="l00187"></a>00187                 type_dic = { <span class="stringliteral">'action'</span>:<span class="stringliteral">'actions'</span>, <span class="stringliteral">'app'</span>:<span class="stringliteral">'apps'</span>, <span class="stringliteral">'device'</span>:<span class="stringliteral">'devices'</span>,
<a name="l00188"></a>00188                                          <span class="stringliteral">'filesys'</span>:<span class="stringliteral">'filesystems'</span>, <span class="stringliteral">'mime'</span>:<span class="stringliteral">'mimetypes'</span> }
<a name="l00189"></a>00189                 dir_dic = {
<a name="l00190"></a>00190                         <span class="stringliteral">'los'</span>  :<span class="stringliteral">'locolor/16x16'</span>, <span class="stringliteral">'lom'</span>  :<span class="stringliteral">'locolor/32x32'</span>,
<a name="l00191"></a>00191                         <span class="stringliteral">'him'</span>  :<span class="stringliteral">'hicolor/32x32'</span>, <span class="stringliteral">'hil'</span>  :<span class="stringliteral">'hicolor/48x48'</span>,
<a name="l00192"></a>00192                         <span class="stringliteral">'lo16'</span> :<span class="stringliteral">'locolor/16x16'</span>, <span class="stringliteral">'lo22'</span> :<span class="stringliteral">'locolor/22x22'</span>, <span class="stringliteral">'lo32'</span> :<span class="stringliteral">'locolor/32x32'</span>,
<a name="l00193"></a>00193                         <span class="stringliteral">'hi16'</span> :<span class="stringliteral">'hicolor/16x16'</span>, <span class="stringliteral">'hi22'</span> :<span class="stringliteral">'hicolor/22x22'</span>, <span class="stringliteral">'hi32'</span> :<span class="stringliteral">'hicolor/32x32'</span>,
<a name="l00194"></a>00194                         <span class="stringliteral">'hi48'</span> :<span class="stringliteral">'hicolor/48x48'</span>, <span class="stringliteral">'hi64'</span> :<span class="stringliteral">'hicolor/64x64'</span>, <span class="stringliteral">'hi128'</span>:<span class="stringliteral">'hicolor/128x128'</span>,
<a name="l00195"></a>00195                         <span class="stringliteral">'hisc'</span> :<span class="stringliteral">'hicolor/scalable'</span>,
<a name="l00196"></a>00196                         <span class="stringliteral">'cr16'</span> :<span class="stringliteral">'crystalsvg/16x16'</span>, <span class="stringliteral">'cr22'</span> :<span class="stringliteral">'crystalsvg/22x22'</span>, <span class="stringliteral">'cr32'</span> :<span class="stringliteral">'crystalsvg/32x32'</span>,
<a name="l00197"></a>00197                         <span class="stringliteral">'cr48'</span> :<span class="stringliteral">'crystalsvg/48x48'</span>, <span class="stringliteral">'cr64'</span> :<span class="stringliteral">'crystalsvg/64x64'</span>, <span class="stringliteral">'cr128'</span>:<span class="stringliteral">'crystalsvg/128x128'</span>,
<a name="l00198"></a>00198                         <span class="stringliteral">'crsc'</span> :<span class="stringliteral">'crystalsvg/scalable'</span>
<a name="l00199"></a>00199                         }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201                 iconfiles = []
<a name="l00202"></a>00202                 dir=SCons.Node.FS.default_fs.Dir(path).srcnode()
<a name="l00203"></a>00203                 mydir=SCons.Node.FS.default_fs.Dir(<span class="stringliteral">'.'</span>)
<a name="l00204"></a>00204                 <span class="keyword">import</span> glob
<a name="l00205"></a>00205                 <span class="keywordflow">for</span> ext <span class="keywordflow">in</span> [<span class="stringliteral">'png'</span>, <span class="stringliteral">'xpm'</span>, <span class="stringliteral">'mng'</span>, <span class="stringliteral">'svg'</span>, <span class="stringliteral">'svgz'</span>]:
<a name="l00206"></a>00206                         files = glob.glob(str(dir)+<span class="stringliteral">'/'</span>+<span class="stringliteral">'*-*-%s.%s'</span> % (icname, ext))
<a name="l00207"></a>00207                         <span class="keywordflow">for</span> file <span class="keywordflow">in</span> files:
<a name="l00208"></a>00208                                 iconfiles.append( file.replace(mydir.abspath, <span class="stringliteral">''</span>) )
<a name="l00209"></a>00209                 <span class="keywordflow">for</span> iconfile <span class="keywordflow">in</span> iconfiles:
<a name="l00210"></a>00210                         lst = iconfile.split(<span class="stringliteral">'/'</span>)
<a name="l00211"></a>00211                         filename = lst[ len(lst) - 1 ]
<a name="l00212"></a>00212                         tmp = filename.split(<span class="stringliteral">'-'</span>)
<a name="l00213"></a>00213                         <span class="keywordflow">if</span> len(tmp)!=3:
<a name="l00214"></a>00214                                 env.pprint(<span class="stringliteral">'RED'</span>,<span class="stringliteral">'WARNING: icon filename has unknown format: '</span>+iconfile)
<a name="l00215"></a>00215                                 <span class="keywordflow">continue</span>
<a name="l00216"></a>00216                         [icon_dir, icon_type, icon_filename]=tmp
<a name="l00217"></a>00217                         <span class="keywordflow">try</span>:
<a name="l00218"></a>00218                                 basedir=getInstDirForResType(lenv, restype)
<a name="l00219"></a>00219                                 destdir = <span class="stringliteral">'%s/%s/%s/%s/'</span> % (basedir, subdir, dir_dic[icon_dir], type_dic[icon_type])
<a name="l00220"></a>00220                         <span class="keywordflow">except</span> KeyError:
<a name="l00221"></a>00221                                 env.pprint(<span class="stringliteral">'RED'</span>,<span class="stringliteral">'WARNING: unknown icon type: '</span>+iconfile)
<a name="l00222"></a>00222                                 <span class="keywordflow">continue</span>
<a name="l00223"></a>00223                         lenv.bksys_install(destdir, iconfile, icon_filename)
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         header_ext = [<span class="stringliteral">".h"</span>, <span class="stringliteral">".hxx"</span>, <span class="stringliteral">".hpp"</span>, <span class="stringliteral">".hh"</span>]
<a name="l00226"></a>00226 
<a name="l00227"></a><a class="code" href="namespacekde4.html#a16">00227</a>         <span class="keyword">def </span><a class="code" href="namespacekde4.html#a16">KDEfiles</a>(lenv, target, source):
<a name="l00228"></a>00228                 <span class="stringliteral">""" Returns a list of files for scons (handles kde tricks like .skel) </span>
<a name="l00229"></a>00229 <span class="stringliteral">                It also makes custom checks against double includes like : ['file.ui', 'file.cpp']</span>
<a name="l00230"></a>00230 <span class="stringliteral">                (file.cpp is already included because of file.ui) """</span>
<a name="l00231"></a>00231 
<a name="l00232"></a>00232                 src=[]
<a name="l00233"></a>00233                 kcfg_files=[]
<a name="l00234"></a>00234                 other_files=[]
<a name="l00235"></a>00235                 kidl=[]
<a name="l00236"></a>00236 
<a name="l00237"></a>00237                 source_=lenv.make_list(source)
<a name="l00238"></a>00238 
<a name="l00239"></a>00239                 <span class="comment"># For each file, check wether it is a dcop file or not, and create the complete list of sources</span>
<a name="l00240"></a>00240                 <span class="keywordflow">for</span> file <span class="keywordflow">in</span> source_:
<a name="l00241"></a>00241 
<a name="l00242"></a>00242                         sfile=SCons.Node.FS.default_fs.File(str(file))
<a name="l00243"></a>00243                         <span class="comment"># why str(file) ? because ordinal not in range issues (scons bug)</span>
<a name="l00244"></a>00244                         bs  = SCons.Util.splitext(file)[0]
<a name="l00245"></a>00245                         ext = SCons.Util.splitext(file)[1]
<a name="l00246"></a>00246                         <span class="keywordflow">if</span> ext == <span class="stringliteral">'.skel'</span>:
<a name="l00247"></a>00247                                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> bs <span class="keywordflow">in</span> kidl: kidl.append(bs)
<a name="l00248"></a>00248                                 lenv.Dcop(bs+<span class="stringliteral">'.kidl'</span>)
<a name="l00249"></a>00249                                 lenv.Depends(bs+<span class="stringliteral">'_skel.cpp'</span>, lenv[<span class="stringliteral">'DCOPIDL2CPP'</span>])
<a name="l00250"></a>00250                                 src.append(bs+<span class="stringliteral">'_skel.cpp'</span>)
<a name="l00251"></a>00251                         <span class="keywordflow">elif</span> ext == <span class="stringliteral">'.stub'</span>:
<a name="l00252"></a>00252                                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> bs <span class="keywordflow">in</span> kidl: kidl.append(bs)
<a name="l00253"></a>00253                                 lenv.Stub(bs+<span class="stringliteral">'.kidl'</span>)
<a name="l00254"></a>00254                                 lenv.Depends(bs+<span class="stringliteral">'_stub.h'</span>, lenv[<span class="stringliteral">'DCOPIDL2CPP'</span>])
<a name="l00255"></a>00255                                 lenv.Depends(bs+<span class="stringliteral">'_stub.cpp'</span>, lenv[<span class="stringliteral">'DCOPIDL2CPP'</span>])
<a name="l00256"></a>00256                                 src.append(bs+<span class="stringliteral">'_stub.cpp'</span>)
<a name="l00257"></a>00257                         <span class="keywordflow">elif</span> ext == <span class="stringliteral">'.moch'</span>:
<a name="l00258"></a>00258                                 lenv.Moccpp(bs+<span class="stringliteral">'.h'</span>)
<a name="l00259"></a>00259                                 src.append(bs+<span class="stringliteral">'_moc.cpp'</span>)
<a name="l00260"></a>00260                         <span class="keywordflow">elif</span> ext == <span class="stringliteral">'.kcfgc'</span>: 
<a name="l00261"></a>00261                                 name=SCons.Util.splitext(sfile.name)[0]
<a name="l00262"></a>00262                                 hfile=lenv.Kcfg(file)
<a name="l00263"></a>00263                                 cppkcfgfile=sfile.dir.File(bs+<span class="stringliteral">'.cpp'</span>)
<a name="l00264"></a>00264                                 lenv.Depends(bs+<span class="stringliteral">'.cpp'</span>, lenv[<span class="stringliteral">'KCONFIGCOMPILER'</span>])
<a name="l00265"></a>00265                                 src.append(bs+<span class="stringliteral">'.cpp'</span>)
<a name="l00266"></a>00266                         <span class="keywordflow">else</span>:
<a name="l00267"></a>00267                                 src.append(file)
<a name="l00268"></a>00268 
<a name="l00269"></a>00269                 <span class="keywordflow">for</span> base <span class="keywordflow">in</span> kidl:lenv.Kidl(base+<span class="stringliteral">'.h'</span>)
<a name="l00270"></a>00270                 
<a name="l00271"></a>00271                 <span class="comment"># Now check against typical newbie errors</span>
<a name="l00272"></a>00272                 <span class="keywordflow">for</span> file <span class="keywordflow">in</span> kcfg_files:
<a name="l00273"></a>00273                         <span class="keywordflow">for</span> ofile <span class="keywordflow">in</span> other_files:
<a name="l00274"></a>00274                                 <span class="keywordflow">if</span> ofile == file:
<a name="l00275"></a>00275                                         env.pprint(<span class="stringliteral">'RED'</span>,<span class="stringliteral">"WARNING: You have included %s.kcfg and another file of the same prefix"</span>%file)
<a name="l00276"></a>00276                                         <span class="keywordflow">print</span> <span class="stringliteral">"Files generated by kconfig_compiler (settings.h, settings.cpp) must not be included"</span>
<a name="l00277"></a>00277                 <span class="keywordflow">return</span> src
<a name="l00278"></a>00278 
<a name="l00279"></a>00279         <span class="comment">#valid_targets = "program convenience shlib kioslave staticlib".split()</span>
<a name="l00280"></a>00280         <span class="keyword">from</span> SCons.Script.SConscript <span class="keyword">import</span> SConsEnvironment
<a name="l00281"></a><a class="code" href="classkde4_1_1kdeobj.html">00281</a>         <span class="keyword">class </span><a class="code" href="classkde4_1_1kdeobj.html">kdeobj</a>(SConsEnvironment.qt4obj):
<a name="l00282"></a>00282                 <span class="keyword">def </span>__init__(self, val, senv=None):
<a name="l00283"></a>00283                         <span class="keywordflow">if</span> senv: SConsEnvironment.qt4obj.__init__(self, val, senv)
<a name="l00284"></a>00284                         <span class="keywordflow">else</span>: SConsEnvironment.qt4obj.__init__(self, val, env)
<a name="l00285"></a><a class="code" href="classkde4_1_1kdeobj.html#a0">00285</a>                 <span class="keyword">def </span><a class="code" href="classkde4_1_1kdeobj.html#a0">execute</a>(self):
<a name="l00286"></a>00286                         <span class="keywordflow">if</span> self.self.executed: <span class="keywordflow">return</span>
<a name="l00287"></a>00287                         <span class="keywordflow">if</span> self.self.orenv.has_key(<span class="stringliteral">'DUMPCONFIG'</span>):
<a name="l00288"></a>00288                                 self.self.executed=1
<a name="l00289"></a>00289                                 self.<a class="code" href="classkde4_1_1kdeobj.html#a1">xml</a>()
<a name="l00290"></a>00290                                 <span class="keywordflow">return</span>
<a name="l00291"></a>00291                         <span class="keywordflow">if</span> self.self.type==<span class="stringliteral">'shlib'</span>:
<a name="l00292"></a>00292                                 self.self.instdir=self.self.orenv.getInstDirForResType(<span class="stringliteral">'KDELIB'</span>)
<a name="l00293"></a>00293                         <span class="keywordflow">elif</span> self.self.type==<span class="stringliteral">'kioslave'</span>:
<a name="l00294"></a>00294                                 self.self.instdir=self.self.orenv.getInstDirForResType(<span class="stringliteral">'KDELIB'</span>)
<a name="l00295"></a>00295                                 self.self.libprefix=<span class="stringliteral">''</span>
<a name="l00296"></a>00296                         <span class="keywordflow">elif</span> self.self.type==<span class="stringliteral">'module'</span>:
<a name="l00297"></a>00297                                 self.self.instdir=self.self.orenv.getInstDirForResType(<span class="stringliteral">'KDEMODULE'</span>)
<a name="l00298"></a>00298                                 self.self.libprefix=<span class="stringliteral">''</span>
<a name="l00299"></a>00299                         <span class="keywordflow">elif</span> self.self.type==<span class="stringliteral">'program'</span>:
<a name="l00300"></a>00300                                 self.self.instdir=self.self.orenv.getInstDirForResType(<span class="stringliteral">'KDEBIN'</span>)
<a name="l00301"></a>00301                                 self.self.perms=0755
<a name="l00302"></a>00302 
<a name="l00303"></a>00303                         self.self.env=self.self.orenv.Copy()
<a name="l00304"></a>00304 
<a name="l00305"></a>00305                         self.self.source = KDEfiles(self.self.env, self.self.joinpath(self.self.target), self.self.joinpath(self.self.source))
<a name="l00306"></a>00306                         SConsEnvironment.qt4obj.execute(self)
<a name="l00307"></a>00307 
<a name="l00308"></a><a class="code" href="classkde4_1_1kdeobj.html#a1">00308</a>                 <span class="keyword">def </span><a class="code" href="classkde4_1_1kdeobj.html#a1">xml</a>(self):
<a name="l00309"></a>00309                         dirprefix = reldir(<span class="stringliteral">'.'</span>)
<a name="l00310"></a>00310                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> dirprefix: dirprefix=self.self.dirprefix
<a name="l00311"></a>00311                         ret=<span class="stringliteral">'&lt;compile type="%s" dirprefix="%s" target="%s" cxxflags="%s" cflags="%s" includes="%s" linkflags="%s" libpaths="%s" libs="%s" vnum="%s" libprefix="%s"&gt;\n'</span> % (self.self.type, dirprefix, self.self.target, self.self.cxxflags, self.self.cflags, self.self.includes, self.self.linkflags, self.self.libpaths, self.self.libs, self.self.vnum, self.self.libprefix)
<a name="l00312"></a>00312                         <span class="keywordflow">if</span> self.self.source:
<a name="l00313"></a>00313                                 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> self.self.orenv.make_list(self.self.source): ret+=<span class="stringliteral">'    &lt;source file="%s"/&gt;\n'</span> % i
<a name="l00314"></a>00314                         ret+=<span class="stringliteral">"&lt;/compile&gt;\n"</span>
<a name="l00315"></a>00315                         self.self.orenv.add_dump(ret)
<a name="l00316"></a>00316 
<a name="l00317"></a>00317         <span class="keyword">from</span> SCons.Script.SConscript <span class="keyword">import</span> SConsEnvironment
<a name="l00318"></a>00318         SConsEnvironment.KDEicon = KDEicon
<a name="l00319"></a>00319         SConsEnvironment.kdeobj = kdeobj
<a name="l00320"></a>00320 
<a name="l00321"></a><a class="code" href="classkde4_1_1kdeinitobj.html">00321</a>         <span class="keyword">class </span><a class="code" href="classkde4_1_1kdeinitobj.html">kdeinitobj</a>(<a class="code" href="classkde4_1_1kdeobj.html">kdeobj</a>):
<a name="l00322"></a>00322                 <span class="keyword">def </span>__init__(self, senv=None):
<a name="l00323"></a>00323                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> senv:
<a name="l00324"></a>00324                                 senv = env
<a name="l00325"></a>00325                         SConsEnvironment.kdeobj.__init__(self, <span class="stringliteral">'shlib'</span>, senv)
<a name="l00326"></a>00326                 
<a name="l00327"></a>00327                         <span class="keywordflow">if</span> env[<span class="stringliteral">'WINDOWS'</span>]:
<a name="l00328"></a><a class="code" href="classkde4_1_1kdeinitobj.html#o0">00328</a>                                 self.<a class="code" href="classkde4_1_1kdeinitobj.html#o0">type</a> = <span class="stringliteral">'program'</span>
<a name="l00329"></a>00329                         <span class="keywordflow">else</span>:
<a name="l00330"></a><a class="code" href="classkde4_1_1kdeinitobj.html#o1">00330</a>                                 self.<a class="code" href="classkde4_1_1kdeinitobj.html#o1">binary</a> = kdeobj(<span class="stringliteral">'program'</span>, senv)
<a name="l00331"></a>00331                                 self.<a class="code" href="classkde4_1_1kdeinitobj.html#o1">binary</a>.libprefix = <span class="stringliteral">''</span>
<a name="l00332"></a><a class="code" href="classkde4_1_1kdeinitobj.html#o2">00332</a>                                 self.<a class="code" href="classkde4_1_1kdeinitobj.html#o2">kdeinitlib</a> = kdeobj(<span class="stringliteral">'shlib'</span>, senv)
<a name="l00333"></a>00333                                 self.<a class="code" href="classkde4_1_1kdeinitobj.html#o2">kdeinitlib</a>.libprefix = <span class="stringliteral">''</span>
<a name="l00334"></a>00334 
<a name="l00335"></a><a class="code" href="classkde4_1_1kdeinitobj.html#a0">00335</a>                 <span class="keyword">def </span><a class="code" href="classkde4_1_1kdeinitobj.html#a0">execute</a>(self):
<a name="l00336"></a>00336                         <span class="keywordflow">if</span> self.self.executed: <span class="keywordflow">return</span>
<a name="l00337"></a>00337 
<a name="l00338"></a>00338                         <span class="keywordflow">if</span> env[<span class="stringliteral">'WINDOWS'</span>]:
<a name="l00339"></a>00339                                 SConsEnvironment.kdeobj.execute(self)
<a name="l00340"></a>00340                                 <span class="keywordflow">return</span>
<a name="l00341"></a>00341         
<a name="l00342"></a>00342                         <span class="comment"># 'dcopserver' is the real one</span>
<a name="l00343"></a>00343                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o1">binary</a>.target   = self.self.target
<a name="l00344"></a>00344                         <span class="comment"># 'libkdeinit_dcopserver'</span>
<a name="l00345"></a>00345                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o2">kdeinitlib</a>.target = <span class="stringliteral">'libkdeinit_'</span> + self.self.target
<a name="l00346"></a>00346                         <span class="comment"># 'dcopserver' (lib)</span>
<a name="l00347"></a>00347                         
<a name="l00348"></a>00348                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o2">kdeinitlib</a>.libs     = self.self.libs
<a name="l00349"></a>00349                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o2">kdeinitlib</a>.libpaths = self.self.libpaths
<a name="l00350"></a>00350                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o2">kdeinitlib</a>.uselib   = self.self.uselib
<a name="l00351"></a>00351                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o2">kdeinitlib</a>.source   = self.self.source
<a name="l00352"></a>00352                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o2">kdeinitlib</a>.execute()
<a name="l00353"></a>00353                                         
<a name="l00354"></a>00354                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o1">binary</a>.uselib       = self.self.uselib
<a name="l00355"></a>00355                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o1">binary</a>.libs         = [self.<a class="code" href="classkde4_1_1kdeinitobj.html#o2">kdeinitlib</a>.target + <span class="stringliteral">".la"</span>] + self.self.orenv.make_list(self.self.libs)
<a name="l00356"></a>00356                         <span class="comment">#self.binary.libdirs      = "build/dcop"</span>
<a name="l00357"></a>00357                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o1">binary</a>.libpaths     = self.self.libpaths
<a name="l00358"></a>00358                         env.Depends(self.<a class="code" href="classkde4_1_1kdeinitobj.html#o1">binary</a>.target, self.<a class="code" href="classkde4_1_1kdeinitobj.html#o2">kdeinitlib</a>.target + <span class="stringliteral">".la"</span>)
<a name="l00359"></a>00359 
<a name="l00360"></a>00360                         myname=<span class="keywordtype">None</span>
<a name="l00361"></a>00361                         myext=<span class="keywordtype">None</span>
<a name="l00362"></a>00362                         <span class="keywordflow">for</span> source <span class="keywordflow">in</span> self.<a class="code" href="classkde4_1_1kdeinitobj.html#o2">kdeinitlib</a>.source:
<a name="l00363"></a>00363                                 sext=SCons.Util.splitext(source)
<a name="l00364"></a>00364                                 <span class="keywordflow">if</span> sext[0] == self.self.target <span class="keywordflow">or</span> <span class="keywordflow">not</span> myname:
<a name="l00365"></a>00365                                         myname = sext[0]
<a name="l00366"></a>00366                                         myext  = sext[1]
<a name="l00367"></a>00367                                         
<a name="l00368"></a>00368                         <span class="keyword">def </span>create_kdeinit_cpp(target, source, env):
<a name="l00369"></a>00369                                 <span class="stringliteral">""" Creates the dummy kdemain file for the binary"""</span>
<a name="l00370"></a>00370                                 dest=open(target[0].path, <span class="stringliteral">'w'</span>)
<a name="l00371"></a>00371                                 dest.write(<span class="stringliteral">'extern \"C\" int kdemain(int, char* []);\n'</span>)
<a name="l00372"></a>00372                                 dest.write(<span class="stringliteral">'int main( int argc, char* argv[] ) { return kdemain(argc, argv); }\n'</span>)
<a name="l00373"></a>00373                                 dest.close()
<a name="l00374"></a>00374                         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'KdeinitCpp'</span>] = env.Builder(action=env.Action(create_kdeinit_cpp),
<a name="l00375"></a>00375                                                                                                                 prefix=<span class="stringliteral">'kdeinit_'</span>, suffix=<span class="stringliteral">'.cpp'</span>,
<a name="l00376"></a>00376                                                                                                                 src_suffix=myext)
<a name="l00377"></a>00377                         env.KdeinitCpp(myname)
<a name="l00378"></a>00378                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o1">binary</a>.source = <span class="stringliteral">"./kdeinit_"</span> + myname + <span class="stringliteral">'.cpp'</span>
<a name="l00379"></a>00379                         self.<a class="code" href="classkde4_1_1kdeinitobj.html#o1">binary</a>.execute()
<a name="l00380"></a>00380 
<a name="l00381"></a>00381                         <span class="keyword">def </span>create_kdeinit_la_cpp(target, source, env):
<a name="l00382"></a>00382                                 <span class="stringliteral">""" Creates the dummy kdemain file for the module"""</span>
<a name="l00383"></a>00383                                 dest=open(target[0].path, <span class="stringliteral">'w'</span>)
<a name="l00384"></a>00384                                 dest.write(<span class="stringliteral">'#include &lt;kdemacros.h&gt;\n'</span>)
<a name="l00385"></a>00385                                 dest.write(<span class="stringliteral">'extern \"C\" int kdemain(int, char* []);\n'</span>)
<a name="l00386"></a>00386                                 dest.write(<span class="stringliteral">'extern \"C\" KDE_EXPORT int kdeinitmain( int argc, char* argv[] ) { return kdemain(argc, argv); }\n'</span>)
<a name="l00387"></a>00387                                 dest.close()
<a name="l00388"></a>00388                         env[<span class="stringliteral">'BUILDERS'</span>][<span class="stringliteral">'KdeinitLaCpp'</span>] = env.Builder(action=env.Action(create_kdeinit_la_cpp),
<a name="l00389"></a>00389                                                                                                                   prefix=<span class="stringliteral">'kdeinit_'</span>, suffix=<span class="stringliteral">'.la.cpp'</span>,
<a name="l00390"></a>00390                                                                                                                   src_suffix=myext)
<a name="l00391"></a>00391                         env.KdeinitLaCpp(myname)
<a name="l00392"></a>00392                         self.self.source = <span class="stringliteral">'kdeinit_'</span> + self.self.target + <span class="stringliteral">'.la.cpp'</span>
<a name="l00393"></a>00393                         <span class="comment"># TODO scons clean?</span>
<a name="l00394"></a>00394                                                 
<a name="l00395"></a>00395                         SConsEnvironment.kdeobj.execute(self)
<a name="l00396"></a>00396                 
<a name="l00397"></a>00397         SConsEnvironment.kdeinitobj = kdeinitobj
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         <span class="comment"># (js) apply KDE***FLAGS</span>
<a name="l00400"></a>00400         <span class="keywordflow">if</span> env.has_key(<span class="stringliteral">'KDECCFLAGS'</span>):
<a name="l00401"></a>00401                 env.AppendUnique( CCFLAGS = env[<span class="stringliteral">'KDECCFLAGS'</span>] )
<a name="l00402"></a>00402         <span class="keywordflow">if</span> env.has_key(<span class="stringliteral">'KDECXXFLAGS'</span>):
<a name="l00403"></a>00403                 env.AppendUnique( CPPFLAGS = env[<span class="stringliteral">'KDECXXFLAGS'</span>] )
<a name="l00404"></a>00404                 env.AppendUnique( CXXFLAGS = env[<span class="stringliteral">'KDECXXFLAGS'</span>] )
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Oct 23 01:55:16 2005 for BKSYS - Build Kde SYStem by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
