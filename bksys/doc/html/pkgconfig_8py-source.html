<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>BKSYS - Build Kde SYStem: pkgconfig.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>pkgconfig.py</h1><a href="pkgconfig_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacepkgconfig.html">00001</a> <span class="comment"># Copyright Thomas Nagy 2005</span>
<a name="l00002"></a>00002 <span class="comment"># BSD license (see COPYING)</span>
<a name="l00003"></a><a class="code" href="namespacepkgconfig.html#a0">00003</a> <span class="keyword">def </span><a class="code" href="namespacepkgconfig.html#a0">exists</a>(env):
<a name="l00004"></a>00004         <span class="keywordflow">return</span> true
<a name="l00005"></a>00005 
<a name="l00006"></a><a class="code" href="namespacepkgconfig.html#a1">00006</a> <span class="keyword">def </span><a class="code" href="namespacepkgconfig.html#a1">generate</a>(env):
<a name="l00007"></a>00007         <span class="keyword">import</span> SCons.Util, os
<a name="l00008"></a>00008 
<a name="l00009"></a>00009         <span class="comment"># This funtion detects pkg-config</span>
<a name="l00010"></a>00010         <span class="keyword">from</span> SCons.Script.SConscript <span class="keyword">import</span> SConsEnvironment
<a name="l00011"></a>00011         <span class="keyword">def </span>Check_pkg_config(context, version):
<a name="l00012"></a>00012 
<a name="l00013"></a>00013                 <span class="keyword">from</span> SCons.Options <span class="keyword">import</span> Options
<a name="l00014"></a>00014                 
<a name="l00015"></a>00015                 optionFile = env[<span class="stringliteral">'CACHEDIR'</span>] + <span class="stringliteral">'pkgconfig.cache.py'</span>
<a name="l00016"></a>00016                 opts = Options(optionFile)
<a name="l00017"></a>00017                 opts.AddOptions((<span class="stringliteral">'CACHE_PKGCONFIG'</span>, <span class="stringliteral">'whether pkg-config was found'</span>))
<a name="l00018"></a>00018                 opts.Update(env)
<a name="l00019"></a>00019 
<a name="l00020"></a>00020                 context.Message(<span class="stringliteral">'Checking for pkg-config ... '</span>)
<a name="l00021"></a>00021                         
<a name="l00022"></a>00022                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> env.has_key(<span class="stringliteral">'CACHE_PKGCONFIG'</span>):
<a name="l00023"></a>00023                         pkg_config_command = <span class="stringliteral">'pkg-config'</span>
<a name="l00024"></a>00024                         <span class="keywordflow">if</span> os.environ.has_key(<span class="stringliteral">"PKG_CONFIG_PATH"</span>):
<a name="l00025"></a>00025                                 pkg_config_command = <span class="stringliteral">"PKG_CONFIG_PATH="</span>+os.environ[<span class="stringliteral">"PKG_CONFIG_PATH"</span>]+<span class="stringliteral">" pkg-config "</span>
<a name="l00026"></a>00026                         ret = context.TryAction(pkg_config_command+<span class="stringliteral">' --atleast-pkgconfig-version=%s'</span> % version)[0]
<a name="l00027"></a>00027                         env[<span class="stringliteral">'CACHE_PKGCONFIG'</span>] = ret
<a name="l00028"></a>00028                         opts.Save(optionFile, env)
<a name="l00029"></a>00029                 <span class="keywordflow">else</span>:
<a name="l00030"></a>00030                         ret = env[<span class="stringliteral">'CACHE_PKGCONFIG'</span>]
<a name="l00031"></a>00031                         
<a name="l00032"></a>00032                 context.Result(ret)
<a name="l00033"></a>00033                 
<a name="l00034"></a>00034                 <span class="keywordflow">return</span> ret
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         <span class="comment"># This function detects a package using pkg-config</span>
<a name="l00037"></a>00037         <span class="keyword">def </span>Check_package(context, pkgname, module, version):
<a name="l00038"></a>00038                 context.Message(<span class="stringliteral">'Checking for %s &gt;= %s ... '</span> % (module, version))
<a name="l00039"></a>00039                 pkg_config_command = <span class="stringliteral">'pkg-config'</span>
<a name="l00040"></a>00040                 <span class="keywordflow">if</span> os.environ.has_key(<span class="stringliteral">"PKG_CONFIG_PATH"</span>):
<a name="l00041"></a>00041                         pkg_config_command = <span class="stringliteral">"PKG_CONFIG_PATH="</span>+os.environ[<span class="stringliteral">"PKG_CONFIG_PATH"</span>]+<span class="stringliteral">" pkg-config "</span>
<a name="l00042"></a>00042                 ret = context.TryAction(pkg_config_command+<span class="stringliteral">' %s --atleast-version=%s'</span> % (module, version))[0]
<a name="l00043"></a>00043                 <span class="keywordflow">if</span> ret:
<a name="l00044"></a>00044                         env.ParseConfig(pkg_config_command+<span class="stringliteral">' %s --cflags --libs'</span> % module);
<a name="l00045"></a>00045                         env[<span class="stringliteral">'CXXFLAGS_'</span>+pkgname] = SCons.Util.CLVar( 
<a name="l00046"></a>00046                                 os.popen(pkg_config_command+<span class="stringliteral">" %s --cflags 2&gt;/dev/null"</span> % module).read().strip() );
<a name="l00047"></a>00047                         env[<span class="stringliteral">'LINKFLAGS_'</span>+pkgname] = SCons.Util.CLVar( 
<a name="l00048"></a>00048                                         os.popen(pkg_config_command+<span class="stringliteral">" %s --libs 2&gt;/dev/null"</span> % module).read().strip() );
<a name="l00049"></a>00049                 context.Result(ret)
<a name="l00050"></a>00050                 <span class="keywordflow">return</span> ret
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="keyword">def </span>pkgConfig_findPackage(env, pkgname, module, version):
<a name="l00053"></a>00053                 <span class="keywordflow">if</span> env[<span class="stringliteral">'WINDOWS'</span>]:
<a name="l00054"></a>00054                         <span class="keywordflow">return</span> 0 <span class="comment">#pkgConfig_findPackage() doesn't work on win32, why? (js)</span>
<a name="l00055"></a>00055                 <span class="keyword">from</span> SCons.Options <span class="keyword">import</span> Options
<a name="l00056"></a>00056 
<a name="l00057"></a>00057                 optionFile = env[<span class="stringliteral">'CACHEDIR'</span>] + module + <span class="stringliteral">'.cache.py'</span>
<a name="l00058"></a>00058                 opts = Options(optionFile)
<a name="l00059"></a>00059                 opts.AddOptions(
<a name="l00060"></a>00060                                 (<span class="stringliteral">'CACHED_'</span>+pkgname, <span class="stringliteral">'whether '</span>+pkgname+<span class="stringliteral">' was found'</span>),
<a name="l00061"></a>00061                                 (<span class="stringliteral">'CXXFLAGS_'</span>+pkgname, <span class="stringliteral">'additional compilation flags'</span>),
<a name="l00062"></a>00062                                 (<span class="stringliteral">'LINKFLAGS_'</span>+pkgname, <span class="stringliteral">'link flags'</span>)
<a name="l00063"></a>00063                                 )
<a name="l00064"></a>00064                 opts.Update(env)
<a name="l00065"></a>00065 
<a name="l00066"></a>00066                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> env.has_key(<span class="stringliteral">'CACHED_'</span>+pkgname):
<a name="l00067"></a>00067                         conf = env.Configure(custom_tests =
<a name="l00068"></a>00068                                              { <span class="stringliteral">'Check_pkg_config'</span> : Check_pkg_config,
<a name="l00069"></a>00069                                                <span class="stringliteral">'Check_package'</span> : Check_package }
<a name="l00070"></a>00070                                              )
<a name="l00071"></a>00071 
<a name="l00072"></a>00072                         <span class="keywordflow">if</span> env.has_key(<span class="stringliteral">'CXXFLAGS_'</span>+pkgname):  env.__delitem__(<span class="stringliteral">'CXXFLAGS_'</span>+pkgname)
<a name="l00073"></a>00073                         <span class="keywordflow">if</span> env.has_key(<span class="stringliteral">'LINKFLAGS_'</span>+pkgname): env.__delitem__(<span class="stringliteral">'LINKFLAGS_'</span>+pkgname)
<a name="l00074"></a>00074 
<a name="l00075"></a>00075                         <span class="keywordflow">if</span> <span class="keywordflow">not</span> env.has_key(<span class="stringliteral">'CACHE_PKGCONFIG'</span>):
<a name="l00076"></a>00076                                 <span class="keywordflow">if</span> <span class="keywordflow">not</span> conf.Check_pkg_config(<span class="stringliteral">'0.15'</span>):
<a name="l00077"></a>00077                                         <span class="keywordflow">print</span> <span class="stringliteral">'pkg-config &gt;= 0.15 not found.'</span>
<a name="l00078"></a>00078                                         env.Exit(1)
<a name="l00079"></a>00079 
<a name="l00080"></a>00080                         haveModule = conf.Check_package(pkgname, module, version)
<a name="l00081"></a>00081                         env = conf.Finish()
<a name="l00082"></a>00082 
<a name="l00083"></a>00083                         env[<span class="stringliteral">'CACHED_'</span>+pkgname] = haveModule
<a name="l00084"></a>00084 
<a name="l00085"></a>00085                         opts.Save(optionFile, env)
<a name="l00086"></a>00086                 <span class="keywordflow">else</span>:
<a name="l00087"></a>00087                         haveModule = env[<span class="stringliteral">'CACHED_'</span>+pkgname]
<a name="l00088"></a>00088                         
<a name="l00089"></a>00089                 <span class="keywordflow">return</span> haveModule
<a name="l00090"></a>00090 
<a name="l00091"></a>00091         SConsEnvironment.pkgConfig_findPackage = pkgConfig_findPackage
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Oct 23 01:55:16 2005 for BKSYS - Build Kde SYStem by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
