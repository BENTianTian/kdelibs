#! /bin/sh

if test -z "$KDB2HTML_UNINSTALLED"; then
prefix=@prefix@
exec_prefix=@exec_prefix@
ksgmldir=@kde_datadir@/ksgmltools
else
ksgmldir=$KDB2HTML_UNINSTALLED
fi

CATALOG=$ksgmldir/catalog
DB_STYLESHEET=$ksgmldir/stylesheets/kde.dsl

output=HTML
TMPDIR=DBTOHTML_OUTPUT_DIR$$

if [ ! $# = 1 ]
then
  echo "Usage: `basename $0` [filename.docbook]" >&2
  exit 1
fi

if [ ! -r $1 ]
then
  echo Cannot read \"$1\".  Exiting. >&2
  exit 1
fi

exit_status=0

mkdir $TMPDIR
SAVE_PWD=`pwd`
(cd $TMPDIR;
  if test -f ../$1; then
    input_file=../$1
  else
    input_file=$1
  fi
  echo jw -c $CATALOG -d ${DB_STYLESHEET}\#html $input_file 
  jw -c $CATALOG -d ${DB_STYLESHEET}\#html $input_file
  exit_status=$?
  cd $SAVE_PWD
)

if [ -d ${output}.junk ]; then
     /bin/rm -rf ${output}.junk
fi
if [ -d ${output} ]; then
    mv $output ${output}.junk
fi
mv ${TMPDIR} $output

exit $exit_status

