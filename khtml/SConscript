#! /usr/bin/env python
#generated from khtml/Makefile.am by am2bksys.py
Import('env')

#FIXME java is optional
env.subdirs("""
""")
env.subdirs('dom')
#java

testkhtml_sources = """
domtreeview.cpp testkhtml.cpp
"""

libkhtml_sources = """
htmlpageinfo.ui3 khtml_events.cpp khtml_ext.cpp khtml_factory.cpp
khtml_iface.cc khtml_iface.skel khtml_pagecache.cpp khtml_part.cpp
khtml_printsettings.cpp khtml_run.cpp khtml_settings.cc khtmlimage.cpp
khtmlview.cpp kjserrordlg.ui3
"""

css_sources = """
css/css_base.cpp
css/css_renderstyledeclarationimpl.cpp
css/css_ruleimpl.cpp
css/css_stylesheetimpl.cpp
css/css_valueimpl.cpp
css/csshelper.cpp
css/cssparser.cpp
css/cssstyleselector.cpp
css/parser.cpp
"""

dom_sources = """
dom/css_rule.cpp
dom/css_stylesheet.cpp
dom/css_value.cpp
dom/dom2_events.cpp
dom/dom2_range.cpp
dom/dom2_traversal.cpp
dom/dom2_views.cpp
dom/dom_doc.cpp
dom/dom_element.cpp
dom/dom_misc.cpp
dom/dom_node.cpp
dom/dom_string.cpp
dom/dom_text.cpp
dom/dom_xml.cpp
dom/html_base.cpp
dom/html_block.cpp
dom/html_document.cpp
dom/html_element.cpp
dom/html_form.cpp
dom/html_head.cpp
dom/html_image.cpp
dom/html_inline.cpp
dom/html_list.cpp
dom/html_misc.cpp
dom/html_object.cpp
dom/html_table.cpp
"""

xml_sources = """
xml/dom2_eventsimpl.cpp
xml/dom2_rangeimpl.cpp
xml/dom2_traversalimpl.cpp
xml/dom2_viewsimpl.cpp
xml/dom_docimpl.cpp
xml/dom_elementimpl.cpp
xml/dom_nodeimpl.cpp
xml/dom_stringimpl.cpp
xml/dom_textimpl.cpp
xml/dom_xmlimpl.cpp
xml/xml_tokenizer.cpp
"""

html_sources = """
html/dtd.cpp
html/html_baseimpl.cpp
html/html_blockimpl.cpp
html/html_documentimpl.cpp
html/html_elementimpl.cpp
html/html_formimpl.cpp
html/html_headimpl.cpp
html/html_imageimpl.cpp
html/html_inlineimpl.cpp
html/html_listimpl.cpp
html/html_miscimpl.cpp
html/html_objectimpl.cpp
html/html_tableimpl.cpp
html/htmlparser.cpp
html/htmltokenizer.cpp
html/html_canvasimpl.cpp
"""

render_sources = """
rendering/bidi.cpp
rendering/break_lines.cpp
rendering/counter_tree.cpp
rendering/enumerate.cpp
rendering/font.cpp
rendering/render_arena.cpp
rendering/render_block.cpp
rendering/render_body.cpp
rendering/render_box.cpp
rendering/render_br.cpp
rendering/render_canvas.cpp
rendering/render_canvasimage.cpp
rendering/render_container.cpp
rendering/render_flow.cpp
rendering/render_form.cpp
rendering/render_frames.cpp
rendering/render_generated.cpp
rendering/render_image.cpp
rendering/render_inline.cpp
rendering/render_layer.cpp
rendering/render_line.cpp
rendering/render_list.cpp
rendering/render_object.cpp
rendering/render_replaced.cpp
rendering/render_style.cpp
rendering/render_table.cpp
rendering/render_text.cpp
rendering/table_layout.cpp
"""

misc_sources = """
misc/arena.cpp
misc/decoder.cpp
misc/guess_ja.cpp
misc/helper.cpp
misc/htmlhashes.cpp
misc/loader.cpp
misc/stringit.cpp
"""

imload_sources = """
imload/animprovider.cpp
imload/animtimer.cpp
imload/image.cpp
imload/imagemanager.cpp
imload/imagepainter.cpp
imload/imageplane.cpp
imload/pixmapplane.cpp
imload/rawimageplane.cpp
imload/scaledimageplane.cpp
imload/updater.cpp
imload/decoders/gifloader.cpp
imload/decoders/jpegloader.cpp
imload/decoders/pngloader.cpp
"""

if not env['BUILDERS'].has_key('Hash'):
	env['BUILDERS']['Hash']    = Builder(action="perl #/kjs/create_hash_table $SOURCE -i > $TARGET" ,suffix='.lut.h',src_suffix='.cpp')

for i in "ecma/kjs_context2d.cpp ecma/kjs_dom.cpp ecma/kjs_html.cpp ecma/kjs_css.cpp ecma/kjs_events.cpp ecma/kjs_navigator.cpp ecma/kjs_mozilla.cpp ecma/kjs_range.cpp ecma/kjs_traversal.cpp ecma/kjs_views.cpp ecma/kjs_window.cpp ecma/domparser.cpp ecma/xmlhttprequest.cpp ecma/xmlserializer.cpp".split():
	       env.Hash(i)


kjs_sources = """
ecma/domparser.cpp
ecma/kjs_binding.cpp
ecma/kjs_context2d.cpp
ecma/kjs_css.cpp
ecma/kjs_debugwin.cpp
ecma/kjs_dom.cpp
ecma/kjs_events.cpp
ecma/kjs_html.cpp
ecma/kjs_mozilla.cpp
ecma/kjs_navigator.cpp
ecma/kjs_proxy.cpp
ecma/kjs_range.cpp
ecma/kjs_traversal.cpp
ecma/kjs_views.cpp
ecma/kjs_window.cpp
ecma/xmlhttprequest.cpp
ecma/xmlserializer.cpp
"""

testregression_sources = """
test_regression.cpp test_regression_fontoverload.cpp
"""

khtmlimagepart_sources = """
imgdummy.cpp
"""

testkhtml_static_sources = """
domtreeview.cpp testkhtml.cpp
"""

libkhtmlpart_sources = """
dummy.cpp
"""

include_headers = """
khtml_events.h khtml_part.h khtml_settings.h khtmldefaults.h
khtmlview.h
"""

noinst_headers = """
khtmlpart_p.h
khtml_wallet_p.h
"""

includes = '#/kjs ../kjs #/kimgio java #/dcop misc dom xml html css rendering ecma imload imload/decoders/ #/libltdl #/kio/kssl #/kio/kssl #/kdeprint #/interfaces #/interfaces/kregexpeditor #/kwallet/client #/kutils #/kio/bookmarks '

dummy_cpp = """#include <kdelibs_export.h>
extern "C" KDE_EXPORT void* init_libkhtml(); 
extern "C" KDE_EXPORT void* init_libkhtmlpart() { return init_libkhtml(); }

"""

imgdummy_cpp = """#include <kdelibs_export.h>
extern "C"  KDE_EXPORT void* init_khtmlimagefactory();
extern "C"  KDE_EXPORT void* init_khtmlimagepart() { return init_khtmlimagefactory(); }

"""

fulllibs = 'DCOP kde3support kparts kutils kwalletclient kjs kdeprint'
if not env['WINDOWS']:
	fulllibs += ' kdesu '

fulllibpaths = "../dcop ../kde3support ../kparts ../kutils ../kwallet/client ../kdeprint ../kdesu ../kjs "
fulluselib = 'QT QTCORE QTGUI QTXML QT3SUPPORT KDE4 KDECORE KIO KDEFX KDEUI KJAVA KPARTS THAI PNG JPEG GIF'

env.CreateFile('dummy.cpp', Value(dummy_cpp))
env.CreateFile('imgdummy.cpp', Value(imgdummy_cpp))

obj          = env.kdeobj('shlib')
obj.target   = 'khtml'
obj.vnum     = '6.0.2'
obj.source   = libkhtml_sources+css_sources+dom_sources+imload_sources+misc_sources+render_sources+html_sources+xml_sources+kjs_sources
obj.includes = includes
obj.libs     = fulllibs
obj.libpaths = fulllibpaths
obj.uselib   = fulluselib
if env['WINDOWS']:
	obj.libs     += ' user32 '	# SetWindowPos in khtmlview
obj.execute()

# TODO:  For now ;(
if env['MAC']:
	env.Depends('libkhtml.6.0.2.dylib', '../kjs/libkjs.dylib')
	env.Depends('libkhtml.6.0.2.dylib', '../kparts/libkparts.dylib')
elif env['WINDOWS']:
	pass
#doesn't work	env.Depends('khtml-6.dll', '../kjs/kjs-6.dll')
#doesn't work	env.Depends('khtml-6.dll', '../kparts/kparts-6.dll')
else:
	env.Depends('libkhtml.so.6.0.2', '../kjs/libkjs.so')
	env.Depends('libkhtml.so.6.0.2', '../kparts/libkparts.so')
	env.Depends('khtmlimagepart.so', 'libkhtml.so')

obj = env.kdeobj('module')
obj.target = 'khtmlpart'
obj.source = libkhtmlpart_sources
obj.includes = includes
obj.libs = 'khtml ' + fulllibs
obj.uselib = fulluselib
obj.libpaths = '. ' + fulllibpaths
obj.execute()

obj = env.kdeobj('module')
obj.target = 'khtmlimagepart'
obj.source = khtmlimagepart_sources
obj.includes = includes
obj.libs = 'khtml ' + fulllibs
obj.uselib = fulluselib
obj.libpaths = '. ' + fulllibpaths
obj.execute()


for i in noinst_headers.split():
	env.Moc(i)


env.bksys_insttype( 'KDEAPPS', 'khtml', 'khtml.rc khtml_browser.rc khtml_popupmenu.rc' )

"""Unhandled Defines 
LIBKJAVA = 
DOXYGEN_REFERENCES = kdecore kdeui kio kdefx kparts
EXTRA_DIST = CHANGES DESIGN README.HTMLWidget README.tags
JAVA_SUBDIR = java
CLEANFILES = dummy.cpp
service_DATA = khtml.desktop khtmlimage.desktop
libkhtml_la_METASOURCES = AUTO
servicedir = $(kde_servicesdir)
SUBDIRS = misc dom css xml html rendering pics $(JAVA_SUBDIR) ecma imload . kmultipart
KDE_CXXFLAGS = $(WOVERLOADED_VIRTUAL)
DOXYGEN_EXCLUDE = test*.* html rendering xml misc pics test
testregression_LDADD = libkhtml.la
SRCDOC_DEST = $(kde_htmldir)/en/kdelibs/khtml
testkhtml_static_LDADD = libkhtml.la
testkhtml_LDADD = libkhtml.la
rcdir = $(kde_datadir)/khtml
"""

"""Unhandled Targets 
.PHONY = parser
parser = ###cd $(srcdir) && \###perl scripts/makeattrs && \###bash scripts/maketags && \###bash scripts/makeprop
srcdoc = ###$(mkinstalldirs) $(SRCDOC_DEST)###kdoc -H -d $(SRCDOC_DEST) kdecore \###         $(include_HEADERS) -lqt
"""
