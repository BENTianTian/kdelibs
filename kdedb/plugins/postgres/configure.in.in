dnl =====================
dnl checks for PostgreSQL
dnl =====================

dnl add configure-args

AC_ARG_ENABLE(pgsql, [  --enable-pgsql              build PostgreSQL-plugin [default=yes] ],
              pgsql_plugin=$enableval, pgsql_plugin=yes)

AC_ARG_WITH(pgsqlincdir,
[  --with-pgsql-includes=DIR   use PostgreSQL-includes installed in this directory ],
[
  ac_pgsql_dir=$withval
], ac_pgsql_dir=/usr/local/include
)

AC_ARG_WITH(pgsqllibdir,
[  --with-pgsql-libraries=DIR  use PostgreSQL-libraries installed in this directory ],
[
  ac_pgsql_libdir=$withval
], ac_pgsql_libdir=/usr/local/lib
)

dnl check for PostgreSQL should be compiled
dnl and where headers and libraries are installed
dnl if present compile postgresql-plugin

AC_MSG_CHECKING([for PostgreSQL])

compile_postgresql_plugin="yes"

if test "x$pgsql_plugin" != "xyes"; then
  compile_postgresql_plugin="no"
fi

dnl check header files
pgsql_incdirs="$ac_pgsql_incdir /usr/include /usr/include/pgsql /usr/include/postgresql /usr/local/include"
AC_FIND_FILE(libpq-fe.h, $pgsql_incdirs, pgsql_incdir)
if test ! -r $pgsql_incdir/libpq-fe.h; then
  compile_postgresql_plugin="no"
  AC_MSG_CHECKING("include ")
else
  PG_INCDIR=$pgsql_incdir
  AC_SUBST(PG_INCDIR)
fi

dnl check libraries
pgsql_libdirs="$ac_pgsql_libdir /usr/lib /usr/local/lib"
AC_FIND_FILE(libpq.so, $pgsql_libdirs, pgsql_libdir)
if test ! -r $pgsql_libdir/libpq.so; then
  compile_postgresql_plugin="no"
  AC_MSG_CHECKING("library ")
else
  PG_LIBDIR=$pgsql_libdir
  AC_SUBST(PG_LIBDIR)
fi

if test "$compile_postgresql_plugin" = "yes"; then
  AC_MSG_RESULT([libraries $pgsql_libdir, headers $pgsql_incdir])
  
  KDEDB_PLUGINS="$KDEDB_PLUGINS postgres"
  AC_SUBST(KDEDB_PLUGINS)
else
  AC_MSG_RESULT(not found)
fi
