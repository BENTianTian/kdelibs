<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML Level 2//EN//2.0"> <HTML> <HEAD>
	<TITLE>Guide to Porting Applications to KDE 4.0</TITLE>
</HEAD>
<BODY>

<h2>Note</h2>
Before the changes were made kdelibs has been branched to branches/work/kdelibs4_snapshot. You should use that one if you're not interested in developing kdelibs. Expect trunk/KDE/kdelibs to be broken at any random time (for now).  For the time being other kde modules should not develop against kdelibs, but use the branch.

<H2>Porting Applications to KDE 4.0</H2>
This document contains the changes you have to apply to programs written for
KDE 3.x when you want to port them to KDE 4.0.<P>

As a start you should have a look at doc/porting.doc in the Qt package,
or <a href="http://doc.trolltech.com/4.0/porting4.html">this page online</a>.<P>

<H3><A NAME="TOC">Table of Contents</A></H3>

<UL>
<LI><A HREF="#gettingstarted">Getting Started</A></LI>
<LI><A HREF="#kab">Changes in kab</A></LI>
<LI><A HREF="#kdecore">Changes in kdecore</A></LI>
<LI><A HREF="#kdeui">Changes in kdeui</A></LI>
<LI><A HREF="#kio">Changes in kio</A></LI>
<LI><A HREF="#kparts">Changes in kparts</A></LI>
<LI><A HREF="#kspell">Changes in kspell</A></LI>
<LI><A HREF="#khtmlpart">API-cleanup in KHTML</A></LI>
<LI><A HREF="#kfile">Changes in kfile</A></LI>
<LI><A HREF="#kcontrol">KDE Control Center</A></LI>
<LI><A HREF="#kicker">Panel Applets and Extensions</A></LI>
</UL>

<H3><A NAME="gettingstarted">Getting started</A></H3>

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="kab">Changes in kab</A></H3>


<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="kdecore">Changes in kdecore</A></H3>


<H4>Header file names</H4>
<UL>
  kuniqueapp.h => kuniqueapplication.h
  klargefile.h => kde_file.h
</UL>

<H4>KAccel</H4>
<li>Removed methods that were marked deprecated from KDE2</li>

<H4>KApplication</H4>
<ul>
<li>kapp-&gt;keyboardMouseState() has been removed, its functionality is now provided
by QApplication::keyboardModifiers() and QApplication::mouseButtons()</li>
<li>For using the kiosk restriction/authorization system you have to use the functions provided in KAuthorized now</li>
<li>invoke* has been mobed to ktoolinvocation. there are static methods invoke*, if you want to use slots as before connect to the innvoke* slots of KToolInvocation::self()</li>
<li>startService*, kdeinitExec* -&gt; KToolInvocation</li>
<li> static void addCmdLineOptions(); moveto KCmdLineArgs::addStdCmdLineOptions </li>
<li>kapp-&gt;getDisplay() has been removed, its functionality is now provided
by QX11Info::display()</li>
</ul>


<H4>KCodecs</H4>
<li>All methods using a Q(3)CString removed. The methods use QByteArray (and thus Q3CStrings) now. </li>
<li><b>TODO:</b> Rename header to match classname.</li>

<H4>KLibFactory</H4>

<H4>KMacroExpander</H4>
KMacroExpander now takes a QHash and not a QMap

<H4>NETRootInfo</H4>
<ul>
<li>NETRootInfo(Display *display, Window supportWindow, const char *wmName,unsigned long properties, int screen = -1, bool doActivate = true) -&gt;
    NETRootInfo(Display *display, Window supportWindow, const char *wmName,
                const unsigned long properties[], int properties_size,
                int screen = -1, bool doActivate = true);     old properties is the first element of the new array
</li>
<li>unsigned long supported() -&gt;   const unsigned long* supportedProperties() const;</li>
<li>    unsigned long properties() const -&gt; gone</li>
<li> WindowType windowType() -&gt;     WindowType windowType( unsigned long supported_types ) const;</li>
</ul>

<H4>KDesktopFile</H4>
<p>QString filename() const -> QString fileName() const</p>

<H4>KKey</H4>
<li>The QtWIN enum has been removed.  Use Qt::META or Qt::MetaModifier instead.</li>

<H4>KKeySequence</H4>
<li>Is being phased out.  It was originally created to hold multiple key sequence before
   QKeySequence could support it (Qt 3.0). You should use QKeySequence instead.
   A K3KeySequence convenience class is also available.
</li>

<H4>KKeyNative</H4>
<p>modX(ModFlags) is now a direct function call.  IE, modX(KKey::WIN) -> modXWin()</p>

<H4>KPalette</H4>
<p>color(int), colorName(int) and colorName(const QColor&amp;) have been made const.</p>

<H4>KProcess</h4>
<li>setExecutable() was removed in favor of using operator << </li>
<li>getPid() was removed for just pid()</li>

<H4>KPixmapSplitter</H4>

<H4>KRegExp</H4>
<li>This class has been removed.  Use QRegExp instead</li>

<H4>KShortcut</H4>
<p>Is being phased out.  A K3Shortcut class is available.  Watch here for more
   info.
</p>

<H4>KStringHandler</H4>
<li>static QString ljust( const QString &text , int width ) -&gt; QString::leftJustified</li>
<li>static QString rjust( const QString &text , int width ) -&gt; QString::righttJustified</li>
<li>matchFilename -&gt; matchFileName</li>
<li>static QString word( const QString &text , int pos ) -&gt; QString::section </li>
<li>::randomString() has been moved to KRandom::randomString()</li>

<H4>KStyle</H4>

<H4>KURL</H4>
<li>filename() has been removed, use fileName() instead</li>
<li>isMalformed -&gt; !isValid()

<H4>KURLDrag</H4>
<li>This class has been moved to kde3support. Use KURL::addToMimeData() and
KURL::List::addToMimeData() in the drag/copy side,
and the static methods KURL::List::canDecode() and KURL::List::fromMimeData()
in the drop/paste side.</li>

<H4>KMD5</H4>

<H4>KLocale</H4>
<li> QString formatNumber(const QString &numStr) const -&gt;   QString formatNumber(const QString &numStr, bool round=true, int precision=2) const;
<li> bool weekStartsMonday() const -&gt; int weekStartDay() const
<li> QString monthName(int i, bool shortName = false) const -&gt QString KCalendarSystem::monthName (int month, int year, bool shortName = false) const = 0; or QString KCalendarSystem::monthName (const QDate & date, bool shortName = false ) const = 0;
<li> QString weekDayName(int i, bool shortName = false) const -&gt; calendar()-&gt;weekDayName
<li> QString monthNamePossessive(int i, bool shortName = false) const -&gt; calendar()-&gt;monthNamePossessive()
<li> void setWeekStartsMonday(bool start) -&gt; setWeekStartDay
<li> languages() -&gt; languageList()
<li> formatMoney(const QString &numStr) -&gt   QString formatMoney(double num, const QString & currency = QString::null, int digits = -1) const;
<li> charset() -&gt gone
<li> setCharset() -&gt gone

<H4>KCmdLineArgs</H4>
<li>   static void init(int _argc, char **_argv, const char *_appname, const char *_description, const char *_version, bool noKApp = false) KDE_DEPRECATED; -&gt; static void init(int _argc, char **_argv, const char *_appname, const char* programName, const char *_description, const char *_version, bool noKApp = false);
<li> noKApp parameter is gone, instead:   Q_FLAGS(StdCmdLineArgs)</li>

<H4>KCharsets</H4>
<p>KCharsets::codecForName cannot use glibc's i18n data anymore currently</p>
<p><b>TODO</b>: see which member functions can be removed</p>
<p><b>TODO</b>: simplification of the encoding list tables
   (simply name and description, no need of two tables and an lists of aliases.</p>

<H4>KWin</H4>
<li>appStarted() removed, use KStartupInfo::appStarted() instead</li>
<li>info(WId win) removed, use windowInfo() instead</li>
<li>struct Info was removed, use WindowInfo instead</li>

<H4>KNetwork::KResolver</H4>
<li>the signal finished(KResolverResults) is now finished(const KNetwork::KResolverResults&amp;)</li>

<H4>KVMAllocator</H4>
<p>The two old copy methodes are removed, copyBlock equivalents are renamed to copy</p>

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="kdeui">Changes in kdeui</A></H3>

<H4>KRootPixmap</H4>
<ul>
<li>checkAvailable() -&gt; isAvailable()</li>
</ul>
<H4>KDialogBase><H4>
<li>setButtonOKText -&gt; setButtonOk
<li>setButtonApplyText -&gt; setButtonApply
<li>setButtonCancelText -&gt; setButtonCancel
<li>getBackgroundTile -&gt; backgroundTile
<li>getContentsRect -&gt; gone
<li>getBorderWidths -&gt; gone

<H4>KDatePicker</H4>

<li>signal void dateChanged(QDate); was replaced by void dateChanged( const QDate&amp;);
<li>signal void dateEntered(QDate); was replaced by void dateEntered( const QDate&amp;);
<li>signal void dateEntered(QDate) was replaced by void dateEntered( const QDate&amp;)
<li>removed getData() method.  Use date() instead</li>

<H4>KDockWindow<H4>
<p>This class is obsolete, it is provided for compatibility only.
Use KSystemTray instead.</p>

<H4>KDateWidget</H4>
<li>signal void changed(QDate); was changed by void changed(const QDate&amp;)

<H4>KDateTable</H4>
<li>signal void dateChanged(QDate); was replaced by void dateChanged(const QDate&amp;);

<H4>KMainWindowInterface</H4>
<li>functionsDynamic() now returns a DCOPCStringList
<li>function processDynamic arguments uses DCOPCString instead of QCString :
	   <pre>bool processDynamic(const DCOPCString &amp;fun, const QByteArray &amp;data, DCOPCString&amp; replyType, QByteArray &amp;replyData);</pre>
<li>actions() now returns a DCOPCString

<H4>KMainWindow</H4>
<li>getMemberList() was replaced by memberList() and memberList was renamed to mMemberList and made it private
<li>sizeForCentralWidgetSize(QSize size) returned the size the mainwindow should have so that the central widget will be of size.  You normally don't need this, the recommended way to achieve a certain central widget size is as follows.<br>
 * Override sizeHint() in the central widget so that it returns the desired size.<br>
 * Call updateGeometry() in the central widget whenever the desired size changes. This ensures that the new sizeHint() is properly propagated to any parent layout.<br>
 * Now call adjustSize() in the mainwindow to resize the mainwindow such that the central widget will become the desired size.
</li>

<H4>KAboutDialog</H4>
<li>void setIcon( const QString &amp;fileName ) which was deprecated has been removed
<li>addContainerPage int args are now Qt::Alignment args
<li>addScrolledContainerPage int args are now Qt::Alignment args
<li>addContainer int args are now Qt::Alignment args

<H4>KAboutContainer</H4>
<li>KAboutContainer constructor int args have been replaced by Qt::Alignment
<li>addTitle int args replaced by Qt::Alignment
<li>addImage int args replaced by Qt::Alignment

<H4>KRecentFilesAction</H4>
<li>the maxItem property is now an int (was a uint) (affects all accessors methods)

<H4>KPasswdEdit</H4>
<li>KPasswordEdit(QWidget *parent, const char *name, int echoMode) ; was deprecated

<H4>KPassivePopup</H4>
<li>clicked single now emits a const QPoint refernce</li>

<H4>KPopupMenu</H4>
<li>Renamed to KMenu to reflect change in Qt</li>
<li>indexes replaced by QAction*</li>
<li>title, titlePixmap, and changeTitle removed - use QAction::text(), QAction::icon(), QAction::setText() and QAction::setIcon</li>
<li>contextMenuFocusItem changed to contextMenuFocusAction in line with the change from indexes to actions</li>

<H4>KPopupTitle</H4>
<li>Removed - QMenu doesn't accept widgets, and QAction allows specification of font, icon etc... and gradients / background pixmaps weren't even working in KDE3</li>

<H4>KStatusBar</H4>
<li>The unused BarStatus enum was removed.</li>

<H4>KEditListBox</H4>
<li>void insertStrList(const QStrList* list, int index=-1) and void insertStrList(const QStrList&amp; list, int index=-1) have been deprecated, use QStringList or const char** instead</li>

<H4>KEdit</H4>
<li>The signal gotUrlDrop was removed, nobody used it, and it's easy to do in the application
if needed (see the KURLDrag section)</li>

<H4>KTabBar</H4>
<li>colors, close buttons on individual tabs not working at the moment</li>
<li>The old insertTab and removeTab have been removed, use addTab / insertTab / removeTab from QTabBar instead (uses indices, not QTab*s)</li>

<H4>KTimeWidget</H4>
<li>Removed, use QTimeEdit</H4>

<H4>KNetwork::K*Socket</H4>
<li>readBlock, writeBlock and peekBlock are now called simply read, write and peek</li>
<li>connect() now has an extra parameter (QIODevice::OpenMode)</li>

<H4>KStdAction</H4>
<li>showToolbar() methods have been removed, see KMainWindow::setStandardToolBarMenuEnabled()</li>

<H4>KInputDialog</H4>
<li>static QString KInputDialog::text( const QString &caption,...) was replaced by QString KInputDialog::getText( const QString &caption,...)

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>



<H3><A NAME="kio">Changes in kio</A></H3>

<H4>KRun</H4>
<ul>
<li><the constructor needs a second parameter (a widget) now/li>
</ul>

<H4>RenameDlg</H4>
<li>void b0Pressed() renamed to void cancelPressed()
<li>void b1Pressed() renamed to void renamePressed()
<li>void b2Pressed() renamed to void skipPressed()
<li>void b3Pressed() renamed to void autoSkipPressed()
<li>void b4Pressed() renamed to void overwritePressed()
<li>void b5Pressed() renamed to void overwriteAllPressed()
<li>void b6Pressed() renamed to void resumePressed()
<li>void b7Pressed() renamed to void resumeAllPressed()
<li>void b8Pressed() renamed to void suggestNewNamePressed()

<H4>KFileDialog</H4>
<li>toolbarCallback(int) was removed
<li>pathComboChanged( const QString&amp; ); was removed
<li>void dirCompletion( const QString&amp; ); was removed
<li>void setFilterMimeType(const QString &amp;label, const KMimeType::List &amp;types, const KMimeType::Ptr &amp;defaultType) was removed
<li>void setPreviewWidget(const QWidget *w) was removed

<h4>KFileOpenWithHandler</h4>
<p>This class has been removed.</p>

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="kparts">Changes in kparts</A></H3>


<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="kspell">Changes in kspell</A></H3>

<H4>KSpell</H4>

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="khtmlpart">API-cleanups in KHTML</A></H3>

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>

<H3><A NAME="kfile">Changes in kfile</A></H3>

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>


<p>


<H3><A NAME="kcontrol">Changes in KControl</A></H3>


<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>
<p>

<H3><A NAME="kicker">Panel Applets and Extensions</A></H3>

<H4><P ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></P></H4>
<p>


<p>KDockWidgets -> kde3support K3DockWidget<br>
KParts::DockWindow -> kde3support KParts::DockWindow3<br>
KMDI* --> kdeSupport K3MDI*</p>

<H3>libkmid</H3>
<p>Moved to kdemultimedia, where atm it is only used by kmid.</p>

</BODY>
</HTML>
