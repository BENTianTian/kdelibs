<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><HTML><HEAD>
<TITLE>Guide to Porting Applications to KDE 4.0</TITLE>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
 <!--
body
{
font-family: sans-serif;
color: #000000;
}

h1, h2, h3, h4, h5
{
color: #418ade;
}

a:link
{
color: #0000C0;
text-decoration: none;
}

a:visited
{
color: #800080;
text-decoration: none;
}

a:hover
{
text-decoration: underline;
}
-->
</style>
</HEAD>
<BODY>
<H1>Porting Applications to KDE 4.0</H1>

<h2>Note</h2>
<p>KDE4's kdelibs also exist in branches/work/kdelibs4_snapshot. You should use that one if you're not interested in developing kdelibs. (It will be updated from time to time.) Expect trunk/KDE/kdelibs to be broken at any random time (for now). For the time being other KDE modules should not develop against kdelibs, but use the branch.</p>

<p>This document contains the changes you have to apply to programs written for
KDE 3.x when you want to port them to KDE 4.0.<br>
As a start you should have a look at doc/html/porting4.html in the Qt package,
or <a href="http://doc.trolltech.com/4.1/porting4.html">this page online</a>.</p>

<H3><A NAME="TOC">Table of Contents</A></H3>

<UL>
<LI><A HREF="#gettingstarted">Getting Started</A></LI>
<LI><A HREF="#globalchanges">Global Changes</A></LI>
<LI><A HREF="#kab">Changes in kab</A></LI>
<LI><A HREF="#kdecore">Changes in kdecore</A></LI>
<LI><A HREF="#kdeui">Changes in kdeui</A></LI>
<LI><A HREF="#kio">Changes in kio</A></LI>
<LI><A HREF="#kparts">Changes in kparts</A></LI>
<LI><A HREF="#kded">Changes in kded</A></LI>
<LI><A HREF="#kspell">Changes in kspell</A></LI>
<LI><A HREF="#khtmlpart">API-cleanup in KHTML</A></LI>
<LI><A HREF="#kfile">Changes in kfile</A></LI>
<LI><A HREF="#kcontrol">KDE Control Center</A></LI>
<LI><A HREF="#kicker">Panel Applets and Extensions</A></LI>
<li><a href="#kscreensaver">KScreensaver</a></li>
<li><a href="#i18n">I18N</a></li>
</UL>

<H3><A NAME="gettingstarted">Getting started</A></H3>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>


<H3><A NAME="globalchanges">Global Changes</A></H3>
<ul>
<li>
The "const char *name" arguments in the constructors of QObject derived classes 
have been removed (not of all classes yet). Use setObjectName() instead if the object name is really necessary.
</li>
<li>The define KDE_DEPRECATED must be used now at the start of the declaration
(but still after an eventual "static", "inline" or "virtual" keyword).
KDE_DEPRECATED does not work with constructors, use KDE_CONSTRUCTOR_DEPRECATED
instead.</li>
</ul>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>


<H3><A NAME="kab">Changes in kab</A></H3>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<H3><A NAME="kdecore">Changes in kdecore</A></H3>


<H4>Header file names</H4>
<ul>
<li>kuniqueapp.h =&gt; kuniqueapplication.h</li>
<li>klargefile.h =&gt; kde_file.h</li>
<li>kcatalogue.h =&gt; kcatalog.h</li>
<li>kaccelmanager.h =&gt; kacceleratormanager.h</li>
</ul>


<H4>KCompletion</H4>
<ul>
<li>enableSounds() was removed, use setEnableSounds()</li>
<li>disableSounds() was removed, use setEnableSounds()</li>
</ul>

<H4>KGlobalSettings</H4>
<ul>
<li> deprecated &quot;static QString trashPath()&quot; has been removed. use KIO::trash instead</li>
</ul>

<H4>KAccel</H4>
<ul>
<li>Removed. Replaced by the new KAction/QAction framework.</li>
<li>See KActionCollection::setAssociatedWidget() if you need the old KAccel widget-binding behavior.</li>
</ul>

<H4>KAccelBase</H4>
<ul>
<li>Removed. Replaced by the new KAction/QAction framework.</li>
</ul>

<H4>KAccelAction</H4>
<ul>
<li>Removed. Replaced by the new KAction/QAction framework.</li>
<li>[Old note] KDE3 supported 3 modifier key shortcuts and 4 modifier key (3+META) shortcuts, because earlier versions of Qt3 didn't
    support a META modifier/WIN key.  This is changed, so now all shortcuts can be 4 modifier key.  All instances of
    shortcut3 and shortcut4 have been reduced just to "shortcut".</li>
<li>[Old note] The constructor, init(), and insert() functions now only take only KShortcut "default" argument instead of two</li>
<li>[Old note] Removed shortcutDefault3() and shortcutDefault4().  Use shortcutDefault() instead</li>
</ul>

<H4>KApplication</H4>
<ul>
<li>kapp-&gt;keyboardMouseState() has been removed, its functionality is now provided
by QApplication::keyboardModifiers() and QApplication::mouseButtons()</li>
<li>random() has been moved to the KRandom class</li>
<li>For using the kiosk restriction/authorization system you have to use the functions provided in KAuthorized now</li>
<li>invoke* has been moved to ktoolinvocation. there are static methods invoke*, if you want to use slots as before connect to the innvoke* slots of KToolInvocation::self()</li>
<li>startService*, kdeinitExec* -&gt; KToolInvocation</li>
<li> static void addCmdLineOptions(); moveto KCmdLineArgs::addStdCmdLineOptions </li>
<li>kapp-&gt;getDisplay() has been removed, its functionality is now provided
by QX11Info::display()</li>
<li>cut,copy,paste, clear and selectAll were moved to KStdAction</li>
<li>guiEnabled() was removed, QApplication::type() should be used instead.</li>
<li>geometryArgument was removed, please use:
<pre>
 QString geometry;
 KCmdLineArgs *args = KCmdLineArgs::parsedArgs("kde");
 if (args &amp;&amp; args-&gt;isSet("geometry"))
	geometry = args-&gt;getOption("geometry");
</pre>
</li>
<li>installSigpipeHandler() was removed.</li>
<li>propagateSessionManager() and requestShutDown() have been moved into the kworkspace library (kdebase/workspace/lib).</li>
<li>The shutDown() signal has been removed, use QApplication's signal aboutToQuit()</li>
<li>enableStyles(), disableStyles(), and the constructor argument has been removed.</li>
<li>installKDEPropertyMap has been moved into k3sqlpropertymap.h and renamed to kInstallKDEPropertyMap. It can be used to keep old code that uses the Q3Data* classes working.For new code, use User in the meta object to determine which Q_PROPERTY to use for any widget.
<pre>
  const QMetaObject *metaObject = widget->metaObject();
  for (int i = 0; i < metaObject->propertyCount(); ++i) {
    const QMetaProperty metaProperty = metaObject->property(i);
    if (metaProperty.isUser()) {
      QString propertyToUse = metaProperty.name();
      break;
    }
  }
</pre></li>
<li>caption() has moved to KInstance</li>
<li>makeStdCaption(const QString&, bool, bool) has moved to KInstance and changed signature to makeStdCaption(const QString&, CaptionFlags)</li>
</ul>

<H4>KCatalogue</H4>
<ul>
<li>Has been renamed to KCatalog. Method name parts with "catalogue" have been also renamed to contain "catalog".
</ul>

<H4>KCodecs</H4>
<ul>
<li>All methods using a QCString removed. The methods use QByteArray now. </li>
<li>Header renamed to kcodecs.h</li>
</ul>

<H4>KConfigBackend</H4>
<ul>
<li>Removed filename(), use fileName()</li>
</ul>

<H4>KConfigBase</H4>
<ul>
<li>all read*Entry methods deprecated, use <b>template &lt;typename T&gt; readEntry(key, const T&amp;)</b>. 
This uses QVariant in the background so only types that QVariant can convert to QString work. The use of QVariant allows some ambiguous conversions, so it might be necessary to use <em>explicit</em> construction to disambiguate the type wanted, i.e.
 <ul>
		 <li>bool var = readEntry(key, <b>false</b>);</li>
		 <li>int var = readEntry(key, <b>int(SomeEnumValue)</b>);</li>
                 <li>QColor var = readEntry(key, QColor(<b>Qt::black</b>)); // no conversion from Qt::GlobalColor to QVariant
		 <li>long var = readEntry(key, <b>0</b>); // conversion from long to QVariant is ambiguous, so can't use <b>long(0)</b>.</li>
 </ul>
</li>
<li>readEntry(const QString&amp;, const QString&amp;) no longer has a default argument, add QString() as
second argument.
</li>
<li>all writeEntry* methods removed, mostly not noticeable, but some types don't automatically convert
to QVariant. You need to cast to a type that is directly convertible to QVariant. i.e.
<pre>
time_t timeVal;
writeEntry("someKey", timeVal); // ambiguous conversion
writeEntry("someKey", int(timeVal)); // ok
</pre>
</li>
<li>all read*ListEntry methods deprecated, renamed to readEntry. Most types use the template version.<br/>
<b>template &lt;typename T&gt; readEntry(key, const QList&lt;T&gt;&amp;)</b><br/>If you just write readEntry(key, list) it should work for any type that QVariant can convert to QString.
</li>
<li>writeEntry, deleteGroup, and deleteEntry do not take several boolean options (persistent,global,localized) anymore, but instead one QFlags</li>
</ul>
<H4>KLibFactory</H4>

<H4>KMacroExpander</H4>
<ul>
<li>KMacroExpander now takes a QHash and not a QMap</li>
</ul>

<H4>NETRootInfo</H4>
<ul>
<li>NETRootInfo(Display *display, Window supportWindow, const char *wmName,unsigned long properties, int screen = -1, bool doActivate = true) -&gt;
    NETRootInfo(Display *display, Window supportWindow, const char *wmName,
                const unsigned long properties[], int properties_size,
                int screen = -1, bool doActivate = true);     old properties is the first element of the new array
</li>
<li>unsigned long supported() -&gt;   const unsigned long* supportedProperties() const;</li>
<li>    unsigned long properties() const -&gt; gone</li>
<li> WindowType windowType() -&gt;     WindowType windowType( unsigned long supported_types ) const;</li>
</ul>

<H4>KDesktopFile</H4>
<ul>
<li>QString filename() const -&gt; QString fileName() const</li>
<li>more standards compliant. See
<a href="http://www.freedesktop.org/Standards/desktop-entry-spec/latest">
Desktop Entry Spec</a>
 <ul>
  <li>.kdelnk files are no longer supported, rename to .desktop.</li>
  <li>deprecated header [KDE Desktop Entry], change to [Desktop Entry]</li>
  <li>type FSDev is no longer supported, change to FSDevice</li>
 </ul>
</li>
</ul>

<H4>KExtendedSocket</H4>
<ul>
<li>This class has been removed. Use KNetwork::KStreamSocket or KNetwork::KServerSocket instead.</li>
</ul>

<H4>KGlobalAccel</H4>
<ul>
<li>bool useFourModifierKeys() has been removed (we always use four modifier keys now).</li>
<li>Now a singleton</li>
<li>You shouldn't need to access this class much... just use setGlobalShortcut() in KAction.</li>
</ul>

<H4>KKey</H4>
<ul>
<li>Removed. Use plain ints as the Qt key code instead.</li>
<li>When replacing KKey(QKeyEvent*), you need to OR the event->key() and event->modifiers() to get the replacement.</li>
<li>The QtWIN enum has been removed.  Use Qt::META or Qt::MetaModifier instead.</li>
<li>modFlagLabel() was removed, use either KKeyServer::modToStringUser(), or QKeySequence(Qt::yourmodifier).toString()</li>
</ul>

<H4>KKeySequence</H4>
<ul>
<li>Removed, use QKeySequence instead.</li>
<li>Note that QKeySequence expects multiple shortcuts to be separated by ", " (ie a comma then a space) in converting from text.</li>
</ul>

<H4>KKeyNative</H4>
<ul>
<li>Removed. Use plain ints as the Qt key code instead.</li>
</ul>

<H4>KNotifyClient</H4>
<ul><li>Replaced by KNotification.  The API is quite similar, but the config file need to be updated. See KNotification documentation</li></ul>

<H4>KPalette</H4>
<ul>
<li>color(int), colorName(int) and colorName(const QColor&amp;) have been made const.</li>
</ul>

<H4>KProcess</h4>
<ul>
<li>setExecutable() was removed in favor of using operator &lt;&lt; </li>
<li>getPid() was removed for just pid()</li>
</ul>

<H4>KPixmapSplitter</H4>

<H4>KRegExp</H4>
<ul>
<li>This class has been removed.  Use QRegExp instead</li>
</ul>

<H4>KSaveFile</H4>
<ul>
<li>KSaveFile has been modified from its KDE 3.x behavior to allow for new backup methods:</li>
<li>KSaveFile::backupFile() will use the backup behavior specified in KConfig.</li>
<li>KSaveFile::simpleBackupFile() will emulate the KDE 3.x behavior</li>
<li>KSaveFile::numberedBackupFile() will create a numbered set of backup files (default: 10)</li>
<li>KSaveFile::rcsBackupFile() will use rcs to maintain the backup file</li>
</ul>

<H4>KShortcut</H4>
<ul>
<li>Now implicitly shared and reentrant</li>
<li>Only uses QKeySequences now</li>
</ul>

<H4>KShortcutList and derivatives</H4>
<ul>
<li>Removed - no longer needed</li>
<li>Saving and loading of shortcuts now performed in KActionCollection, KGlobalAccel, and KStdAccel.</li>
</ul>

<H4>KStringHandler</H4>
<ul>
<li>static QString ljust( const QString &amp;text , int width ) -&gt; QString::leftJustified</li>
<li>static QString rjust( const QString &amp;text , int width ) -&gt; QString::rightJustified</li>
<li>matchFilename -&gt; matchFileName</li>
<li>static QString word( const QString &amp;text , int pos ) -&gt; QString::section </li>
<li>::randomString() has been moved to KRandom::randomString()</li>
</ul>

<H4>KStdAccel</H4>
<ul>
<li>Removed deprecated methods</li>
<li>Removed WhatThis, use WhatsThis</li>
<li>shortcutDefault3() and shortcutDefault4() have been removed, use shortcutDefault() instead</li>
</ul>

<H4>KStyle</H4>

<H4>KTempDir</H4>
<ul>
<li>existing() was removed, use exists() instead</li>
</ul>

<H4>KURL</H4>
<ul>
<li>Has been renamed to KUrl, but a typedef is available for source compatibility</li>
<li>KUrl inherits QUrl now, but the API offered by KUrl is mostly unchanged</li>
<li>filename() has been removed, use fileName() instead</li>
<li>isMalformed -&gt; !isValid()</li>
<li>prettyURL(0,KUrl::StripFileProtocol) -&gt; pathOrURL()</li>
<li>htmlURL() had to be removed, please use Qt::escape(url.prettyURL()) now, with #include &lt;QTextDocument&gt;.
This requires libQtGui, which is why it can't be in KUrl anymore.</li>
<li>url(0,106) or any other use of the 'mib enum' for encoding has been removed. QUrl is UTF8 based, and the world is becoming more and more utf8 based as well, the old encoding hacks inside urls should disappear.</li>
<li>Runtime behavior change: port() used to return 0 if no port was specified. It now returns -1 in that case, or you can use port(defaultPort) to set what it should return if no port was specified.</li>
</ul>

<H4>KURLDrag</H4>
<ul>
<li>This class has been moved to kde3support. Use KUrl::populateMimeData() and
KUrl::List::populateMimeData() in the drag/copy side,
and the static methods KUrl::List::canDecode() and KUrl::List::fromMimeData()
in the drop/paste side.<br>
Example: Replace <pre>  KURL::List uriList;
  if ( KURLDrag::canDecode(e) &amp;&amp; KURLDrag::decode( e, uriList ) ) {</pre>
by <pre>  KUrl::List uriList = KUrl::List::fromMimeData( e-&gt;mimeData() );
  if ( !uriList.isEmpty() ) {</pre></li>
</ul>

<H4>KMD5</H4>

<H4>KLocale</H4>
<ul>
<li> QString formatNumber(const QString &amp;numStr) const -&gt;   QString formatNumber(const QString &amp;numStr, bool round=true, int precision=2) const;</li>
<li> bool weekStartsMonday() const -&gt; int weekStartDay() const</li>
<li> QString monthName(int i, bool shortName = false) const -&gt; QString KCalendarSystem::monthName (int month, int year, bool shortName = false) const = 0; or QString KCalendarSystem::monthName (const QDate &amp; date, bool shortName = false ) const = 0;</li>
<li> QString weekDayName(int i, bool shortName = false) const -&gt; calendar()-&gt;weekDayName</li>
<li> QString monthNamePossessive(int i, bool shortName = false) const -&gt; calendar()-&gt;monthNamePossessive()</li>
<li> void setWeekStartsMonday(bool start) -&gt; setWeekStartDay</li>
<li> languages() -&gt; languageList()</li>
<li> formatMoney(const QString &amp;numStr) -&gt;   QString formatMoney(double num, const QString &amp; currency = QString::null, int digits = -1) const;</li>
<li> charset() -&gt; gone</li>
<li> setCharset() -&gt; gone</li>
<li>removeCatalogue was renamed to removeCatalog</li>
</ul>
<p>See also <a href="#i18n">the I18N section below</a>.</p>

<H4>KCmdLineArgs</H4>
<ul>
<li>   static void init(int _argc, char **_argv, const char *_appname, const char *_description, const char *_version, bool noKApp = false) KDE_DEPRECATED; -&gt; static void init(int _argc, char **_argv, const char *_appname, const char* programName, const char *_description, const char *_version, bool noKApp = false);
<li> noKApp parameter is gone, instead:   Q_FLAGS(StdCmdLineArgs)</li>
</ul>

<H4>KCharsets</H4>
<ul>
<li>KCharsets::codecForName cannot use glibc's i18n data anymore.
(Note: this feature was new in KDE 3.5 but never publically announced.)</li>
<li><b>TODO</b>: see which member functions can be removed</li>
<li><b>TODO</b>: simplification of the encoding list tables
   (simply name and description, no need of two tables and an lists of aliases.</li>
</ul>

<H4>KWin</H4>
<ul>
<li>appStarted() removed, use KStartupInfo::appStarted() instead</li>
<li>info(WId win) removed, use windowInfo() instead</li>
<li>struct Info was removed, use WindowInfo instead</li>
</ul>

<H4>KNetwork::KResolver</H4>
<ul>
<li>the signal finished(KResolverResults) is now finished(const KNetwork::KResolverResults&amp;)</li>
</ul>

<H4>KVMAllocator</H4>
<ul>
<li>The two old copy methodes are removed, copyBlock equivalents are renamed to copy</li>
</ul>

<h4>KIcon</h4>
<ul>
<li>Renamed and deprecated to K3Icon</li>
<li>Replacement is KIcon - now in kdeui</li>
</ul>

<H4>KConfigGroupSaver</H4>
<p>
The class KConfigGroupSaver has been deprecated, instead use KConfigGroup. The
difference is a KConfigGroupSaver object directly affects the config object it
is acting on, while a KConfigGroup object only ensures the entries read or
written through it are in the correct group.</p>
Instead of:
<pre>
KConfig *config = KGlobal::config();
KConfigGroupSaver saver(config, "group name");
	...
config-&gt;readXXX("entry name");
</pre>
should be rewritten as:
<pre>
KConfig *config = KGlobal::config();
KConfigGroup cg(config, "group name");
	...
cg.readXXX("entry name");
</pre>

<h4>KAboutData</h4>
<ul>
<li>KAboutData::setTranslator needs different parameters now.
(Please see the corresponding Doxygen comment for the current state.)</li>
</ul>
<p>See also <a href="#i18n">the I18N section below</a>.</p>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<H3><A NAME="kdeui">Changes in kdeui</A></H3>
<ul>
<li>kcolordlg.h went away, use kcolordialog.h</li>
<li>kcolorbtn.h went away, use kcolorbutton.h</li>
<li>kdatapik.h went away, use kdatepicker.h</li>
<li>kdualcolorbtn.h went away, use kdualcolorbutton.h</li>
<li>kxmlgui.h went away, use kxmlguifactory.h</li>
</ul>

<H4>KSeparator</H4>
<ul>
<li>KSeparator now uses Qt::Vertical and Qt::Horizontal rather then QFrame's HFrame and VFrame.</li>
</ul>

<H4>KCharSelectTable</H4>
<ul>
<li>There is no separation between focused and selected item anymore, only between selected and activated.</li>
<li>Signal focusItemChanged is not emitted with the currently selected/focused character, not with the most recent activated one.</li>
<li>Signal highlighted(...) has been removed.</li>
<li>Protected members gotoleft/right/up/down are gone. If you really need to simulate them, use the qitemselectionmodel</li>
</ul>

<H4>KColorDrag</H4>
<ul>
<li>has been moved as K3ColorDrag to kde3support</li>
<li>use QMimeData  direcly instead or KColorMimeData, which closest resembles KColorDrag</li>
</ul>

<h4>KIcon</h4>
<ul>
<li>New class (old one renamed to K3Icon)</li>
<li>Thin wrapper around QIcon which creates a KIconEngine corresponding to the kde named icon</li>
</ul>

<H4>KAction</H4>
<p>Making KAction a subclass of QAction brings KDE more into line with the Qt way of creating user interfaces, improves accessibility, and removes code duplication.</p>
<p>QAction in Qt4 is a true 1st class citizen - all QWidgets now have a list of associated actions, and QToolBar, QMenu etc. all use this list directly to show the graphical items (widgets, entries in the menu, etc).  This has replaced all usage of integers as "id"s.  There is also a new QEvent (QActionEvent), and the corresponding virtual protected function in QWidget, actionEvent().</p>
<ul>
<li>KAction is now a subclass of QAction.</li>
<li>Don't use setIconSet() anymore, use setIcon(KIcon(iconName)) instead</li>
<li>New constructors more closely model QAction (old constructors deprecated)</li>
<li>You should never rename the objectName() of a KAction - as KActionCollection holds a map, and it is not told of name changes (thus the setObjectName() functions are made private)</li>
<li>"icon" property is now a QIcon, use iconName() / setIconName() for KDE named icons</li>
<li>KShortcuts supported by shortcut/setShortcut (hides QAction's shortcut/setShortcut). Automatically sets alternateShortcuts() in QAction.</li>
<li>plug(), unplug() deprecated - use QWidget::addAction() and QWidget::removeAction() instead (To provide custom widgets for toolbars, provide a QActionWidgetFactory to setToolBarWidgetFactory() (i use multiple inheritance on that action)</li>
<li>containerCount(), container() deprecated - use associatedWidgets() instead</li>
<li>activated(), activated(int) signals deprecated - use triggered() signal instead</li>
<li>activate() is now trigger(), as in QAction</li>
<li>there is a replacement for activation providing keyboard + mouse states, see triggered(Qt::MouseButtons buttons, Qt::KeyboardModifiers modifiers) [currently buggy]</li>
<li>plugAccel(), unplugAccel(), kaccelCount() removed - they have no use now (accelerator management is inside Qt)</li>
<li>itemId(), getToolButtonID() removed - actions no longer have ids, basically the QAction* is its replacement</li>
<li>setGroup() / group() removed - use QActionGroup instead (setActionGroup() / actionGroup())</li>
<li>ActivationReason has been removed (not supported by Qt). For a surrogate, you can connect to QMenu::triggered(QAction*), QToolBar::actionTriggered(QAction*), etc.</li>
<li>setters are no longer slots; where they were used as such, an intermediary will be required</li>
<li>New feature from Qt: statusTip() / setStatusTip().  Usually this will be the same as the tooltip.  It appears in the status bar whenever the action is hovered in a QMenu.  A porting convenience is being investigated for automatic toolTip() -> statusTip(), but the best solution is to set both.</li>
<li>New feature: globalShortcut() and globalShortcutAllowed().  Automatically communicates with KGlobalAccel to register a global shortcut (ie. one that does not need the application to have focus to be activated).</li>
<li>setShortcut() now defaults to setting the default shortcut as well (as it was by far the most common use case).  To just set the custom shortcut, use setShortcut(myShortcut, KAction::CustomShortcut)</li>
</ul>

<H4>KActionCollection</H4>
<ul>
<li>constructor (QWidget* watch, ..) and setWidget() replaced by {set|add|remove}AssociatedWidget() - allows actions to respond to matching key presses on a widget level (basically a convenience method to have all actions in the collection added to the associated widget(s) and their shortcut scopes set to Qt::WidgetShortcut).</li>
<li>*AutoConnectShortcuts removed - irrelevant</li>
<li>*accel() removed - irrelevant (KAccel no longer handles keypresses)</li>
<li>New functions setConfigGroup(), setConfigGlobal(), configGroup(), configIsGlobal() - the action collection now stores the group whether the config is global. referenced in readSettings() / writeSettings()</li>
<li>readShortcutSettings() and writeShortcutSettings() renamed without the "Shortcut".  Set the configGroup() with setConfigGroup() either prior to each call, or (preferably) at the creation time of the action collection.</li>
<li>{set}HighlightingEnabled(), {connect|disconnect}Highlight() removed - highlighting is always enabled now</li>
<li>actionHighlighted(), actionStatusText(), clearStatusText() removed - use QAction::setStatusTip() as a replacement.  QStatusBars belonging to QMainWindow automatically get the statusTip() applied to them when they are moused over in a QMenu, via a QStatusTipEvent.</li>
<li>groups() removed (now using QActionGroups) - see actionGroups() (and actionsWithoutGroup()) for replacement</li>
<li>actions( const QString& group ) removed - use actionGroups() instead, and then QActionGroup::actions()</li>
<li>action(int), count() deprecated - use actions() directly</li>
<li>action(const char* name, const char* className) removed: action(const char* name), actions(const char* name), actionOfType&lt;Class&gt;(const char* name), actionsOfType&lt;Class&gt;(const char* name) are the replacements</li>
</ul>

<H4>KToggleAction</H4>
<ul>
<li>setExclusiveGroup() / exclusiveGroup() removed, use setActionGroup() and QActionGroup::setExclusive() for exclusivity (imitates the deleted KRadioAction class)</li>
<li>in comparison with KAction, adds setCheckedState() and sets this action to checkable</li>
</ul>

<H4>KSelectAction</H4>
<ul>
<li>now allows for combo box or button with popup menu when inserted to a toolbar</li>
<li>popupMenu() removed, use menu() instead</li>
<li>{set|}removeAmpersandsInCombo() removed - was deprecated</li>
</ul>

<H4>KRecentFilesAction</H4>
<ul>
<li>clearURLList() removed, use clear() instead</li>
<li>*URL* -> *Url* as per KDE naming policy</li>
</ul>

<H4>KWidgetAction</H4>
<ul>
<li>deprecated, instead assign a QActionWidgetFactory to a {K|Q}Action so the action can be plugged into mutiple toolbars.</li>
</ul>

<H4>KToolBarButton</H4>
<ul>
<li>Deleted - all done by QToolButton now</li>
</ul>

<H4>KToolBarRadioGroup</H4>
<ul>
<li>Deleted - all done by QToolButton now</li>
</ul>

<H4>KRadioAction</H4>
<ul>
<li>Deleted - use KAction (or KToggleAction if you need different text/icons for the selected state) instead, in combination with an exclusive QActionGroup</li>
</ul>

<H4>KListAction</H4>
<ul>
<li>Deleted - as per comments, did not add anything to KSelectAction</li>
</ul>

<H4>KToolBarSeparator</H4>
<ul>
<li>Deleted - use QAction::setSeparator()</li>
</ul>


<H4>KActionSelector</H4>
<ul>
<li>Q3ListBox -&gt; QListWidget</li>
<li>selectedListBox  -&gt;  selectedListWidget</li>
<li>availableListBox  -&gt;  availableListWidget</li>
</ul>

<H4>KRootPixmap</H4>
<ul>
<li>checkAvailable() -&gt; isAvailable()</li>
</ul>

<H4>KPixmapIO</H4>
<ul>
<li>The class is dumped, use QPixmap.toImage() and QPixmap::fromImage()</li>
</ul>

<H4>KURLLabel</H4>
<ul>
<li>renamed to KUrlLabel</li>
</ul>

<H4>KConfigDialog</H4>
<ul>
    <li>The dialog name is now a QString instead of a const char*</li>
    <li>signal void settingsChanged(const char *dialogName); -&gt; void settingsChanged(const QString&amp; dialogName);</li>
    <li>signal void settingsChanged(); has dissapeared use the signal with the parameter instead. If you don't need the parameter don't connect it, e.g <pre>connect(myDialog, SIGNAL(settingsChanged(const QString&amp;)), this, SLOT(mySlot()));</pre></li>
</ul>

<H4>KJanusWidget</H4>
<ul>
<li>Q3[HV]Box -&gt; K[HV]Box</li>
<li>usage of QFrame, instead of Q3Frame</li>
<li>Signal aboutToChangePage(QWidget*) is no longer possible with the new QStackedWidget; it has been replaced with currentPageChanged(QWidget*), the only difference being that it is emitted after the page has changed.</li>
<li>Removed name argument from the constructor.  Use setObjectName() instead, if needed.</li>
</ul>

<H4>KDialogBase</H4>
<ul>
<li>Most of useful features have been moved to KDialog, KDialog is now probably enough for your need. Use KDialogBase only if you use the KJanusWidget</li>
<li>setButtonOKText, setButtonApplyText , setButtonCancelText  -&gt; setButtonGuiItem</li>
<li>getBackgroundTile -&gt; backgroundTile</li>
<li>getContentsRect -&gt; gone</li>
<li>getBorderWidths -&gt; gone</li>
<li>Q3[HV]Box -&gt; K[HV]Box</li>
<li>Signal aboutToChangePage(QWidget*) is no longer possible with the new QStackedWidget; it has been replaced with currentPageChanged(QWidget*), the only difference being that it is emitted after the page has changed.  If you need such a notification, you will have to subclass the QWidgets you add to the stack, and override show().</li>
<li>don't overide anymore slotFoo().  You now need to connect to FooClicked signal.   Or reimplement accept() and reject() to intercept the Ok and Cancel button</li>
<li>configDialogSize() -&gt; restoreDialogSize()  to be consistant with KMainWindow.  saveDialogSize() take now a KConfigBase* parametter
</ul>

<H4>KDatePicker</H4>
<ul>
<li>signal void dateChanged(QDate); was replaced by void dateChanged( const QDate&amp;);</li>
<li>signal void dateEntered(QDate); was replaced by void dateEntered( const QDate&amp;);</li>
<li>signal void dateSelected(QDate); was replaced by void dateSelected( const QDate&amp;)</li>
<li>changed the order of the constructor's parameter</li>
<li>removed getData() method.  Use date() instead</li>
<li>removed protected slot <tt>void selectWeekClicked()</tt></li>
</ul>

<H4>KDockWindow</H4>
<ul>
<li>This class is obsolete, it is provided for compatibility only.
Use KSystemTray instead.</li>
</ul>

<H4>KDateWidget</H4>
<ul>
<li>signal void changed(QDate); was changed by void changed(const QDate&amp;)</li>
</ul>

<H4>KDateTable</H4>
<ul>
<li>signal void dateChanged(QDate); was replaced by void dateChanged(const QDate&amp;);</li>
<li>changed the order of the constructor's parameter</li>
<li>removed getData() method.  Use date() instead</li>
</ul>

<H4>KKeyDialog</H4>
<ul>
<li>removed KDE2 deprecated functions</li>
</ul>

<H4>KMainWindowInterface</H4>
<ul>
<li>functionsDynamic() now returns a DCOPCStringList</li>
<li>function processDynamic arguments uses DCOPCString instead of QCString :
	   <pre>bool processDynamic(const DCOPCString &amp;fun, const QByteArray &amp;data, DCOPCString&amp; replyType, QByteArray &amp;replyData);</pre></li>
<li>actions() now returns a DCOPCString</li>
</ul>

<H4>KMainWindow</H4>
<ul>
<li>getMemberList() was replaced by memberList() and memberList was renamed to mMemberList and made it private</li>
<li>sizeForCentralWidgetSize(QSize size) returned the size the mainwindow should have so that the central widget will be of size.  You normally don't need this, the recommended way to achieve a certain central widget size is as follows.<br>
 * Override sizeHint() in the central widget so that it returns the desired size.<br>
 * Call updateGeometry() in the central widget whenever the desired size changes. This ensures that the new sizeHint() is properly propagated to any parent layout.<br>
 * Now call adjustSize() in the mainwindow to resize the mainwindow such that the central widget will become the desired size.</li>
<li>Ported to QMainWindow</li>
<li>accel() removed - KAccel no longer needed</li>
</ul>

<H4>KAboutDialog</H4>
<ul>
<li>void setIcon( const QString &amp;fileName ) which was deprecated has been removed</li>
<li>addContainerPage int args are now Qt::Alignment args</li>
<li>addScrolledContainerPage int args are now Qt::Alignment args</li>
<li>addContainer int args are now Qt::Alignment args</li>
</ul>

<H4>KAboutContainer</H4>
<ul>
<li>KAboutContainer constructor int args have been replaced by Qt::Alignment</li>
<li>addTitle int args replaced by Qt::Alignment</li>
<li>addImage int args replaced by Qt::Alignment</li>
</ul>

<H4>KRecentFilesAction</H4>
<ul>
<li>the maxItem property is now an int (was a uint) (affects all accessors methods)</li>
</ul>

<H4>KPasswdEdit</H4>
<ul>
<li>KPasswordEdit(QWidget *parent, const char *name, int echoMode) ; was deprecated</li>
</ul>

<H4>KPassivePopup</H4>
<ul>
<li>clicked single now emits a const QPoint reference</li>
</ul>

<H4>KPopupMenu</H4>
<ul>
<li>Renamed to KMenu to reflect change in Qt</li>
<li>indexes replaced by QAction*</li>
<li>title, titlePixmap, and changeTitle removed - use QAction::text(), QAction::icon(), QAction::setText() and QAction::setIcon</li>
<li>contextMenuFocusItem changed to contextMenuFocusAction in line with the change from indexes to actions</li>
</ul>

<H4>KPopupTitle</H4>
<ul>
<li>Removed - QMenu doesn't accept widgets, and QAction allows specification of font, icon etc... and gradients / background pixmaps weren't even working in KDE3</li>
</ul>

<H4>KStatusBar</H4>
<ul>
<li>The unused BarStatus enum was removed.</li>
<li>The 'permanent' bool has been removed in favor of more explicit naming.
  insertItem(text,id,true) -&gt; insertPermanentItem(text,id),
  insertFixedItem(text,id,true) -&gt; insertPermanentFixedItem(text,id)</li>
</ul>

<H4>KEditListBox</H4>
<ul>
<li>void insertStrList(const QStrList* list, int index=-1) and void insertStrList(const QStrList&amp; list, int index=-1) have been deprecated, use QStringList or const char** instead</li>
</ul>

<H4>KEdit</H4>
<ul>
<li>The signal gotUrlDrop was removed, nobody used it, and it's easy to do in the application
if needed (see the KURLDrag section)</li>
</ul>

<H4>KTabBar</H4>
<ul>
<li>colors, close buttons on individual tabs not working at the moment</li>
<li>The old insertTab and removeTab have been removed, use addTab / insertTab / removeTab from QTabBar instead (uses indices, not QTab*s)</li>
</ul>

<H4>KTimeWidget</H4>
<ul>
<li>Removed, use QTimeEdit
</ul>

<H4>KNetwork::K*Socket</H4>
<ul>
<li>readBlock, writeBlock and peekBlock are now called simply read, write and peek</li>
<li>connect() now has an extra parameter (QIODevice::OpenMode)</li>
</ul>

<H4>KStdAction</H4>
<ul>
<li>showToolbar() methods have been removed, see KMainWindow::setStandardToolBarMenuEnabled()</li>
</ul>

<H4>KInputDialog</H4>
<ul>
<li>static QString KInputDialog::text( const QString &amp;caption,...) was replaced by QString KInputDialog::getText( const QString &amp;caption,...)</li>
</ul>

<h4>KToolBar</h4>
<ul>
<li>Ported to QToolBar</li>
<li>IconText, iconText(), setIconText() replaced by QToolBar::toolButtonStyle() et. al.</li>
<li>BarPosition, barPos(), setBarPos() replaced by Qt::ToolBarArea settings in QMainWindow; Unmanaged, Floating, and Flat are no longer supported (use QDockWidget if you need floating toolbars)</li>
<li>fullSize(), setFullSize() removed as now handled in QMainWindow - add or insert a tool bar break before (not needed for the first toolbar) and after the toolbar using QMainWindow::{add|insert}ToolBarBreak() to have the toolbar take up all available horizontal space</li>
<li>iconSize(), setIconSize() now a QToolBar property, and a QSize instead of an int - convenience function setIconDimensions() takes an int instead</li>
<li>insert*() and all associated item-manipulation methods removed - all done through actions now. Compatibility layer possible however so far I haven't found the functions to be used much in KDE programs (mostly it's taken care of by xmlgui instead)</li>
<li>flat(), setFlat() replaced by movable(), setMovable() (old "flat" concept equivalent to not movable)</li>
<li>layout-related methods removed (done by QToolBar's layout)</li>
<li>alignItemRight() removed (as above), replacement is to add a KToolBarSeparator action before the action you want to be aligned right (or if you have a custom action already, just create a container widget and insert a QSpacerItem on the left of your custom widget (see KonqLogoAction in kdebase/konqueror/konq_actions.cc)</li>
<li><tt>enum BarStatus</tt> and <tt>bool enable(BarStatus stat)</tt> have been
removed</li>
<li><tt>void enableMoving(bool flag)</tt> and <tt>void enableFloating (bool
flag)</tt> have been removed in favor of <tt>setMovingEnabled(bool)</tt></li>
<li><tt>int maxHeight()/int maxWidth()</tt> removed in favor of
<tt>maximumHeight()/maximumWidth()</tt></li>
<li><tt>void setMaxHeight (int h)</tt> and <tt>void setMaxWidth (int dw)</tt>
removed in favor of <tt>setMaximumHeight()/setMaximumWidth()</tt></li>
</ul>

<h4>KPushButton</h4>
<ul>
<li>Don't use setIconSet anymore, use setIcon instead, there is no compatibility class or function</li>
</ul>

<h4>KGUIItem</h4>
<ul>
<li>Don't use setIconSet anymore, use setIcon instead, there is no compatibility class or function</li>
</ul>

<h4>KGUIItem</h4>
<ul>
<li>Don't use setIconSet anymore, use setIcon instead, there is no compatibility class or function</li>
</ul>

<h4>KLineEdit</h4>
<ul>
<li>void cursorAtEnd() removed, use QLineEdit::end(false) instead</li>
<li>unused protected slots removed: void slotAboutToShow() and void slotCancelled()</li>
</ul>

<h4>KLineEditDlg</h4>
<ul>
<li>Was deprecated, has been removed. Use KInputDialog instead.</li>
</ul>

<h4>KPasswordDialog</h4>
<ul>
<li>kpassdlg.h was renamed kpassworddialog.h.</li>
</ul>

<H4>KProgress</H4>
<ul>
<li>KProgress has been renamed to KProgressBar (#include &lt;kprogressbar.h&gt; instead of #include &lt;kprogress.h&gt;)</li>
<li>QProgressBar is mostly enough. KProgressBar only necessary if setFormat(const QString &amp; format) or advance(int offset) is needed.</li>
<li>KProgressBar inherits from QProgressBar. QProgressBar has changed a lot in Qt4 ( setTotalSteps(totalSteps) -&gt; setRange(0, totalSteps), setProgress -&gt; setValue, percentageChanged -&gt; valueChanged ). For more details see QProgressBar class reference.</li>
</ul>

<H4>KProgressDialog</H4>
<ul>
<li>#include &lt;kprogressdialog.h&gt; instead of #include &lt;kprogress.h&gt;</li>
<li>See KProgress API changes</li>
</ul>

<h4>KTextBrowser</h4>
<ul>
		<li>Inherits from QTextBrowser instead of Q3TextBrowser</li>
</ul>

<h4>KSyntaxHighlighter</h4>
<ul>
		<li>Use K3SyntaxHighlighter because it used Q3TextEdit or use KSyntaxHighlighter when your appli will use QTextEdit</li>
</ul>

<h4>KIntNumInput, KDoubleNumInput, KDoubleSpinBox</h4>
<ul>
<li>Qt::Alignment for label alignment instead of int</li>
<li>setMinValue(min) -&gt; setMinimum(min) / minValue() -&gt; minimum()</li>
<li>setMaxValue(min) -&gt; setMaximum(min) / maxValue() -&gt; maximum()</li>
</ul>

<h4>KActiveLabel</h4>
<ul>
<li>Inherits from KTextBrowser instead of Q3TextBrowser</li>
</ul>

<h4>KWizard</h4>
<ul>
<li>Moved to kde3support.</li>
<li>Renamed to K3Wizard.</li>
</ul>

<h4>KAnimWidget</h4>
<ul>
<li>Renamed to KAnimatedButton</li>
<li>Now a subclass of QToolButton, acts in a much more standard fashion</li>
<li>size(), setSize() replaced by iconSize() + setIconSize()</li>
<li>Call updateIcons() whenever you change the iconSize() (the setter is non virtual :(</li>
</ul>


<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<H3><A NAME="kio">Changes in kio</A></H3>

<H4>KIO::UDSEntry</H4>
<ul>
<li>UDSEntry is now a hash instead of a list. Use the methods stringValue()
and numberValue() to retrieve fields directly, no loop is needed anymore.
See the UDSEntry documentation for code examples.</li>
<li>Also note that UDSEntryListConstIterator is now UDSEntryList::ConstIterator;
see the UDSEntryList documentation for a full code example of iterating through
a listDir result.</li>
<li>For kioslaves: replace every three lines like
 <pre>atom.m_uds = KIO::UDS_SIZE;
      atom.m_long = buff.st_size;
      entry.append( atom );</pre>
  with the line <pre>entry.insert( KIO::UDS_SIZE, buff.st_size );</pre></li>
</ul>

<H4>KFileItemList</H4>
<ul>
  <li>KFileItemList has been ported from QPtrList to QList. This means you
      have to iterate using either integers or java-style or stl iterators.
      Here's the stl version:
   <pre>
    KFileItemList::const_iterator kit = list.begin();
    const KFileItemList::const_iterator kend = list.end();
    for ( ; kit != kend; ++kit )
       ...
    </pre></li>
   <li>Note however that no loop is necessary anymore for finding an item by name (use findByName), finding an item by URL (use findByURL) or making a list of all urls (use urlList).</li>
</ul>

<H4>KIO:: global methods</H4>
<ul>
    <li>KIO::convertSizeFromKB is now KIO::convertSizeFromKiB since it takes a value in KiB (1 KiB = 1024 B)</li>
</ul>

<H4>KIO::Job</H4>
<ul>
   <li>For Job subclasses: removeSubjob doesn't terminate the parent job anymore, add
         <code>if ( !hasSubjobs() ) emitResult();</code> to emulate the old behavior that.</li>
   <li>subjobs is now private. This means you should replace subjobs.remove(job) with removeSubjob(job),
   and subjobs.isEmpty() with !hasSubjobs()</li>
</ul>

<h4>KFileDialog,KDirselectDialog,KUrlRequesterDlg,KCustomMenuEditor,KUrlBarItemDialog</h4>
<ul>
	<li> are KDialogBases no more, now they are a KDialogs </li>
	<li> no more name and modal parameters in the constructors</li>
</ul>

<h4>KFileDialog, KFileView, KDirOperator</h4>
<ul>
	<li> instead of KConfig* + QString group everywhere KConfigGroup is used now </li>
</ul>

<H4>KFileMetaInfo</H4>
<ul>
    <li>KFileMetaInfo::KiloBytes has been renamed KFileMetaInfo::KibiBytes (1 KiB = 1024 B)</li>
</ul>

<H4>KRun</H4>
<ul>
<li>the constructor needs a second parameter (a widget) now</li>
</ul>

<H4>PasswordDialog</H4>
<ul>
		<li>void setEnableUserField( bool enable, bool=false ) removed use :setUserReadOnly( !enable )</li>
</ul>

<H4>KIconButton</H4>
<ul>
		<li>signal void iconChanged(QString); replaced by void iconChanged(const QString &amp;);</li>
</ul>

<H4>KIconDialog</H4>
<ul>
		<li>signal void newIconName(QString); replaced by void newIconName(const QString &amp;);</li>
</ul>

<H4>UIServer</H4>
<ul>
		<li>QByteArray openPassDlg( const KIO::AuthInfo &gt;info ); removed. Use KIO::PasswordDialog::getNameAndPassword</li>
</ul>

<H4>RenameDlg</H4>
<ul>
<li>void b0Pressed() renamed to void cancelPressed()</li>
<li>void b1Pressed() renamed to void renamePressed()</li>
<li>void b2Pressed() renamed to void skipPressed()</li>
<li>void b3Pressed() renamed to void autoSkipPressed()</li>
<li>void b4Pressed() renamed to void overwritePressed()</li>
<li>void b5Pressed() renamed to void overwriteAllPressed()</li>
<li>void b6Pressed() renamed to void resumePressed()</li>
<li>void b7Pressed() renamed to void resumeAllPressed()</li>
<li>void b8Pressed() renamed to void suggestNewNamePressed()</li>
</ul>

<H4>KURLCombo</H4>
<ul>
<li>Renamed to KUrlCombo</li>
<li>All usage of QPixmap has been replaced by usage of QIcon</li>
<li>getPixmap() --&gt; getIcon()</li>
</ul>

<H4>KURLCompletion</H4>
<ul>
<li>Renamed to KUrlCompletion</li>
</ul>

<H4>KURLPixmapProvider</H4>
<ul>
<li>Renamed to KUrlPixmapProvider</li>
</ul>

<H4>KMimeType</H4>
<ul>
<li>iconForURL has been deprecated, will possily removed for KDE 4.0 final, use iconNameForURL instead</li>
</ul>

<H4>KArchive/KTar/KZip/KAr</H4>
<ul>
<li>All sizes and file offsets now use qint64 (similar to QIODevice)</li>
<li>The API has changed for subclasses: there is a KArchive constructor that takes a filename, and which provides KSaveFile support automatically, writeDir is doWriteDir, prepareWriting is doPrepareWriting etc.</li>
<li>API changes for users of the class: isOpened() was renamed to isOpen(),
   doneWriting() to finishWriting(), and the order of the arguments for writeFile() is more usual:
   data comes before size.</li>
<li>KTarDirectory -&gt; KArchiveDirectory</li>
<li>KTarFile -&gt; KArchiveFile</li>
<li>KTarEntry -&gt; KArchiveEntry</li>
<li>KTarGz -&gt; KTar</li>
</ul>

<H4>KURLRequester</H4>
<ul>
<li>renamed to KUrlRequester</li>
<li>setCaption is gone, use setWindowTitle instead</li>
</ul>

<H4>KURLBar</H4>
<ul>
<li>renamed to KUrlBar</li>
</ul>

<H4>KFileDialog</H4>
<ul>
<li>void toolbarCallback(int) was removed</li>
<li>void pathComboChanged( const QString&amp; ); was removed</li>
<li>void dirCompletion( const QString&amp; ); was removed</li>
<li>void setFilterMimeType(const QString &amp;label, const KMimeType::List &amp;types, const KMimeType::Ptr &amp;defaultType) was removed</li>
<li>void setPreviewWidget(const QWidget *w) was removed</li>
<li>void updateStatusLine(int dirs, int files); was removed</li>
</ul>

<h4>KFileOpenWithHandler</h4>
<ul>
<li>This class has been removed, it was just a workaround for a dependency problem,
just remove any instance of it.</li>
</ul>

<H4>KBookmark classes</H4>
<ul>
<li>KBookmarkDrag class has been moved to kde3support. Use KBookmark::populateMimeData() and
KBookmark::List::populateMimeData() in the drag/copy side,
and the static methods KBookmark::List::canDecode() and KBookmark::List::fromMimeData()
in the drop/paste side.</li>
</ul>

<H4>KImageIO classes</H4>
<ul>
<li>The KImageIO plugins are converted to Qt's imageformat plugins. The KImageIO class
now a lightweight version to query the installed plugins without actually loading them.
</li>
<li>.kimgio files are converted to .desktop files, and contains regular KDE services,
with ServiceType as QImageIOPlugins</li>
<li>KImageIO::registerFormats() removed, simply remove this from your code</li>
<li>Instead of mimeType(filename), you should use KMimeType</li>
<li>Instead of canRead() and canWrite() you can use types(mode).contains(typename)</li>
</ul>

<H4>KDESasl class</H4>
<ul>
<li>This class is removed due to its inflexiblity, use cyrus-sasl or the upcoming QCA SASL implementation</li>
</ul>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<H3><A NAME="kparts">Changes in kparts</A></H3>

<H3>ComponentFactory</H3>
<ul>
<li>createInstanceFromFactory is now KLibFactory::create&lt;T&gt;</li>
<li>createInstanceFromLibrary is now KLibLoader::createInstance&lt;T&gt;</li>
</ul>

<H4>BrowserRun</H4>
<ul>
    <li>BrowserRun::isExecutable obsoleted by KRun::isExecutable</li>
    <li>suggestedFilename -&gt; suggestedFileName</li>
</ul>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<H3><A NAME="kded">Changes in kded</A></H3>

A library, libkdedmodule, is now provided so that kded modules can link to the
code they need and link without undefined symbols.
A number of apparently unused KDEDModule methods have been commented out, contact
kde-core-devel if you need those after all.

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<H3><A NAME="kspell">Changes in kspell</A></H3>

<H4>KSpell</H4>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<H3><A NAME="khtmlpart">API-cleanups in KHTML</A></H3>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<H3><A NAME="kfile">Changes in kfile</A></H3>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<H3><A NAME="kcontrol">Changes in KControl</A></H3>
<ul>
<li>KCModule does no longer take a name argument, but directly a KInstance (having the correct
   name for the translations to work.</li>
</ul>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<H3><A NAME="kicker">Panel Applets and Extensions</A></H3>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<!-- ### TODO: should this not be a KDE3SUPPORT <h3> section? -->
<ul>
<li>KDockWidgets -&gt; kde3support K3DockWidget</li>
<li>KParts::DockWindow -&gt; kde3support KParts::DockWindow3</li>
<li>KMDI* --&gt; kdeSupport K3MDI*</li>
</ul>

<H3>libkmid</H3>
<ul>
<li>Moved to kdemultimedia, where atm it is only used by kmid.</li>
</ul>

<H3><A NAME="kscreensaver">KScreensaver</A></H3>

<h4>libkscreensaver</h4>
<ul>
<li>Moved to kdebase/workspace/kscreensaver</li>
</ul>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

<h3><a name="i18n">I18N</a></h3>

<h4>Messages.sh files</h4>
<p>Instead of the "messages" target of the Makefile.am files,
KDE4 uses now Bash scripts with Messages.sh file names.
The Perl script branches/work/kde4-l10n/scripts/conversion/Makefile2Messages.pl
can be used as an half-automatical conversion. (Please verify the result!)</p>

<h4>rc.cpp file</h4>
<p>The rc.cpp is now <em>always</em> generated. It is mandatory to have it as
parameter of the $XGETTEXT if you are using the class KAboutData and if
you are not explicitely setting KAboutData::setTranslator.</p>

<h4>Gettext 0.15-pre</h4>
<p>Scripty uses xgettext 0.15-pre (the development version) for extracting
messages out of code. This is a huge step from the former xgettext 0.10.35-kde
used in KDE3.</p>
<p>Important changes:</p>
<ul>
<li>If you define your own keywords (-k parameter of xgettext), you probably
need to adapt them, as xgettext does not automatically know about the
1, 2 or 3 parameter version.</li>
<li>You cannot have two similar messages, one being a normal message and
the other the singular form of a plural-form messages. For Gettext, this is
the same message and therefore this creates problems. (Note: there is not
any similar problems when you use contexts.)</li>
<li>As in Gettext 0.15-pre, contexts are supposed to be short, please consider
using a special comment instead of a context to give long hints to translators.
The special comment starts with //i18n: ot /*i18n: and must be <em>before</em>
the message code. (Note: this is not new to KDE4, but very seldomly used in 
KDE3.)</li>
</ul>

<h4>i18n calls</h4>

<p>The basic call, a message without arguments, context or plural, remains as is:</p>
<pre>
i18n("Just plain info");
</pre>

<p>If there are arguments, <code>arg</code> methods are no longer used to substitute the placeholders. Instead, arguments are added to the call:</p>
<pre>
i18n("%1 has scored %2", playerName, score);
</pre>
<p>Arguments can be of type <code>int</code>, <code>double</code>, <code>QString</code>, <code>QChar</code> (and perhaps more in the future).</p>

<p>Context and plural calls now have different names, <code>i18nc</code> and <code>i18np</code>, and take arguments in the same way:</p>
<pre>
i18nc("Player name - score", "%1 - %2", playerName, score);
i18np("1 image in album %1", "%n images in album %1", n, albumName);
</pre>

<p>There is one new variant, the context-plural call:</p>
<pre>
i18ncp("Personal file", "1 file", "%n files", n);
</pre>

<p><code>i18n*</code> calls are realized as templates, and so will take at most some finite number of arguments.</p>

<p>Notes on placeholder substitution:</p>
<ul>
<li>Placeholders are substituted in one pass, so no need to worry about argument itself containing a placeholder.</li>
<li>All same-numbered placeholders are substituted with same argument. This is in contrast to what single-argument <code>arg</code> methods of <code>QString</code> do.</li>
<li>Always provide exactly as many arguments as there are unique placeholders. Otherwise you will get error marks in messages at runtime (when compiled in debug mode). The only exception is plural placeholder, which need not be present in singular form.</li>
</ul>

<p>Sometimes you might need old-style syntax for argument substitution. For example, when there are many arguments, or, more importantly, when it is convenient to <i>defer</i> substitution of arguments. This is possible using new <code>ki18n</code> call, with <code>subs</code> methods for argument substitution and <code>toString</code> method for finalization:</p>
<pre>
KLocalizedString ks = ki18n("The Foo-machine reported: %1");
case (fooErrCode) {
    ERR_OXI: ks.subs(i18n("Out of oxidizer")); break;
    ERR_HYD: ks.subs(i18n("Out of hydrazine")); break;
    ERR_PIL: ks.subs(i18n("Out of pilots")); break;
    default: ks.subs(i18n("Unknown catastrophe"));
}
QString scream = ks.toString();
</pre>

<p>Note that <code>ki18n</code> returns object of type <code>KLocalizedString</code>, hence the <code>toString</code> method for conversion to plain <code>QString</code>. The <code>ki18n</code> call should be used rarely; the previous example can as well be rewritten to:</p>
<pre>
QString problem;
case (fooErrCode) {
    ERR_OXI: problem = i18n("Out of oxidizer"); break;
    ...
}
QString scream = i18n("The Foo-machine reported: %1", problem);
</pre>

<p>Another case when you might want to use <code>ki18n</code> is if you want to format arguments. <code>subs</code> methods can take formatting arguments, similar to those of <code>arg</code> methods in <code>QString</code>. You should <i>never</i> use methods other than <code>subs</code> to format numbers in localized messages:</p>
<pre>
i18n("Rounds: %1", myNumberFormat(n, 8)); // bad, number not localized
ki18n("Rounds: %1").subs(n, 8).toString(); // good, number is localized
</pre>

<p>There is a context, plural and context-plural variant of <code>ki18n</code> as well:</p>
<pre>
ki18nc("No function", "None").toString();
ki18np("1 file found", "%n files found").subs(n).toString();
ki18ncp("Personal file", "1 file", "%n files").subs(n).toString();
</pre>

<p>Extra notes on placeholder substitution for <code>ki18n*</code> calls:</p>
<ul>
<li>Plural placeholder <code>%n</code> will be substituted by the first supplied argument. If you give non-number as the first argument, you will get a runtime error mark in the message (in debug mode).</li>
</ul>

<p>If you need translation using locale (KLocale object) other than the default, you can use overloaded <code>toString</code> method which takes pointer to locale object (this replaces <code>KLocale::translate(...)</code> from KDE3):</p>
<pre>
KLocale *myLocale;
...
ki18n("Welcome!").toString(myLocale);
</pre>

<p>There is a script for semi-automatic conversion of KDE 3 code, <code>i18nk34conv.pl</code> in <code>branches/work/kde4-l10n/scripts/conversion/</code>. It will convert most of the calls automatically, and mark the places that need manual review. There is also the script <code>i18ncheckarg.pl</code> in <code>branches/work/kde4-l10n/scripts</code>, which will check whether placeholders and arguments match. Use it to catch and correct deferred substitutions (like in the examples above). Both these scripts you can just run without any arguments in top directory of your sources (but you can also specify paths or filenames as arguments). <i>Do not</i> run conversion script twice on same sources!</p>

<H4 ALIGN="RIGHT"><A HREF="#TOC">Return to the Table of Contents</A></H4>

</BODY>
</HTML>
